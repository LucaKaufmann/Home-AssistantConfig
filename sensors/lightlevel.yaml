platform: template
sensors:
  target_brightness:
    friendly_name: "Target brightness"
    unit_of_measurement: "%"
    value_template: >
      {%  set bedtime_value = 10 %}
      {%  set maximum = 100 %}
      {%  set a = -0.0130 %}
      {%  set c = 200 %}
      {%  set n = 100-c %}
      {%  set minimum = 20 %}
      {%  set i = states('sensor.kitchen_light_level_avg') | float %}
      {%  set p = (a*i)+c %}
      {%if p < minimum %}
        0
      {% elif p > maximum %}
        {{ maximum }}
      {% else %}
        {{ p | int}}
      {% endif %}
  target_brightness_off:
    friendly_name: "Target brightness lights off"
    unit_of_measurement: "%"
    value_template: >
      {%  set bedtime_value = 10 %}
      {%  set maximum = 100 %}
      {%  set a = -0.014 %}
      {%  set c = 214 %}
      {%  set n = 100-c %}
      {%  set minimum = 20 %}
      {%  set i = states('sensor.livingroom_light_level_avg') | float %}
      {%  set p = (a*i)+c %}
      {%if p < minimum %}
        0
      {% elif p > maximum %}
        {{ maximum }}
      {% else %}
        {{ p | int}}
      {% endif %}
  target_brightness_on:
    friendly_name: "Target brightness lights on"
    unit_of_measurement: "%"
    value_template: >
      {%  set bedtime_value = 10 %}
      {%  set maximum = 100 %}
      {%  set a = -0.016 %}
      {%  set c = 333 %}
      {%  set n = 100-c %}
      {%  set minimum = 20 %}
      {%  set i = states('sensor.livingroom_light_level_avg') | float %}
      {%  set p = (a*i)+c %}
      {%if p < minimum %}
        0
      {% elif p > maximum %}
        {{ maximum }}
      {% else %}
        {{ p | int}}
      {% endif %}