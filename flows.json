[{"id":"49017fb.081c18","type":"tab","label":"Lights","disabled":false,"info":""},{"id":"bee1fc25.cdcf8","type":"tab","label":"Remotes","disabled":false,"info":""},{"id":"a1f7f54.5d30108","type":"tab","label":"Vacuum","disabled":false,"info":""},{"id":"407269cb.c12fd8","type":"tab","label":"Status","disabled":false,"info":""},{"id":"9114d340.f3aed","type":"tab","label":"Media","disabled":false,"info":""},{"id":"69646b1e.2e5084","type":"tab","label":"Media lights","disabled":false,"info":""},{"id":"ce1e28e9.1a74d8","type":"tab","label":"Climate","disabled":false,"info":""},{"id":"433e5229.16b5fc","type":"tab","label":"Camera","disabled":false,"info":""},{"id":"bca662a0.a29b2","type":"tab","label":"Presence","disabled":false,"info":""},{"id":"f9c72e13.30015","type":"tab","label":"Backup","disabled":false,"info":""},{"id":"71ee4f4e.5502","type":"tab","label":"Gaming","disabled":false,"info":""},{"id":"beccfe19.cca62","type":"tab","label":"Chores","disabled":false,"info":""},{"id":"8d972e1e.28c54","type":"tab","label":"Export","disabled":false,"info":""},{"id":"c84fe94a.0c50b8","type":"tab","label":"Notifications","disabled":false,"info":""},{"id":"13b34343.676d45","type":"tab","label":"Dashboard","disabled":false,"info":""},{"id":"40088b6c.bf906c","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"cb4bdc1b.594b6","type":"tab","label":"3D Printer","disabled":false,"info":""},{"id":"27644a2a.ce6276","type":"subflow","name":"TTS Notification","info":"","category":"","in":[{"x":60,"y":180,"wires":[{"id":"80b77b41.686648"}]}],"out":[]},{"id":"17a3ce98.14e651","type":"subflow","name":"Camera snapshot","info":"Set msg.camera name","category":"","in":[{"x":60,"y":180,"wires":[{"id":"330362b.aba2b9e"}]}],"out":[]},{"id":"90ba4a50.2b5e48","type":"server","z":"","name":"HomeAssistant","legacy":false},{"id":"e9e87280.3fdb9","type":"mqtt-broker","z":"","name":"MQTT","broker":"192.168.92.20","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cb07a23c.1bf87","type":"alexa-home-conf","z":"","username":"thatsluke"},{"id":"a4ca6d02.96506","type":"server-state-changed","z":"49017fb.081c18","name":"Presence changed","server":"90ba4a50.2b5e48","entityidfilter":"group.anyone_home","entityidfiltertype":"substring","haltifstate":"","outputs":1,"x":109,"y":170,"wires":[["c3d2ebf6.6c2a38"]]},{"id":"92aebd5.9d6ff4","type":"api-call-service","z":"49017fb.081c18","name":"OFF","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.kitchen\"}","mergecontext":"","x":969.7222290039062,"y":933.6666870117188,"wires":[[]]},{"id":"912f0cf2.261cc","type":"switch","z":"49017fb.081c18","name":"switch motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":320.7222213745117,"y":894.6666593551636,"wires":[["7b6e8cc1.3a52e4","305325f9.8dce7a"],["305325f9.8dce7a"]]},{"id":"333eb578.f2b88a","type":"switch","z":"49017fb.081c18","name":"sleeping?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1356.2222213745117,"y":887.6666593551636,"wires":[["93710349.a7414","a9aa7a6a.5c0318"],["a336ac3b.39d7d","645ee716.d24eb8","f8561d3a.69b4"]]},{"id":"7e99cd5b.eecde4","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":2959.0554733276367,"y":885.3332853317261,"wires":[[]]},{"id":"7b6e8cc1.3a52e4","type":"api-current-state","z":"49017fb.081c18","name":"Anyone home?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":false,"override_payload":false,"entity_id":"group.anyone_home","outputs":1,"x":590.7222213745117,"y":889.6666593551636,"wires":[["6111c704.0c2818"]]},{"id":"2e3f1d9e.155e12","type":"api-current-state","z":"49017fb.081c18","name":"Motion?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"group.kitchen_motion_sensors","outputs":1,"x":806.7222213745117,"y":954.6666593551636,"wires":[["92aebd5.9d6ff4","7571b3ac.d2fdac","9393831b.aa1fe"]]},{"id":"305325f9.8dce7a","type":"stoptimer","z":"49017fb.081c18","duration":"60","units":"Second","payloadtype":"num","payloadval":"0","name":"1 min","x":595.7222213745117,"y":955.6666593551636,"wires":[["2e3f1d9e.155e12"],[]]},{"id":"2bee9d12.10d4a2","type":"comment","z":"49017fb.081c18","name":"Kitchen motion light","info":"","x":111.66666412353516,"y":845.5555458068848,"wires":[]},{"id":"5f0e1255.7a8acc","type":"comment","z":"49017fb.081c18","name":"Sunset light","info":"","x":94,"y":24,"wires":[]},{"id":"1ec977de.3ccf18","type":"api-current-state","z":"49017fb.081c18","name":"Anyone home?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_home","outputs":1,"x":602.1428604125977,"y":1324.5714282989502,"wires":[["1dc97122.1321cf"]]},{"id":"aab94d7c.2ff26","type":"stoptimer","z":"49017fb.081c18","duration":"60","units":"Second","payloadtype":"num","payloadval":"0","name":"30 sec","x":594.1428604125977,"y":1387.5714282989502,"wires":[["83b6cfe7.1d62c"],[]]},{"id":"1dc97122.1321cf","type":"api-current-state","z":"49017fb.081c18","name":"Already On?","server":"90ba4a50.2b5e48","halt_if":"on","entity_id":"light.big_light","outputs":1,"x":814.1428604125977,"y":1322.5714282989502,"wires":[["c573487.d5a8ab8","741dae9c.f7d63"]]},{"id":"83b6cfe7.1d62c","type":"api-current-state","z":"49017fb.081c18","name":"Motion?","server":"90ba4a50.2b5e48","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.someone_downstairs","state_type":"str","outputs":2,"x":810.1428604125977,"y":1381.5714282989502,"wires":[["73157711.583fb8","4f1ac77a.24ef88"],[]]},{"id":"73157711.583fb8","type":"api-call-service","z":"49017fb.081c18","name":"Big light off","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"light.big_light\"}","mergecontext":"","x":1430,"y":1300,"wires":[[]]},{"id":"c573487.d5a8ab8","type":"api-call-service","z":"49017fb.081c18","name":"Big light on","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.big_light\", \"brightness_pct\": \"10\"}","mergecontext":"","x":1053.3094863891602,"y":1323.5238208770752,"wires":[[]]},{"id":"d34a6381.db4f9","type":"comment","z":"49017fb.081c18","name":"Night light","info":"","x":77.21428680419922,"y":1274.857126235962,"wires":[]},{"id":"6111c704.0c2818","type":"api-current-state","z":"49017fb.081c18","name":"Sleeping?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.sleeping","outputs":1,"x":976.7222213745117,"y":889.6666593551636,"wires":[["333eb578.f2b88a"]]},{"id":"d56d0eee.7b93e","type":"range","z":"49017fb.081c18","minin":"4000","maxin":"12000","minout":"100","maxout":"35","action":"clamp","round":true,"property":"payload","name":"","x":2537.7222213745117,"y":880.6666593551636,"wires":[["b131c642.4faca8"]]},{"id":"b131c642.4faca8","type":"template","z":"49017fb.081c18","name":"kitchen light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.kitchen\",\n\"brightness_pct\": {{payload}}\n}}\n","output":"str","x":2738.2222213745117,"y":883.6666593551636,"wires":[["7e99cd5b.eecde4"]]},{"id":"c461c064.cdc82","type":"switch","z":"49017fb.081c18","name":"less than 14k","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"14000","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2386.2222213745117,"y":882.6666593551636,"wires":[["d56d0eee.7b93e"]]},{"id":"3a36fb9e.d9f214","type":"template","z":"49017fb.081c18","name":"paperlight light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.paperlight\",\n\"brightness_pct\": {{payload}},\n\"transition\": 120\n}}\n","output":"str","x":4650,"y":360,"wires":[["7f260a12.044bb4","17df81c7.61098e"]]},{"id":"17df81c7.61098e","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":4890,"y":340,"wires":[[]]},{"id":"68063f3.6aa0cc","type":"bigtimer","z":"49017fb.081c18","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer","lat":"60.314939","lon":"25.037804","starttime":"5004","endtime":1425,"startoff":"-180","endoff":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":82,"y":103.5,"wires":[[],[],["d394d52.4f01928"]]},{"id":"d394d52.4f01928","type":"switch","z":"49017fb.081c18","name":"if on","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":354,"y":118,"wires":[["54f861d9.4a2a"]]},{"id":"3197f30.7f1820e","type":"switch","z":"49017fb.081c18","name":"switch motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":377.14286041259766,"y":1349.5714282989502,"wires":[["1ec977de.3ccf18","aab94d7c.2ff26"],["aab94d7c.2ff26"]]},{"id":"5125c0c4.d9582","type":"trigger-state","z":"49017fb.081c18","name":"Motion in the livingroom","server":"90ba4a50.2b5e48","entityid":"binary_sensor.living_room_motion_sensor","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"vpqjvaszcq","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"fqyvjzk7oli","targetType":"entity_id","targetValue":"binary_sensor.motion_hallway_upstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"twhqa0qq6wi","targetType":"entity_id","targetValue":"binary_sensor.motion_hallway_upstairs_2","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"jqircuuh85f","targetType":"entity_id","targetValue":"sensor.target_brightness","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"50"},{"id":"5s30rskok1m","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":124.14286041259766,"y":1345.5714282989502,"wires":[["3197f30.7f1820e"],[]]},{"id":"abb737b6.20bd88","type":"api-call-service","z":"49017fb.081c18","name":"Paper light off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\": \"light.paperlight\"}","mergecontext":"","x":1760,"y":760,"wires":[[]]},{"id":"577fdd0c.f46eb4","type":"api-call-service","z":"49017fb.081c18","name":"Big light off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\": \"light.big_light\"}","mergecontext":"","x":1950,"y":760,"wires":[[]]},{"id":"c3d2ebf6.6c2a38","type":"switch","z":"49017fb.081c18","name":"home/not home","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":347,"y":169,"wires":[[],["44057372.28464c","666279e9.f02e18"]]},{"id":"47986034.d3ae2","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":376.1666564941406,"y":708.333251953125,"wires":[["ba5766c3.5a5f98","149ba56b.4c7e8b","21b9b8c3.cfaf98"],[]]},{"id":"8e8bcaee.24ffb8","type":"stoptimer","z":"49017fb.081c18","duration":"60","units":"Minute","payloadtype":"num","payloadval":"0","name":"1 hour","x":784.6666564941406,"y":704.3332576751709,"wires":[["d2d0c605.bbaf98"],[]]},{"id":"2ade4602.2f5eaa","type":"api-call-service","z":"49017fb.081c18","name":"Fan on","server":"90ba4a50.2b5e48","service_domain":"fan","service":"turn_on","data":"{\"entity_id\": \"fan.xiaomi_miio_device\"}","mergecontext":"","x":784.1666564941406,"y":750.3332576751709,"wires":[[]]},{"id":"100906bc.ca3e89","type":"api-call-service","z":"49017fb.081c18","name":"Set favorite mode","server":"90ba4a50.2b5e48","service_domain":"fan","service":"set_speed","data":"{\"entity_id\": \"fan.xiaomi_miio_device\", \"speed\": \"Favorite\"}","mergecontext":"","x":825.1666564941406,"y":838.3332576751709,"wires":[[]]},{"id":"91c9b46.483fe48","type":"api-call-service","z":"49017fb.081c18","name":"Set favorite level","server":"90ba4a50.2b5e48","service_domain":"fan","service":"xiaomi_miio_set_favorite_level","data":"{\"entity_id\": \"fan.xiaomi_miio_device\", \"level\": 4}","mergecontext":"","x":814.6666564941406,"y":795.3332576751709,"wires":[[]]},{"id":"d2d0c605.bbaf98","type":"api-call-service","z":"49017fb.081c18","name":"Fan off","server":"90ba4a50.2b5e48","service_domain":"fan","service":"turn_off","data":"{\"entity_id\": \"fan.xiaomi_miio_device\"}","mergecontext":"","x":963.6666564941406,"y":703.3332576751709,"wires":[[]]},{"id":"6955a3c6.85f98c","type":"server-state-changed","z":"a1f7f54.5d30108","name":"If leaving","server":"90ba4a50.2b5e48","entityidfilter":"group.anyone_home","entityidfiltertype":"substring","haltifstate":"on","outputs":1,"x":93.5,"y":218,"wires":[["3f243cb9.cf2474","f0e8e1ae.cb6bb","824bf37d.1923a"]]},{"id":"3f243cb9.cf2474","type":"stoptimer","z":"a1f7f54.5d30108","duration":"20","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":326.5,"y":219,"wires":[["c69c276.1fad6d8"],[]]},{"id":"f0a5dfcd.a757a","type":"trigger-state","z":"49017fb.081c18","name":"Motion in hallway upstairs","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_hallway_upstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"sjfjjbvgvx","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"2b6cszuuete","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"gvbcxa13eyf","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1440,"wires":[["650e18e9.e37fc8"],[]]},{"id":"331ba356.2af64c","type":"template","z":"49017fb.081c18","name":"hallway upstairs light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.hallway_upstairs\",\n\"brightness_pct\": {{payload}},\n\"transition\": 2\n}}\n","output":"str","x":2266,"y":1036,"wires":[["b96e0a56.2818a8"]]},{"id":"b96e0a56.2818a8","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":2479.5,"y":1038,"wires":[[]]},{"id":"650e18e9.e37fc8","type":"switch","z":"49017fb.081c18","name":"switch motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":376.14286041259766,"y":1439.5714282989502,"wires":[["667e5218.1efd9c","4b09c530.1740bc","4e805bd8.c45e54"],["667e5218.1efd9c"]]},{"id":"667e5218.1efd9c","type":"stoptimer","z":"49017fb.081c18","duration":"1","units":"Minute","payloadtype":"num","payloadval":"0","name":"1 min","x":630,"y":1540,"wires":[["1f705747.6f75a9"],[]]},{"id":"1f705747.6f75a9","type":"api-current-state","z":"49017fb.081c18","name":"Motion?","server":"90ba4a50.2b5e48","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"group.upstairs_motion_sensors","state_type":"str","outputs":2,"x":818.1428604125977,"y":1509.5714282989502,"wires":[["7ea691ef.a726d","2d3b1c70.7b2944"],[]]},{"id":"7ea691ef.a726d","type":"api-call-service","z":"49017fb.081c18","name":"hallway upstairs light off","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"light.hallway_upstairs\"}","mergecontext":"","x":1087.1428604125977,"y":1478.5714282989502,"wires":[[]]},{"id":"11f503ab.be2c0c","type":"switch","z":"49017fb.081c18","name":"on/off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1291.857177734375,"y":1433.4285888671875,"wires":[["aa1cb8ed.bcd0a8"],["cec7afb8.2ff29"]]},{"id":"8d50faef.324f08","type":"api-call-service","z":"49017fb.081c18","name":"Nightlight on","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.gateway\", \"brightness_pct\": \"10\"}","mergecontext":"","x":1770,"y":1380,"wires":[[]]},{"id":"364ca569.51a1ca","type":"api-current-state","z":"49017fb.081c18","name":"Anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.someone_downstairs","outputs":1,"x":1080.1428833007812,"y":1427.5714111328125,"wires":[["11f503ab.be2c0c"]]},{"id":"4e805bd8.c45e54","type":"api-current-state","z":"49017fb.081c18","name":"Already On?","server":"90ba4a50.2b5e48","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"light.hallway_upstairs","state_type":"str","outputs":2,"x":710,"y":1440,"wires":[["364ca569.51a1ca"],[]]},{"id":"44057372.28464c","type":"api-call-service","z":"49017fb.081c18","name":"Turn off home for over 10","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.home_for_over_10\"}","mergecontext":"","x":622,"y":173,"wires":[[]]},{"id":"ba5766c3.5a5f98","type":"time-range-switch","z":"49017fb.081c18","name":"","lat":"","lon":"","startTime":"22:00","endTime":"02:00","startOffset":0,"endOffset":0,"x":600.1666564941406,"y":705.3332576751709,"wires":[["8e8bcaee.24ffb8","2ade4602.2f5eaa","91c9b46.483fe48","100906bc.ca3e89"],[]]},{"id":"9d739a2d.a22e98","type":"function","z":"49017fb.081c18","name":"Multiply by 5","func":"msg.payload = Number(msg.payload)*5;\nflow.set('paperlight_brightness',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":2370,"y":440,"wires":[["2f92a4d4.36b03c"]]},{"id":"485ce41c.1d7a1c","type":"function","z":"49017fb.081c18","name":"Multiply by 5","func":"msg.payload = Number(msg.payload)*5;\nreturn msg;","outputs":1,"noerr":0,"x":2365.111083984375,"y":497.8888854980469,"wires":[["470ca4f1.b3308c","7559992f.bc5578"]]},{"id":"c8fbc289.e0c61","type":"switch","z":"f9c72e13.30015","name":"home/not home","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"},{"t":"eq","v":"not_home","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":85,"y":176,"wires":[["9aaeec64.d62dc"],["e3b3ac23.8b73f"]]},{"id":"9aaeec64.d62dc","type":"api-current-state","z":"f9c72e13.30015","name":"Sun","server":"90ba4a50.2b5e48","halt_if":"","entity_id":"sun.sun","outputs":1,"x":303,"y":114,"wires":[["81e03a8d.1772e8"]],"outputLabels":["data.attributes.next_setting"]},{"id":"e3b3ac23.8b73f","type":"api-call-service","z":"f9c72e13.30015","name":"All lights off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"","mergecontext":"","x":315,"y":264,"wires":[[]]},{"id":"81e03a8d.1772e8","type":"switch","z":"f9c72e13.30015","name":"Sun status","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"above_horizon","vt":"str"},{"t":"eq","v":"below_horizon","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":496,"y":112,"wires":[["b1f795da.9f7658"],["46a1581a.850868","90806bf8.906638"]]},{"id":"b1f795da.9f7658","type":"moment","z":"f9c72e13.30015","name":"","topic":"","input":"data.attributes.next_setting","inputType":"msg","inTz":"Etc/UTC","adjAmount":"0","adjType":"hours","adjDir":"subtract","format":"","locale":"en_GB","output":"","outputType":"msg","outTz":"Etc/UTC","x":770,"y":54,"wires":[["3fd377e6.8c2698"]],"inputLabels":["data.attributes.next_setting"]},{"id":"46a1581a.850868","type":"api-call-service","z":"f9c72e13.30015","name":"Big light on","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\": \"light.big_light\", \"brightness_pct\": 75}","mergecontext":"","x":758,"y":156,"wires":[[]]},{"id":"90806bf8.906638","type":"api-call-service","z":"f9c72e13.30015","name":"Paper light on","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\": \"light.paperlight\", \"brightness_pct\": 75}","mergecontext":"","x":768,"y":207,"wires":[[]]},{"id":"3fd377e6.8c2698","type":"function","z":"f9c72e13.30015","name":"Time in seconds","func":"\nvar startDate = new Date(msg.payload);\n// Do your operations\nvar endDate   = new Date();\nvar seconds = Math.round((startDate - endDate) / 1000);\nvar newMsg = { payload: seconds }\nreturn newMsg;","outputs":1,"noerr":0,"x":1003.5,"y":54,"wires":[["c203cde3.82f8"]]},{"id":"c203cde3.82f8","type":"switch","z":"f9c72e13.30015","name":"Less than two hours","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"13000","vt":"num"}],"checkall":"false","repair":false,"outputs":1,"x":1281,"y":55,"wires":[["e384902b.9f503","fa0ef3ab.c20bd"]]},{"id":"e384902b.9f503","type":"template","z":"f9c72e13.30015","name":"paper light on template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.paperlight\",\n\"brightness_pct\": 100,\n\"transition\": {{payload}}\n}}\n","output":"str","x":1621,"y":109,"wires":[[]]},{"id":"fa0ef3ab.c20bd","type":"template","z":"f9c72e13.30015","name":"Big light on template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.big_light\",\n\"brightness_pct\": 100,\n\"transition\": {{payload}}\n}}\n","output":"str","x":1609,"y":52,"wires":[["9f6a0ae9.5237b8"]]},{"id":"9f6a0ae9.5237b8","type":"api-call-service","z":"f9c72e13.30015","name":"Light on","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{}","mergecontext":"","x":1839,"y":52,"wires":[[]]},{"id":"3e776b64.2d1864","type":"trigger-state","z":"69646b1e.2e5084","name":"TV Source","server":"90ba4a50.2b5e48","entityid":"sensor.tv_source","debugenabled":false,"constraints":[{"id":"o7ecmonzgk9","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"d8thxovk41","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":88.5,"y":363,"wires":[["d7334d37.5b9da"],[]]},{"id":"d7334d37.5b9da","type":"switch","z":"69646b1e.2e5084","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"HDMI4","vt":"str"},{"t":"eq","v":"Netflix","vt":"str"},{"t":"eq","v":"Plex","vt":"str"},{"t":"eq","v":"XPlay","vt":"str"},{"t":"eq","v":"HDMI3","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":284.5,"y":357,"wires":[["be2dcaf1.7efee8"],["62e243aa.24c88c"],["e773dae.bf9d528"],["e773dae.bf9d528"],["2e2d1b01.a09fb4"]]},{"id":"d7d2874.2670278","type":"stoptimer","z":"69646b1e.2e5084","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1030.5,"y":317,"wires":[["14508e78.711912"],[]]},{"id":"be2dcaf1.7efee8","type":"template","z":"69646b1e.2e5084","name":"Desk light yellow","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 100,\n\"rgb_color\":[255,255,65]\n}}\n","output":"str","x":710,"y":300,"wires":[["d7d2874.2670278","904f2d34.d45fe"]]},{"id":"904f2d34.d45fe","type":"api-call-service","z":"69646b1e.2e5084","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":1112,"y":466,"wires":[[]]},{"id":"14508e78.711912","type":"template","z":"69646b1e.2e5084","name":"Desk light blue","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 20,\n\"rgb_color\":[146,199,255],\n\"transition\":10\n}}\n","output":"str","x":1259,"y":360,"wires":[["904f2d34.d45fe"]]},{"id":"62e243aa.24c88c","type":"template","z":"69646b1e.2e5084","name":"Desk light red","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 100,\n\"rgb_color\":[255,65,0]\n}}\n","output":"str","x":700,"y":340,"wires":[["904f2d34.d45fe","d7d2874.2670278"]]},{"id":"e773dae.bf9d528","type":"template","z":"69646b1e.2e5084","name":"Desk light orange","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 100,\n\"rgb_color\":[255,190,44]\n}}\n","output":"str","x":710,"y":380,"wires":[["904f2d34.d45fe","d7d2874.2670278"]]},{"id":"2e2d1b01.a09fb4","type":"template","z":"69646b1e.2e5084","name":"Desk light yellow","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 100,\n\"rgb_color\":[255,255,65]\n}}\n","output":"str","x":710,"y":420,"wires":[["904f2d34.d45fe","d7d2874.2670278"]]},{"id":"60a05cf7.456ca4","type":"trigger-state","z":"69646b1e.2e5084","name":"TV on","server":"90ba4a50.2b5e48","entityid":"media_player.lg_webos_smart_tv","debugenabled":false,"constraints":[{"id":"fokt90uudsn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"},{"id":"ha3xuql65xs","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"wowjtcifl98","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":50,"y":580,"wires":[[],[]]},{"id":"201e906d.7ca1b","type":"trigger-state","z":"69646b1e.2e5084","name":"TV paused","server":"90ba4a50.2b5e48","entityid":"media_player.lg_webos_smart_tv","debugenabled":false,"constraints":[{"id":"zwiarf5ontq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"paused"},{"id":"sf731rzawj","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":700,"wires":[["88eb901f.9d887","2545b9f3.262b76"],[]]},{"id":"88eb901f.9d887","type":"template","z":"69646b1e.2e5084","name":"Desk light blue","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 100,\n\"rgb_color\":[146,199,255],\n\"transition\":2\n}}\n","output":"str","x":400,"y":660,"wires":[["f443589a.bf4ae8"]]},{"id":"f443589a.bf4ae8","type":"api-call-service","z":"69646b1e.2e5084","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":610,"y":680,"wires":[[]]},{"id":"5f72639a.a8ecdc","type":"trigger-state","z":"69646b1e.2e5084","name":"Chromecast paused","server":"90ba4a50.2b5e48","entityid":"media_player.living_room_tv","debugenabled":false,"constraints":[{"id":"lj91qpsaj6f","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"paused"},{"id":"bfi2hfwdn3e","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":760,"wires":[["88eb901f.9d887","2545b9f3.262b76"],[]]},{"id":"4b09c530.1740bc","type":"time-range-switch","z":"49017fb.081c18","name":"","lat":"","lon":"","startTime":"22:00","endTime":"00:00","startOffset":0,"endOffset":0,"x":612.1428833007812,"y":1614.5714111328125,"wires":[["826ccfdd.9317a"],[]]},{"id":"c21b6b34.b05d48","type":"api-call-service","z":"49017fb.081c18","name":"Bedroom on","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":1230,"y":1620,"wires":[[]]},{"id":"93710349.a7414","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.kitchen\", \"brightness_pct\": \"1\"}","mergecontext":"","x":1540.22216796875,"y":835.6666870117188,"wires":[[]]},{"id":"bd8e97b0.e36ba8","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Hallway motion triggered","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_hallway_upstairs_2","debugenabled":false,"constraints":[{"id":"tzpa0023axt","targetType":"entity_id","targetValue":"media_player.speaker","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"},{"id":"0g6o1sl9leou","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":148.5,"y":217,"wires":[["3a30004d.63ede"],[]]},{"id":"3a30004d.63ede","type":"api-call-service","z":"c84fe94a.0c50b8","name":"","server":"90ba4a50.2b5e48","service_domain":"notify","service":"livingroom_tv","data":"{\"message\":\"Jere is awake\"}","mergecontext":"","x":749.5,"y":214,"wires":[[]]},{"id":"4fdb9f65.8792c","type":"trigger-state","z":"c84fe94a.0c50b8","name":"","server":"90ba4a50.2b5e48","entityid":"script.masterchef","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":168.5,"y":313,"wires":[[],[]]},{"id":"8c24e435.782c68","type":"api-call-service","z":"49017fb.081c18","name":"Turn off lights downstairs","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"group.downstairs_lights\"}","mergecontext":"","x":1290,"y":280,"wires":[[]]},{"id":"6c309d0d.faba34","type":"api-current-state","z":"69646b1e.2e5084","name":"living room brightness","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.livingroom_light_level_avg","outputs":1,"x":600,"y":520,"wires":[["ee6396f0.aa09f8"]]},{"id":"ee6396f0.aa09f8","type":"switch","z":"69646b1e.2e5084","name":"<16000","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"16000","vt":"num"},{"t":"gt","v":"17000","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":800,"y":520,"wires":[["efadcbe7.c1bed8"],["ec4fa05b.df514","f9acb668.6afa48","dd6a86a7.e73f38"]]},{"id":"57f29d81.e96484","type":"template","z":"9114d340.f3aed","name":"speech template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"sonos_entity\": \"media_player.living_room\",  \"volume\": 0.3,  \"message\": \"<speak>{{payload.speech}}</speak>\",  \"delay\": \"00:00:10\"}}","output":"str","x":910,"y":380,"wires":[[]]},{"id":"e8f89c5b.bb4c1","type":"api-call-service","z":"9114d340.f3aed","name":"Turn TV off","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"turn_off","data":"{\"entity_id\": \"media_player.lg_webos_smart_tv\"}","mergecontext":"","x":954,"y":818,"wires":[[]]},{"id":"f9cd82cd.d8da6","type":"api-call-service","z":"9114d340.f3aed","name":"TV limit off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.tv_limit\"}","mergecontext":"","x":955,"y":863,"wires":[[]]},{"id":"c891b8a0.e0de18","type":"trigger-state","z":"49017fb.081c18","name":"Someone downstairs?","server":"90ba4a50.2b5e48","entityid":"input_boolean.someone_downstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"yfjv839uk","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":128.5714111328125,"y":236.71429443359375,"wires":[["2e4154c0.ea9a0c"],[]]},{"id":"742b4e3a.44f49","type":"api-call-service","z":"9114d340.f3aed","name":"","server":"90ba4a50.2b5e48","service_domain":"script","service":"sonos_say","data":"{\"sonos_entity\": \"media_player.living_room\",  \"volume\": 0.3,  \"message\": \"<speak>The TV has been on for over 3 hours. It will turn off in 5 minutes.</speak>\",  \"delay\": \"00:00:10\"}","mergecontext":"","x":1000,"y":980,"wires":[[]]},{"id":"d772baa9.94b2e8","type":"api-call-service","z":"9114d340.f3aed","name":"","server":"90ba4a50.2b5e48","service_domain":"notify","service":"echo","data":"{\"message\": \"Your TV time is over. It will turn off in 5 minutes.\"}","mergecontext":"","x":1200,"y":740,"wires":[[]]},{"id":"a409d6dd.ff1678","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.hallway_upstairs\", \"brightness_pct\": \"100\"}","mergecontext":"","x":2070,"y":1540,"wires":[[]]},{"id":"10832d68.a51b93","type":"trigger-state","z":"a1f7f54.5d30108","name":"Vacuum finished cleaning","server":"90ba4a50.2b5e48","entityid":"sensor.vacuum_cleaning_time","debugenabled":false,"constraints":[{"id":"2tixfcbze7n","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"30"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":150,"y":1180,"wires":[["d67a0809.3de568","88121638.52b2e8","3d558fc5.ba613","27cebf8f.52da1","180952ab.72cecd","60cdee83.adce1"],[]]},{"id":"d67a0809.3de568","type":"api-call-service","z":"a1f7f54.5d30108","name":"Set reminder to empty vacuum","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.notify_vacuum_emptying\"}","mergecontext":"","x":590,"y":1180,"wires":[[]]},{"id":"1308a7f.6f57558","type":"trigger-state","z":"a1f7f54.5d30108","name":"Trigger kitchen","server":"90ba4a50.2b5e48","entityid":"binary_sensor.kitchen_motion_sensor","debugenabled":false,"constraints":[{"id":"15lc1hyqhgl","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"ej2gcoqwm2r","targetType":"entity_id","targetValue":"input_boolean.notify_vacuum_emptying","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"33f9noeebe","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"942m21oqxke","targetType":"entity_id","targetValue":"vacuum.eve","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"docked"},{"id":"3hdoar9swxg","targetType":"entity_id","targetValue":"input_boolean.guest_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"t6ija1rptft","targetType":"entity_id","targetValue":"input_number.vacuum_cleaning_time","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"60"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":112,"y":646,"wires":[["1e1f8c96.c13fb3"],[]]},{"id":"f786832a.421cb","type":"api-call-service","z":"a1f7f54.5d30108","name":"Move vacuum","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.move_away_from_dock\"}","mergecontext":"","x":683,"y":640,"wires":[[]]},{"id":"2fdf51ad.ee394e","type":"api-call-service","z":"a1f7f54.5d30108","name":"Notify kitchen","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\":\"media_player.black_sonos_one\", \"message\":\"Heads-up: The vacuum needs to be emptied\"}","mergecontext":"","x":680,"y":592,"wires":[[]]},{"id":"1e1f8c96.c13fb3","type":"time-range-switch","z":"a1f7f54.5d30108","name":"between 10:00 and 21:00","lat":"","lon":"","startTime":"10:00","endTime":"21:00","startOffset":0,"endOffset":0,"x":409,"y":643,"wires":[["2fdf51ad.ee394e","f786832a.421cb","c577ed5a.0a202"],[]]},{"id":"b6223ef9.99759","type":"trigger-state","z":"9114d340.f3aed","name":"","server":"90ba4a50.2b5e48","entityid":"sensor.tv_on_past_hour","debugenabled":false,"constraints":[{"id":"9lxpvrugisa","targetType":"entity_id","targetValue":"input_boolean.tv_limit","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":190,"y":820,"wires":[["4684ed80.1dab64"],[]]},{"id":"4684ed80.1dab64","type":"switch","z":"9114d340.f3aed","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"0.99","vt":"num"},{"t":"eq","v":"0.9","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":467,"y":826,"wires":[["1ed71c08.71fd84","e8f89c5b.bb4c1","f9cd82cd.d8da6"],["fb2275f8.76bb08"]]},{"id":"a45a59d3.7d5a78","type":"api-call-service","z":"49017fb.081c18","name":"Nightlight off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.hallway_color\"}","mergecontext":"","x":1150,"y":1760,"wires":[[]]},{"id":"3fe5d75d.ee40d8","type":"trigger-state","z":"49017fb.081c18","name":"Movie Mode off","server":"90ba4a50.2b5e48","entityid":"input_boolean.movie_mode","debugenabled":false,"constraints":[{"id":"g3fhv8jk4tq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":420,"wires":[["b23b7cba.e20698","1a850d3e.74d0b3"],[]]},{"id":"149ba56b.4c7e8b","type":"api-call-service","z":"49017fb.081c18","name":"All lights off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"transition\":30}","mergecontext":"","x":790,"y":640,"wires":[[]]},{"id":"c69c276.1fad6d8","type":"api-current-state","z":"a1f7f54.5d30108","name":"cancel if anyone home","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"group.anyone_home","outputs":1,"x":573.5,"y":218,"wires":[["15773551.1b658b"]]},{"id":"824bf37d.1923a","type":"api-render-template","z":"a1f7f54.5d30108","name":"vacuum notification","server":"90ba4a50.2b5e48","template":"{% if is_state(\"input_boolean.schedule_kitchen_cleaning\", \"on\") %}\nKitchen{% if is_state(\"input_boolean.schedule_dining_area_cleaning\", \"on\") %} and Dining area{% endif %} will be vacuumed today.\n{% elif is_state(\"input_boolean.schedule_dining_area_cleaning\", \"on\") %}\nDining area will be vacuumed today\n{% endif %}","x":664.5,"y":342,"wires":[["1215f7e5.def948"]]},{"id":"6ac8d5b1.5470ac","type":"api-call-service","z":"a1f7f54.5d30108","name":"notify sevenplus","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"","mergecontext":"","x":1244.5,"y":346,"wires":[[]]},{"id":"ca31536d.954f6","type":"template","z":"a1f7f54.5d30108","name":"message template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"message\":\"{{payload}}\"}}","output":"str","x":1035.5,"y":343,"wires":[["6ac8d5b1.5470ac"]]},{"id":"1215f7e5.def948","type":"switch","z":"a1f7f54.5d30108","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"[object Object]","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":837.5,"y":341,"wires":[["ca31536d.954f6","90efc6e2.1f9e98"]]},{"id":"15773551.1b658b","type":"api-current-state","z":"a1f7f54.5d30108","name":"should clean whole apartment?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.schedule_cleaning","outputs":1,"x":857,"y":217,"wires":[["8509667c.0a6348"]]},{"id":"8509667c.0a6348","type":"switch","z":"a1f7f54.5d30108","name":"Whole apartment","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1122,"y":216,"wires":[["be8cfdab.cbbde","f158e1e3.e3bd3"],["d7f48182.7c572"]]},{"id":"be8cfdab.cbbde","type":"api-call-service","z":"a1f7f54.5d30108","name":"Start cleaning whole apartment","server":"90ba4a50.2b5e48","service_domain":"vacuum","service":"start","data":"{\"entity_id\":\"vacuum.eve\"}","mergecontext":"","x":1470,"y":120,"wires":[[]]},{"id":"f158e1e3.e3bd3","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_cleaning\"}","mergecontext":"","x":1450,"y":160,"wires":[[]]},{"id":"d7f48182.7c572","type":"api-current-state","z":"a1f7f54.5d30108","name":"should kitchen be cleaned?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.schedule_kitchen_cleaning","outputs":1,"x":1454.5,"y":217,"wires":[["1d9bc3f1.67c1bc"]]},{"id":"1d9bc3f1.67c1bc","type":"switch","z":"a1f7f54.5d30108","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1686,"y":220,"wires":[["9756c21a.9eb0a"],["24a64e44.f23662"]]},{"id":"9756c21a.9eb0a","type":"api-current-state","z":"a1f7f54.5d30108","name":"should dining area be cleaned?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.schedule_dining_area_cleaning","outputs":1,"x":1953.5,"y":146,"wires":[["5bce2393.3b52ec"]]},{"id":"5bce2393.3b52ec","type":"switch","z":"a1f7f54.5d30108","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":2211,"y":145,"wires":[["335ce7ed.ba8a48","7eea1d1c.11d6e4"],["3bcb1a81.e8ad96","2fa26f11.979c5"]]},{"id":"a2b69f83.29e9d","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule kitchen cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_kitchen_cleaning\"}","mergecontext":"","x":2720,"y":140,"wires":[[]]},{"id":"b098cba0.1a5508","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule dining area cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_dining_area_cleaning\"}","mergecontext":"","x":2730,"y":100,"wires":[[]]},{"id":"7eea1d1c.11d6e4","type":"api-call-service","z":"a1f7f54.5d30108","name":"clean kitchen and dining area","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.vacuum_clean_dining_area_kitchen\"}","mergecontext":"","x":2460,"y":60,"wires":[[]]},{"id":"3bcb1a81.e8ad96","type":"api-call-service","z":"a1f7f54.5d30108","name":"clean kitchen","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.vacuum_clean_kitchen\"}","mergecontext":"","x":2416,"y":170,"wires":[[]]},{"id":"e3698a60.6a6f58","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule kitchen cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_kitchen_cleaning\"}","mergecontext":"","x":2640,"y":220,"wires":[[]]},{"id":"24a64e44.f23662","type":"api-current-state","z":"a1f7f54.5d30108","name":"should dining area be cleaned?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.schedule_dining_area_cleaning","outputs":1,"x":1956,"y":231,"wires":[["89bad20b.30c7b"]]},{"id":"89bad20b.30c7b","type":"switch","z":"a1f7f54.5d30108","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":2210,"y":294,"wires":[["99497e8a.f41ae","6a3ec68f.363208"],[]]},{"id":"beb67240.2e462","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule dining area cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_dining_area_cleaning\"}","mergecontext":"","x":2650,"y":280,"wires":[[]]},{"id":"99497e8a.f41ae","type":"api-call-service","z":"a1f7f54.5d30108","name":"clean dining area","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.vacuum_clean_dining_area\"}","mergecontext":"","x":2430,"y":320,"wires":[[]]},{"id":"d64589c.cb0b478","type":"api-current-state","z":"69646b1e.2e5084","name":"kitchen motion?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.kitchen_motion_sensors","outputs":1,"x":358.5,"y":910,"wires":[["ce2aebe1.bfd948"]]},{"id":"ce2aebe1.bfd948","type":"api-call-service","z":"69646b1e.2e5084","name":"add kitchen speaker","server":"90ba4a50.2b5e48","service_domain":"script","service":"sonos_group_motion","data":"{\"target_player\":\"media_player.kitchen\"}","mergecontext":"","x":613.5,"y":912,"wires":[[]]},{"id":"95a16b86.ed74b8","type":"api-current-state","z":"69646b1e.2e5084","name":"kitchen motion?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.motion_hallway_upstairs","outputs":1,"x":359,"y":964,"wires":[["b5e4b69c.ab22a8"]]},{"id":"b5e4b69c.ab22a8","type":"api-call-service","z":"69646b1e.2e5084","name":"add office speaker","server":"90ba4a50.2b5e48","service_domain":"script","service":"sonos_group_motion","data":"{\"target_player\":\"media_player.bedroom\"}","mergecontext":"","x":605,"y":965,"wires":[[]]},{"id":"f5aefcb6.7892a","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Door opens with no one at home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.door_window_sensor_158d0001e4c274","debugenabled":false,"constraints":[{"id":"rvt9wsab1h","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"2nqr8qcwgq4","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":175.5,"y":388,"wires":[["ebb70ce3.4f724"],[]]},{"id":"ebb70ce3.4f724","type":"api-call-service","z":"c84fe94a.0c50b8","name":"notify sevenplus","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"{\"message\":\"Door opened while no one is home\"}","mergecontext":"","x":534,"y":385,"wires":[[]]},{"id":"3dc17879.d331f8","type":"trigger-state","z":"49017fb.081c18","name":"Motion in hallway upstairs","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_hallway_upstairs_2","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"sjfjjbvgvx","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"95f6zoc7l5b","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":127.14286041259766,"y":1538.5714282989502,"wires":[["99646c57.0b932"],[]]},{"id":"1de6ff97.cf579","type":"api-call-service","z":"433e5229.16b5fc","name":"Enable motion detection","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_on","data":"{\"entity_id\":\"switch.dafang_motion_detection\"}","mergecontext":"","x":399.5,"y":33,"wires":[[]]},{"id":"107b5696.cc7ec9","type":"api-call-service","z":"433e5229.16b5fc","name":"Disable motion detection","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.dafang_motion_detection\"}","mergecontext":"","x":399,"y":99,"wires":[[]]},{"id":"2fda99f8.d0e4f6","type":"trigger-state","z":"433e5229.16b5fc","name":"Is it dark?","server":"90ba4a50.2b5e48","entityid":"sensor.livingroom_light_level","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":100,"y":240,"wires":[["f62bd42c.e9b738"],[]]},{"id":"3551eb41.1e6d74","type":"api-call-service","z":"433e5229.16b5fc","name":"Enable night mode","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_on","data":"{\"entity_id\":\"switch.dafang_night_mode\"}","mergecontext":"","x":672.5,"y":183,"wires":[[]]},{"id":"733de00d.99a1","type":"api-call-service","z":"433e5229.16b5fc","name":"Disable night mode","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.dafang_night_mode\"}","mergecontext":"","x":648.5,"y":285,"wires":[[]]},{"id":"f6153bbf.683ea8","type":"trigger-state","z":"49017fb.081c18","name":"Motion in hallway upstairs","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_hallway_upstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"sjfjjbvgvx","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"bqj4yi3b2t","targetType":"entity_id","targetValue":"binary_sensor.motion_hallway_upstairs_2","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"elwjd5x125v","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"hhvsnkf4k1l","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":125.142822265625,"y":1593.5714111328125,"wires":[["1bee5099.0dceff"],[]]},{"id":"b11b58bb.aec768","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":121.5,"y":35,"wires":[["107b5696.cc7ec9"],["1de6ff97.cf579"]]},{"id":"d5868603.da5768","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":120,"y":100,"wires":[["107b5696.cc7ec9"],["1de6ff97.cf579"]]},{"id":"f62bd42c.e9b738","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"9000","vt":"num"},{"t":"gt","v":"9000","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":400,"y":240,"wires":[["12a45a7a.3bef46","3551eb41.1e6d74","8a2bf240.b3b77","894f87b2.739fa8"],["8c8d3e09.275e2","733de00d.99a1","6b74d857.60a0c8","a3720dd9.ceab"]]},{"id":"580da1c6.9f871","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.sighthound_xiaofang2_latest\"}","mergecontext":"","x":1800,"y":820,"wires":[[]]},{"id":"1bf329de.9e70e6","type":"cron","z":"433e5229.16b5fc","name":"Every 10 minutes","crontab":"*/10 * * * *","x":100,"y":420,"wires":[["7ea3f6c.c247108","7b1fec9d.04d2fc"]]},{"id":"9b7dd7ba.6013d8","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":560,"wires":[["5e26ef8b.a3f03","3a7b5cf2.324404","c6c01a43.838e48"]]},{"id":"99646c57.0b932","type":"switch","z":"49017fb.081c18","name":"switch motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":369.1428527832031,"y":1534.5714111328125,"wires":[["667e5218.1efd9c","364ca569.51a1ca"],["667e5218.1efd9c"]]},{"id":"2e4154c0.ea9a0c","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":450,"y":240,"wires":[["9a733de6.169e2","b8199be.618b668"],["11de6888.d80bc7","48c3fe9c.969a6","eadca88.ccb4658"]]},{"id":"5e26ef8b.a3f03","type":"delay","z":"433e5229.16b5fc","name":"limit 2 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":390,"y":560,"wires":[["fcc3bee9.e8303","b20fe216.8e5a7"]]},{"id":"c0a16e9d.da64","type":"api-call-service","z":"433e5229.16b5fc","name":"Send notification","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"{\"title\":\"Motion detected\", \"message\":\"Motion in the living room\", \"data\":{\"push\":{\"category\":\"camera\"}, \"entity_id\":\"camera.xiaofang2\"}}","mergecontext":"","x":1390,"y":700,"wires":[[]]},{"id":"44cabfc.e1e914","type":"trigger-state","z":"433e5229.16b5fc","name":"Dafang motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.dafang_motion_sensor","debugenabled":false,"constraints":[{"id":"mr1vt9tokhn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":620,"wires":[["5e26ef8b.a3f03","c6c01a43.838e48","b20fe216.8e5a7"],[]]},{"id":"81a36701.578b58","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for faces","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.facebox_dafang_latest\"}","mergecontext":"","x":1340,"y":660,"wires":[[]]},{"id":"69929a8e.b40824","type":"api-current-state","z":"433e5229.16b5fc","name":"anyone home?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"group.anyone_home","outputs":1,"x":1080,"y":700,"wires":[["c0a16e9d.da64"]]},{"id":"846e3706.3f3e78","type":"trigger-state","z":"49017fb.081c18","name":"Auto lights changed","server":"90ba4a50.2b5e48","entityid":"input_boolean.auto_lights","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"n3iacep121b","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"s5guf96kp69","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":128.0714111328125,"y":306.71429443359375,"wires":[["52b56b7c.c52744"],[]]},{"id":"54f861d9.4a2a","type":"api-call-service","z":"49017fb.081c18","name":"Auto lights on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.auto_lights\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":601,"y":50,"wires":[[]]},{"id":"e9a0b881.92e0e8","type":"trigger-state","z":"bca662a0.a29b2","name":"Door opened?","server":"90ba4a50.2b5e48","entityid":"binary_sensor.main_door","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":129,"y":284,"wires":[[],[]]},{"id":"fbccde46.5481e","type":"api-call-service","z":"bca662a0.a29b2","name":"Departure scan","server":"90ba4a50.2b5e48","service_domain":"mqtt","service":"publish","data":"{\"payload\": \"Start depart scan\", \"topic\": \"monitor/scan/DEPART\", \"qos\": 0, \"retain\": 0}","mergecontext":"","x":620,"y":240,"wires":[[]]},{"id":"e7b99049.b22cc","type":"api-call-service","z":"bca662a0.a29b2","name":"Arrival scan","server":"90ba4a50.2b5e48","service_domain":"mqtt","service":"publish","data":"{\"payload\": \"Start arrival scan\", \"topic\": \"monitor/scan/ARRIVE\", \"qos\": 0, \"retain\": 0}","mergecontext":"","x":610,"y":300,"wires":[[]]},{"id":"f2d11c25.4f011","type":"api-call-service","z":"71ee4f4e.5502","name":"Set playing fortnite on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.anyone_playing_fortnite\"}","mergecontext":"","x":917.5,"y":332,"wires":[[]]},{"id":"5bb67342.45b1ac","type":"api-render-template","z":"71ee4f4e.5502","name":"Teacakess playing","server":"90ba4a50.2b5e48","template":" {{ (as_timestamp(now())-as_timestamp(states.sensor.fortnite_stats_teacakess.last_updated)) < 900 }}","x":904.5,"y":403,"wires":[["8d6d55fa.54ef18"]]},{"id":"5fdd482f.7a98b8","type":"api-render-template","z":"71ee4f4e.5502","name":"Hotky playing","server":"90ba4a50.2b5e48","template":" {{ (as_timestamp(now())-as_timestamp(states.sensor.fortnite_stats_hotky.last_updated)) < 900 }}","x":563,"y":165,"wires":[["8c16a91f.17ea08"]]},{"id":"18a0df89.07048","type":"trigger-state","z":"71ee4f4e.5502","name":"Hotky playing","server":"90ba4a50.2b5e48","entityid":"sensor.fortnite_stats_hotky","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":95.5,"y":369,"wires":[["fb7a3773.26e5c8","8eba660f.f2fbe8"],[]]},{"id":"446f30e6.5c3f5","type":"trigger-state","z":"71ee4f4e.5502","name":"Teacakess playing","server":"90ba4a50.2b5e48","entityid":"sensor.fortnite_stats_teacakess","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":107.5,"y":496,"wires":[["fb7a3773.26e5c8","8eba660f.f2fbe8"],[]]},{"id":"8c16a91f.17ea08","type":"switch","z":"71ee4f4e.5502","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":662.5,"y":365,"wires":[["f2d11c25.4f011"],["5bb67342.45b1ac"]]},{"id":"e258994e.3b40c8","type":"api-call-service","z":"71ee4f4e.5502","name":"Set playing fortnite off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.anyone_playing_fortnite\"}","mergecontext":"","x":1385,"y":416,"wires":[[]]},{"id":"6266d5f6.73b41c","type":"cron","z":"71ee4f4e.5502","name":"Every 15 minutes","crontab":"*/15 * * * *","x":94,"y":439,"wires":[[]]},{"id":"8d6d55fa.54ef18","type":"switch","z":"71ee4f4e.5502","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1140,"y":402,"wires":[["78914ee9.e21cc"],["e258994e.3b40c8"]]},{"id":"78914ee9.e21cc","type":"api-call-service","z":"71ee4f4e.5502","name":"Set playing fortnite on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.anyone_playing_fortnite\"}","mergecontext":"","x":1386,"y":365,"wires":[[]]},{"id":"7f814d96.b78cb4","type":"api-current-state","z":"49017fb.081c18","name":"Sun status","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sun.sun","outputs":1,"x":1549.7222213745117,"y":892.6666593551636,"wires":[["4786eeb2.c32d7"]]},{"id":"4786eeb2.c32d7","type":"switch","z":"49017fb.081c18","name":"above/below_horizon","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"above_horizon","vt":"str"},{"t":"eq","v":"below_horizon","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1778.2222213745117,"y":890.6666593551636,"wires":[[],[]]},{"id":"a336ac3b.39d7d","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.kitchen\",\"brightness_pct\":\"100\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1547.22216796875,"y":935.6666870117188,"wires":[[]]},{"id":"b095642c.340c08","type":"delay","z":"49017fb.081c18","name":"limit 5 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":330,"y":500,"wires":[["b23b7cba.e20698"]]},{"id":"869c4a72.04caa8","type":"trigger-state","z":"49017fb.081c18","name":"Auto lights on","server":"90ba4a50.2b5e48","entityid":"sensor.kitchen_light_level_avg","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"gqwvxau4txu","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"65tcfghun8u","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"v8d8hsu6hsb","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"chv71skniw","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"mfrvwy2kp8e","targetType":"entity_id","targetValue":"input_boolean.gaming_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":580,"wires":[["b095642c.340c08"],[]]},{"id":"aa1cb8ed.bcd0a8","type":"api-current-state","z":"49017fb.081c18","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.sleeping","state_type":"str","outputs":1,"x":1464.857177734375,"y":1514.4285888671875,"wires":[["b6b9da8f.5350e8"]]},{"id":"b6b9da8f.5350e8","type":"switch","z":"49017fb.081c18","name":"on/off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1629.857177734375,"y":1514.4285888671875,"wires":[["cec7afb8.2ff29"],["a409d6dd.ff1678"]]},{"id":"52b56b7c.c52744","type":"api-current-state","z":"49017fb.081c18","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.sleeping","outputs":1,"x":412.5714111328125,"y":306.71429443359375,"wires":[["9a733de6.169e2"]]},{"id":"6bc10e6c.ee162","type":"trigger-state","z":"49017fb.081c18","name":"Sleeping on","server":"90ba4a50.2b5e48","entityid":"binary_sensor.sleeping","debugenabled":false,"constraints":[{"id":"2y7rr6oi6uf","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":100.5,"y":703,"wires":[["47986034.d3ae2"],[]]},{"id":"c7fb92a0.af4e1","type":"status","z":"bca662a0.a29b2","name":"","scope":["64984eb7.b016c"],"x":125,"y":491,"wires":[[]]},{"id":"2a8eebe4.e16944","type":"switch","z":"bca662a0.a29b2","name":"","property":"status.text","propertyType":"msg","rules":[{"t":"eq","v":"connected","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":331,"y":487,"wires":[["a4dc8170.37fa3","f11516d5.daea08"]]},{"id":"a4dc8170.37fa3","type":"debug","z":"bca662a0.a29b2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":556.5,"y":485,"wires":[]},{"id":"f11516d5.daea08","type":"api-call-service","z":"bca662a0.a29b2","name":"Arrival scan","server":"90ba4a50.2b5e48","service_domain":"mqtt","service":"publish","data":"{\"payload\": \"Start arrival scan\", \"topic\": \"monitor/scan/ARRIVE\", \"qos\": 0, \"retain\": 0}","mergecontext":"","x":556,"y":446,"wires":[[]]},{"id":"11e2d04a.4ee55","type":"inject","z":"bca662a0.a29b2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":339.5,"y":446,"wires":[["f11516d5.daea08"]]},{"id":"32541e15.b67962","type":"trigger-state","z":"49017fb.081c18","name":"Auto lights on","server":"90ba4a50.2b5e48","entityid":"input_number.kitchen_true_light_level","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":1080,"wires":[[],[]]},{"id":"eb7f1c7a.265b7","type":"function","z":"49017fb.081c18","name":"Get light level","func":"msg.payload = flow.get('kitchen_light_level') || 0;\nreturn msg;","outputs":1,"noerr":0,"x":1982.8572845458984,"y":974.2857151031494,"wires":[[]]},{"id":"5f4ac7b5.752bc8","type":"trigger-state","z":"407269cb.c12fd8","name":"Motion on","server":"90ba4a50.2b5e48","entityid":"sensor.downstairs_motion_sensors","debugenabled":false,"constraints":[{"id":"cr35bk7njmp","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"e7195raae37","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":120,"wires":[["e07b12e4.687aa"],[]]},{"id":"d3336363.a44f1","type":"trigger-state","z":"407269cb.c12fd8","name":"Media players on","server":"90ba4a50.2b5e48","entityid":"sensor.downstairs_media_players","debugenabled":false,"constraints":[{"id":"cr35bk7njmp","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"i2r1rt1qmfk","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":1030,"y":280,"wires":[["790a7577.4a647c"],[]]},{"id":"790a7577.4a647c","type":"api-call-service","z":"407269cb.c12fd8","name":"Someone downstairs on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.someone_downstairs\"}","mergecontext":"","x":1230,"y":180,"wires":[[]]},{"id":"e07b12e4.687aa","type":"time-range-switch","z":"407269cb.c12fd8","name":"","lat":"","lon":"","startTime":"00:00","endTime":"6:00","startOffset":0,"endOffset":0,"x":330,"y":120,"wires":[["b6166a93.c1f8b8"],["b6166a93.c1f8b8"]]},{"id":"439918ac.c3d338","type":"api-current-state","z":"407269cb.c12fd8","name":"Upstairs motion","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.motion_hallway_upstairs_2","outputs":1,"x":560,"y":40,"wires":[["57d74a9f.fd7b54"]]},{"id":"57d74a9f.fd7b54","type":"api-current-state","z":"407269cb.c12fd8","name":"stairs motion","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.motion_hallway_upstairs","outputs":1,"x":730,"y":40,"wires":[[]]},{"id":"e9aaa9c7.1c52b8","type":"time-range-switch","z":"407269cb.c12fd8","name":"","lat":"","lon":"","startTime":"00:00","endTime":"6:00","startOffset":0,"endOffset":0,"x":323.5,"y":795,"wires":[["1c5c0e.da6c03f2"],["e2263efb.18a9b"]]},{"id":"c3514559.70dc18","type":"trigger-state","z":"407269cb.c12fd8","name":"No motion","server":"90ba4a50.2b5e48","entityid":"sensor.downstairs_motion_sensors","debugenabled":false,"constraints":[{"id":"i65bpqp1uvp","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"1iaf66b6xch","targetType":"entity_id","targetValue":"sensor.downstairs_media_players","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"3x2k33d0dg5","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":800,"wires":[["e9aaa9c7.1c52b8"],[]]},{"id":"1c5c0e.da6c03f2","type":"stoptimer","z":"407269cb.c12fd8","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":545,"y":792,"wires":[["54336d4a.7396f4"],[]]},{"id":"f76e655.cefb398","type":"api-call-service","z":"407269cb.c12fd8","name":"Someone downstairs off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.someone_downstairs\"}","mergecontext":"","x":1870,"y":780,"wires":[[]]},{"id":"a2de2b00.f38e98","type":"api-call-service","z":"433e5229.16b5fc","name":"Record video","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"dafang_motion_on","data":"","mergecontext":"","x":1110,"y":2080,"wires":[[]]},{"id":"d4fb2c6f.8005a","type":"stoptimer","z":"433e5229.16b5fc","duration":"30","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":666,"y":2122,"wires":[["1a416ff8.e5685"],[]]},{"id":"a5423020.07e08","type":"api-call-service","z":"433e5229.16b5fc","name":"Stop video","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"dafang_motion_off","data":"","mergecontext":"","x":1103,"y":2122,"wires":[[]]},{"id":"22d66803.b3c5c8","type":"trigger-state","z":"433e5229.16b5fc","name":"Living room motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.living_room_motion_sensor","debugenabled":false,"constraints":[{"id":"85m1kaqp0r","targetType":"entity_id","targetValue":"vacuum.eve","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"cleaning"},{"id":"k8upvfalxfl","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":154,"y":2071,"wires":[[],[]]},{"id":"1a416ff8.e5685","type":"api-current-state","z":"433e5229.16b5fc","name":"Motion on?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.living_room_motion_sensor","outputs":1,"x":897,"y":2121,"wires":[["a5423020.07e08"]]},{"id":"1bee5099.0dceff","type":"switch","z":"49017fb.081c18","name":"switch motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":373,"y":1590,"wires":[["667e5218.1efd9c","4de486f3.053868"],["667e5218.1efd9c"]]},{"id":"524b712c.b701f","type":"switch","z":"f9c72e13.30015","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"14000","vt":"num"},{"t":"gt","v":"15000","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":303.05548095703125,"y":364,"wires":[["6e433254.87cb4c","2e22dc59.a9a6b4"],[]]},{"id":"edcaa1f7.6f3ba","type":"switch","z":"f9c72e13.30015","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"17000","vt":"num"},{"t":"gt","v":"17500","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":302.55548095703125,"y":424,"wires":[["6e433254.87cb4c","2e22dc59.a9a6b4"],[]]},{"id":"2e22dc59.a9a6b4","type":"range","z":"f9c72e13.30015","minin":"14000","maxin":"17500","minout":"10","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":490.55550384521484,"y":414.99999618530273,"wires":[[]]},{"id":"6e433254.87cb4c","type":"range","z":"f9c72e13.30015","minin":"13500","maxin":"17000","minout":"10","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":491.55550384521484,"y":362.99999618530273,"wires":[[]]},{"id":"9a26a17e.96352","type":"function","z":"f9c72e13.30015","name":"Get light level","func":"msg.payload = flow.get('light') || 0;\nreturn msg;","outputs":1,"noerr":0,"x":123.99993896484375,"y":362.111083984375,"wires":[["524b712c.b701f"]]},{"id":"7161058e.d20bdc","type":"function","z":"f9c72e13.30015","name":"Get light level","func":"msg.payload = flow.get('light') || 0;\nreturn msg;","outputs":1,"noerr":0,"x":117,"y":423,"wires":[["edcaa1f7.6f3ba"]]},{"id":"289f02d9.27fbce","type":"trigger-state","z":"49017fb.081c18","name":"Door opened","server":"90ba4a50.2b5e48","entityid":"binary_sensor.main_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"z9wwt35jpp","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":97.22222137451172,"y":1735.5555572509766,"wires":[["e656d695.4272d8"],[]]},{"id":"c2820347.ff15b","type":"api-call-service","z":"49017fb.081c18","name":"entrance light on","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.hallway_downstairs\",\"brightness_pct\":5}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":590,"y":1720,"wires":[[]]},{"id":"e656d695.4272d8","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":301.1111068725586,"y":1733.3333339691162,"wires":[["c2820347.ff15b","8b9ecc1b.6b506","453f6585.bdd74c"],["8b9ecc1b.6b506"]]},{"id":"8b9ecc1b.6b506","type":"stoptimer","z":"49017fb.081c18","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"2 min","x":542.2222099304199,"y":1782.2221431732178,"wires":[["28d55373.99ce7c"],[]]},{"id":"28d55373.99ce7c","type":"api-call-service","z":"49017fb.081c18","name":"entrance light off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.hallway_downstairs\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":897.7777709960938,"y":1784.4443264007568,"wires":[[]]},{"id":"4de486f3.053868","type":"api-current-state","z":"49017fb.081c18","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.sleeping","state_type":"str","outputs":1,"x":1463,"y":1574,"wires":[["37a402d1.ce1d2e"]]},{"id":"37a402d1.ce1d2e","type":"switch","z":"49017fb.081c18","name":"on/off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1628,"y":1574,"wires":[["89beb86a.7bd448"],["a409d6dd.ff1678"]]},{"id":"89beb86a.7bd448","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.hallway_upstairs\", \"brightness_pct\": \"1\"}","mergecontext":"","x":2070,"y":1600,"wires":[[]]},{"id":"5a28c2dc.95560c","type":"switch","z":"49017fb.081c18","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"10000","vt":"num"},{"t":"gt","v":"10000","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":1460,"y":440,"wires":[["97400095.585bf","aa0985b8.dd3b28"],["d9950693.a7ecf8"]]},{"id":"e93822ad.d0e1a","type":"function","z":"49017fb.081c18","name":"Get light level","func":"msg.payload = parseInt(flow.get('kitchen_light_level')) || 0;\nreturn msg;","outputs":1,"noerr":0,"x":1200,"y":480,"wires":[[]]},{"id":"5fdff5ea.c385dc","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":540,"wires":[["b23b7cba.e20698"]]},{"id":"97400095.585bf","type":"range","z":"49017fb.081c18","minin":"8000","maxin":"11000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":2170,"y":480,"wires":[["485ce41c.1d7a1c"]]},{"id":"26df1513.e59bea","type":"range","z":"49017fb.081c18","minin":"6500","maxin":"11000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":2170,"y":440,"wires":[["9d739a2d.a22e98","3f671223.f9b4fe"]]},{"id":"e419442d.f285d8","type":"api-current-state","z":"49017fb.081c18","name":"anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.someone_downstairs","outputs":1,"x":820,"y":500,"wires":[["5e3c6055.f6cce"]]},{"id":"db5fa541.a15658","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1420.5,"y":766,"wires":[["abb737b6.20bd88"]]},{"id":"73694318.aaa90c","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":400,"y":2080,"wires":[["d4fb2c6f.8005a","2991e4c6.a53fbc"],["d4fb2c6f.8005a"]]},{"id":"c1206501.b0d7b8","type":"api-current-state","z":"433e5229.16b5fc","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.sleeping","outputs":1,"x":980,"y":2000,"wires":[["a2de2b00.f38e98"]]},{"id":"8131f2c3.9e979","type":"trigger-state","z":"407269cb.c12fd8","name":"Anyone home","server":"90ba4a50.2b5e48","entityid":"group.anyone_home","debugenabled":false,"constraints":[{"id":"zm5o3gs7jhi","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":720,"y":720,"wires":[["f76e655.cefb398"],[]]},{"id":"7182baf1.284734","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tiia leaving work","server":"90ba4a50.2b5e48","entityid":"device_tracker.tiias_iphone","debugenabled":false,"constraints":[{"id":"dfg68etg4tc","targetType":"entity_id","targetValue":"sensor.tiia_travel_time","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"greater_than","comparatorValueDatatype":"num","comparatorValue":"20"},{"id":"10b4hlihnih","targetType":"entity_id","targetValue":"sensor.tiia_travel_time","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"less_than","comparatorValueDatatype":"num","comparatorValue":"20"},{"id":"xaxzo73not","targetType":"entity_id","targetValue":"input_boolean.arrival_notifications","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"ive63i5tlw","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"ayaw083tjgs","targetType":"entity_id","targetValue":"input_boolean.guest_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130.5,"y":470,"wires":[["95713185.d1ca7"],[]]},{"id":"95713185.d1ca7","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Travel time tiia","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.tiia_travel_time","outputs":1,"x":373.5,"y":473,"wires":[["76780d55.637884","c1faa9bc.631228","8f22a607.ac1e98"]]},{"id":"76780d55.637884","type":"template","z":"c84fe94a.0c50b8","name":"TTS Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.black_sonos_one\", \"message\":\"Teea just left work, she will be home in {{payload}} minutes\"}}","output":"str","x":585.5,"y":473,"wires":[[]]},{"id":"a8719c43.985bc","type":"inject","z":"c84fe94a.0c50b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":154.5,"y":573,"wires":[["95713185.d1ca7"]]},{"id":"c1faa9bc.631228","type":"template","z":"c84fe94a.0c50b8","name":"TTS Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.beam\", \"message\":\"Teea just left work, she will be home in {{payload}} minutes\"}}","output":"str","x":594,"y":519,"wires":[[]]},{"id":"8f22a607.ac1e98","type":"template","z":"c84fe94a.0c50b8","name":"TTS Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Teea just left work, she will be home in {{payload}} minutes","output":"str","x":596,"y":566,"wires":[["f489c00a.b6d43"]]},{"id":"fb7a3773.26e5c8","type":"api-call-service","z":"71ee4f4e.5502","name":"Set playing fortnite on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.anyone_playing_fortnite\"}","mergecontext":"","x":400,"y":396,"wires":[[]]},{"id":"8eba660f.f2fbe8","type":"stoptimer","z":"71ee4f4e.5502","duration":"30","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":381.5,"y":447,"wires":[["f750b148.df751"],[]]},{"id":"f750b148.df751","type":"api-call-service","z":"71ee4f4e.5502","name":"Set playing fortnite off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.anyone_playing_fortnite\"}","mergecontext":"","x":676,"y":441,"wires":[[]]},{"id":"34156414.59087c","type":"trigger-state","z":"433e5229.16b5fc","name":"","server":"90ba4a50.2b5e48","entityid":"input_boolean.someone_downstairs","debugenabled":false,"constraints":[{"id":"1yvfhrxv4z7","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":303.5,"y":2262,"wires":[[],[]]},{"id":"b177f5a6.2d0908","type":"stoptimer","z":"433e5229.16b5fc","duration":"30","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":664,"y":2259,"wires":[["a5423020.07e08"],[]]},{"id":"46e394ff.0815ec","type":"api-call-service","z":"49017fb.081c18","name":"Nightlight on","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.gateway\", \"brightness_pct\": \"10\"}","mergecontext":"","x":1810,"y":1474,"wires":[[]]},{"id":"2d3b1c70.7b2944","type":"api-call-service","z":"49017fb.081c18","name":"Nightlight off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.gateway\"}","mergecontext":"","x":1053,"y":1555,"wires":[[]]},{"id":"b174f268.56659","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1500.5,"y":1461,"wires":[["cec7afb8.2ff29"]]},{"id":"e1b8851.d303878","type":"trigger-state","z":"407269cb.c12fd8","name":"Door opened","server":"90ba4a50.2b5e48","entityid":"binary_sensor.main_door","debugenabled":false,"constraints":[{"id":"a7fouzv5zw","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":110,"y":280,"wires":[["38e51cbf.315ad4","f1e8fa35.a5b298","55ebae9e.35723"],[]]},{"id":"38e51cbf.315ad4","type":"api-current-state","z":"407269cb.c12fd8","name":"Luca home","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"device_tracker.sevenplusha","outputs":1,"x":370,"y":240,"wires":[["5aa69a3f.7be9e4"]]},{"id":"f1e8fa35.a5b298","type":"api-current-state","z":"407269cb.c12fd8","name":"Tiia home","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"device_tracker.tiias_iphone","outputs":1,"x":349,"y":277,"wires":[["5aa69a3f.7be9e4"]]},{"id":"5aa69a3f.7be9e4","type":"switch","z":"407269cb.c12fd8","name":"home","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"home","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":253,"wires":[["341d19bb.bc5456"]]},{"id":"d1e9471c.e419d8","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Washing machine done","server":"90ba4a50.2b5e48","entityid":"input_boolean.washing_machine","debugenabled":false,"constraints":[{"id":"t12raod18kl","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":152,"y":728,"wires":[["f02f0d88.8ae7a","ab379b4d.2438a8"],[]]},{"id":"a9aa7a6a.5c0318","type":"api-call-service","z":"49017fb.081c18","name":"Dashboard on 30","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.dashboard_kitchen\", \"brightness_pct\":30}","mergecontext":"","x":1582,"y":793,"wires":[[]]},{"id":"f8561d3a.69b4","type":"api-call-service","z":"49017fb.081c18","name":"Dashboard on 100","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.dashboard_kitchen\", \"brightness_pct\":100}","mergecontext":"","x":1594,"y":978,"wires":[[]]},{"id":"7571b3ac.d2fdac","type":"api-call-service","z":"49017fb.081c18","name":"Dashboard off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.dashboard_kitchen\"}","mergecontext":"","x":1000,"y":980,"wires":[[]]},{"id":"da9a3b76.ac2848","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":760,"y":1000,"wires":[["7571b3ac.d2fdac"]]},{"id":"3a7b5cf2.324404","type":"delay","z":"433e5229.16b5fc","name":"limit 2 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":423,"y":761,"wires":[["bac121cb.cbf15"]]},{"id":"796903b4.fd8ebc","type":"trigger-state","z":"433e5229.16b5fc","name":"Xiaofang2 motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.xiaofang2_motion_sensor","debugenabled":false,"constraints":[{"id":"mr1vt9tokhn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"apr2x6nifl","targetType":"entity_id","targetValue":"input_boolean.privacy_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":109,"y":868,"wires":[["c6c01a43.838e48","7fb0939b.f81efc","326ffe9c.f0d44a"],[]]},{"id":"c6c01a43.838e48","type":"delay","z":"433e5229.16b5fc","name":"limit 2 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":390,"y":860,"wires":[["4d6871b8.ffb39"]]},{"id":"fddfc8c8.62ede8","type":"stoptimer","z":"433e5229.16b5fc","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":930,"y":920,"wires":[["e9666cfe.3c42d","68c97ad1.c52504","dff0cf02.d364b"],[]]},{"id":"78e19ce3.678fe4","type":"trigger-state","z":"433e5229.16b5fc","name":"Kitchen","server":"90ba4a50.2b5e48","entityid":"sensor.motion_kitchen","debugenabled":false,"constraints":[{"id":"mr1vt9tokhn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":80,"y":680,"wires":[["1d6be3db.f47acc"],[]]},{"id":"94fb9e9b.c44e7","type":"mqtt out","z":"433e5229.16b5fc","name":"Night Mode Xiaofang2 Set","topic":"diningroom/xiaofang2/night_mode/set","qos":"","retain":"true","broker":"e9e87280.3fdb9","x":1075,"y":205,"wires":[]},{"id":"12a45a7a.3bef46","type":"template","z":"433e5229.16b5fc","name":"ON","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"ON","output":"str","x":810,"y":212,"wires":[["94fb9e9b.c44e7"]]},{"id":"751fb4da.a5f4bc","type":"mqtt out","z":"433e5229.16b5fc","name":"Night Mode Xiaofang1 Set","topic":"kitchen/xiaofang1/night_mode/set","qos":"","retain":"true","broker":"e9e87280.3fdb9","x":1120,"y":360,"wires":[]},{"id":"fff2ef04.4bcdc","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"10000","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":180,"wires":[["f62bd42c.e9b738"]]},{"id":"8c8d3e09.275e2","type":"template","z":"433e5229.16b5fc","name":"OFF","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"OFF","output":"str","x":811.5,"y":255,"wires":[["94fb9e9b.c44e7"]]},{"id":"cc3f2acb.07c958","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":869.5,"y":2281,"wires":[["a5423020.07e08"]]},{"id":"ba85021a.3adc4","type":"api-current-state","z":"433e5229.16b5fc","name":"anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_downstairs","outputs":1,"x":500,"y":460,"wires":[["c6c01a43.838e48"]]},{"id":"55ebae9e.35723","type":"api-current-state","z":"407269cb.c12fd8","name":"Anyone home","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_home","outputs":1,"x":368,"y":317,"wires":[["341d19bb.bc5456"]]},{"id":"341d19bb.bc5456","type":"delay","z":"407269cb.c12fd8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":715.5,"y":270,"wires":[["790a7577.4a647c"]]},{"id":"be26f812.5e9278","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_dafang_5bd486373f1745fe\"}","mergecontext":"","x":1600,"y":520,"wires":[[]]},{"id":"302d316f.f8fc5e","type":"api-call-service","z":"49017fb.081c18","name":"Dashboard on 30","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.dashboard_kitchen\", \"brightness_pct\":20}","mergecontext":"","x":1830,"y":1060,"wires":[[]]},{"id":"79a18428.38e95c","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1480,"y":1080,"wires":[["302d316f.f8fc5e"]]},{"id":"9d3170a9.02f0b","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people eating","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_xiaofang2_latest_eating_model\"}","mergecontext":"","x":1780,"y":860,"wires":[[]]},{"id":"7fb0939b.f81efc","type":"delay","z":"433e5229.16b5fc","name":"limit 10 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":890,"y":700,"wires":[["69929a8e.b40824"]]},{"id":"470ca4f1.b3308c","type":"debug","z":"49017fb.081c18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2790,"y":780,"wires":[]},{"id":"1d6be3db.f47acc","type":"stoptimer","z":"433e5229.16b5fc","duration":"3","units":"Second","payloadtype":"num","payloadval":"0","name":"2s","x":210,"y":700,"wires":[["cc22bf5.893634"],[]]},{"id":"f02f0d88.8ae7a","type":"function","z":"c84fe94a.0c50b8","name":"Format message","func":"msg.payload = { data: \n    {'message': 'The laundry is done', \n        data: \n            { push: \n                {'badge':'0',\n                'category':'laundry',\n                'action_data':\n                    {'entity_id':'switch.air_conditioner'}\n                }\n            }\n    }\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":551,"y":693,"wires":[["ed3ba9de.34eee8","9496dc32.4f79d"]]},{"id":"ed3ba9de.34eee8","type":"api-call-service","z":"c84fe94a.0c50b8","name":"notify sevenplus","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"","mergecontext":"","x":790,"y":665,"wires":[[]]},{"id":"9496dc32.4f79d","type":"api-call-service","z":"c84fe94a.0c50b8","name":"notify tiia","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_tiias_iphone","data":"","mergecontext":"","x":772,"y":711,"wires":[[]]},{"id":"9f48367f.4850d8","type":"server-state-changed","z":"a1f7f54.5d30108","name":"Coming home","server":"90ba4a50.2b5e48","entityidfilter":"group.anyone_home","entityidfiltertype":"substring","outputinitially":false,"haltifstate":"off","outputs":1,"x":110,"y":1060,"wires":[["cc9476e1.8b5278"]]},{"id":"f0e8e1ae.cb6bb","type":"api-call-service","z":"a1f7f54.5d30108","name":"Set to Max","server":"90ba4a50.2b5e48","service_domain":"vacuum","service":"set_fan_speed","data":"{\"entity_id\":\"vacuum.eve\", \"fan_speed\":\"Max\"}","mergecontext":"","x":310,"y":300,"wires":[[]]},{"id":"cc9476e1.8b5278","type":"api-call-service","z":"a1f7f54.5d30108","name":"Set to Quiet","server":"90ba4a50.2b5e48","service_domain":"vacuum","service":"set_fan_speed","data":"{\"entity_id\":\"vacuum.eve\", \"fan_speed\":\"Quiet\"}","mergecontext":"","x":310,"y":1120,"wires":[[]]},{"id":"c219e06b.6224a","type":"inject","z":"a1f7f54.5d30108","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":300,"wires":[["f0e8e1ae.cb6bb","15773551.1b658b"]]},{"id":"af460346.def7f","type":"cron","z":"433e5229.16b5fc","name":"Every hour","crontab":"0 * * * *","x":78,"y":821,"wires":[["c6c01a43.838e48","3a7b5cf2.324404","5e26ef8b.a3f03"]]},{"id":"294cb9e5.240f16","type":"api-render-template","z":"a1f7f54.5d30108","name":"Recently vacuumed","server":"90ba4a50.2b5e48","template":"{{ (as_timestamp(now())-as_timestamp(states.input_datetime.last_time_dining_area_vacuumed.state))\n    < 18000 }}","x":590,"y":460,"wires":[["6aa02e52.79e34"]]},{"id":"6aa02e52.79e34","type":"switch","z":"a1f7f54.5d30108","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":790,"y":460,"wires":[["fbdb9c96.ce13e","2eb67c41.ea768c"],["a2285244.9d73d","ab3d81cd.9f12b"]]},{"id":"a2285244.9d73d","type":"api-call-service","z":"a1f7f54.5d30108","name":"Schedule apartment","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.schedule_cleaning\"}","mergecontext":"","x":1040,"y":580,"wires":[[]]},{"id":"1473671b.d19229","type":"trigger-state","z":"a1f7f54.5d30108","name":"Dining area cleaning scheduled","server":"90ba4a50.2b5e48","entityid":"input_boolean.schedule_dining_area_cleaning","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":150,"y":120,"wires":[["c69c276.1fad6d8"],[]]},{"id":"db370d54.8a0de","type":"trigger-state","z":"a1f7f54.5d30108","name":"Living room cleaning scheduled","server":"90ba4a50.2b5e48","entityid":"input_boolean.schedule_livingroom_cleaning","debugenabled":false,"constraints":[{"id":"8g3la2rz4ph","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":157,"y":156,"wires":[["c69c276.1fad6d8","bcfc99f2.e3ee08"],[]]},{"id":"d800785f.861288","type":"trigger-state","z":"a1f7f54.5d30108","name":"Kitchen cleaning scheduled","server":"90ba4a50.2b5e48","entityid":"input_boolean.schedule_kitchen_cleaning","debugenabled":false,"constraints":[{"id":"sh0my0x3rrr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":144,"y":71,"wires":[["c69c276.1fad6d8","bcfc99f2.e3ee08"],[]]},{"id":"af327ed1.6f1c","type":"trigger-state","z":"a1f7f54.5d30108","name":"Cleaning scheduled","server":"90ba4a50.2b5e48","entityid":"input_boolean.schedule_cleaning","debugenabled":false,"constraints":[{"id":"sh0my0x3rrr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":115,"y":29,"wires":[["c69c276.1fad6d8","bcfc99f2.e3ee08"],[]]},{"id":"bcfc99f2.e3ee08","type":"debug","z":"a1f7f54.5d30108","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":487.5,"y":68,"wires":[]},{"id":"2fa26f11.979c5","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2400,"y":220,"wires":[["e3698a60.6a6f58"]]},{"id":"6a3ec68f.363208","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2400,"y":280,"wires":[["beb67240.2e462"]]},{"id":"335ce7ed.ba8a48","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2400,"y":120,"wires":[["b098cba0.1a5508","a2b69f83.29e9d"]]},{"id":"645ee716.d24eb8","type":"stoptimer","z":"49017fb.081c18","duration":"15","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1593.5,"y":1030,"wires":[["302d316f.f8fc5e"],[]]},{"id":"63721a6c.1761c4","type":"stoptimer","z":"49017fb.081c18","duration":"30","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1830,"y":1120,"wires":[["4886f4fc.916d7c"],[]]},{"id":"4886f4fc.916d7c","type":"api-call-service","z":"49017fb.081c18","name":"Dashboard off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.dashboard_kitchen\"}","mergecontext":"","x":2100,"y":1120,"wires":[[]]},{"id":"87fc88b0.5a40f8","type":"api-call-service","z":"a1f7f54.5d30108","name":"clean dining area and kitchen","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.vacuum_clean_dining_area_kitchen\"}","mergecontext":"","x":1820,"y":440,"wires":[[]]},{"id":"ab3d81cd.9f12b","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":400,"wires":[["15773551.1b658b"]]},{"id":"fbdb9c96.ce13e","type":"api-call-service","z":"a1f7f54.5d30108","name":"Schedule dining area cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.schedule_dining_area_cleaning\"}","mergecontext":"","x":1070,"y":520,"wires":[[]]},{"id":"ff0b600e.60a33","type":"time-range-switch","z":"a1f7f54.5d30108","name":"between 09:00 and 20:00","lat":"","lon":"","startTime":"09:00","endTime":"21:00","startOffset":0,"endOffset":0,"x":330,"y":480,"wires":[["294cb9e5.240f16"],["fbdb9c96.ce13e"]]},{"id":"cbded9ef.6f9198","type":"api-current-state","z":"49017fb.081c18","name":"Kitchen avg","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.kitchen_light_level_avg","outputs":1,"x":1190,"y":420,"wires":[["5a28c2dc.95560c"]]},{"id":"95a4183c.011ba8","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_xiaofang2_livingroom_presence\"}","mergecontext":"","x":1740,"y":1240,"wires":[[]]},{"id":"ef0b686a.2a3428","type":"trigger","z":"433e5229.16b5fc","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-10","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":690,"y":1500,"wires":[["e09869c5.c22478"]]},{"id":"73d25429.31adfc","type":"change","z":"433e5229.16b5fc","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":1560,"wires":[["ef0b686a.2a3428"]]},{"id":"f3f2de50.754f4","type":"trigger-state","z":"433e5229.16b5fc","name":"Kitchen motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.kitchen_motion_sensor","debugenabled":false,"constraints":[{"id":"k5nd5iwevwj","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":140,"y":1500,"wires":[[],[]]},{"id":"7ebda557.87c59c","type":"switch","z":"433e5229.16b5fc","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":310,"y":1500,"wires":[["ef0b686a.2a3428"],["73d25429.31adfc"]]},{"id":"e09869c5.c22478","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for fridge","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tagbox_xiaofang1\"}","mergecontext":"","x":960,"y":1500,"wires":[[]]},{"id":"eb31b2be.33cf9","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1580,"wires":[["ef0b686a.2a3428"]]},{"id":"bf922a0f.76bc48","type":"trigger-state","z":"a1f7f54.5d30108","name":"Eating","server":"90ba4a50.2b5e48","entityid":"binary_sensor.eating","debugenabled":false,"constraints":[{"id":"v1fcez09knb","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"6muk4qbom9f","targetType":"entity_id","targetValue":"input_boolean.guest_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":80,"y":580,"wires":[["4cb609c9.93e608"],[]]},{"id":"4cb609c9.93e608","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"11","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":250,"y":580,"wires":[["cd9c70a7.cb836"]]},{"id":"cd9c70a7.cb836","type":"api-current-state","z":"a1f7f54.5d30108","name":"Eating?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.eating","outputs":1,"x":200,"y":540,"wires":[["68be724f.b6a96c"]]},{"id":"5e3c6055.f6cce","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1010,"y":500,"wires":[["cbded9ef.6f9198"],["48f63ea3.83c36"]]},{"id":"7580c355.d0be1c","type":"api-render-template","z":"a1f7f54.5d30108","name":"Recently vacuumed","server":"90ba4a50.2b5e48","template":"{{ (as_timestamp(now())-as_timestamp(states.input_datetime.last_time_hallway_vacuumed.state))\n    < 14400  }}","x":790,"y":1040,"wires":[["7fcb9696.d02a98"]]},{"id":"7fcb9696.d02a98","type":"switch","z":"a1f7f54.5d30108","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":990,"y":1040,"wires":[[],["95f5f43c.b8fce8"]]},{"id":"95f5f43c.b8fce8","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1180,"y":1040,"wires":[["c9f94ccb.534aa"]]},{"id":"37b25fcb.1709d","type":"api-call-service","z":"a1f7f54.5d30108","name":"Clean hallway","server":"90ba4a50.2b5e48","service_domain":"script","service":"vacuum_clean_hallway","data":"","mergecontext":"","x":1500,"y":1040,"wires":[[]]},{"id":"a2b039aa.cceda8","type":"api-call-service","z":"433e5229.16b5fc","name":"camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{\"entity_id\": \"camera.xiaofang2\", \"filename\": \"/images/not_eating/{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg\" }","mergecontext":"","x":1070,"y":2620,"wires":[[]]},{"id":"1df2a590.9e94ca","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":1680,"wires":[[]]},{"id":"f3102e73.cc0d6","type":"api-current-state","z":"a1f7f54.5d30108","name":"should kitchen be cleaned?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.schedule_kitchen_cleaning","outputs":1,"x":1320,"y":480,"wires":[["d444bd3e.ec652"]]},{"id":"d444bd3e.ec652","type":"switch","z":"a1f7f54.5d30108","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1530,"y":480,"wires":[["87fc88b0.5a40f8","b08c947b.3a2c18"],["c1f19376.6ccb5"]]},{"id":"61504f18.70e02","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule kitchen cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_kitchen_cleaning\"}","mergecontext":"","x":2360,"y":460,"wires":[[]]},{"id":"c1f19376.6ccb5","type":"api-call-service","z":"a1f7f54.5d30108","name":"clean dining area","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on","data":"{\"entity_id\":\"script.vacuum_clean_dining\"}","mergecontext":"","x":1870,"y":500,"wires":[[]]},{"id":"7ea3f6c.c247108","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for kitchen lights","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_xiaofang1_kitchen_lights_model\"}","mergecontext":"","x":620,"y":660,"wires":[[]]},{"id":"cc22bf5.893634","type":"api-current-state","z":"433e5229.16b5fc","name":"Kitchen motion?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.kitchen_motion_sensors","outputs":1,"x":400,"y":700,"wires":[["3a7b5cf2.324404","7ea3f6c.c247108"]]},{"id":"db92785a.f9a868","type":"time-range-switch","z":"a1f7f54.5d30108","name":"between 16:00 and 20:00","lat":"","lon":"","startTime":"12:00","endTime":"20:00","startOffset":0,"endOffset":0,"x":530,"y":1040,"wires":[["7580c355.d0be1c"],[]]},{"id":"2991e4c6.a53fbc","type":"api-current-state","z":"433e5229.16b5fc","name":"anyone home?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"group.anyone_home","outputs":1,"x":600,"y":2020,"wires":[["bcb7db32.0cdd48"]]},{"id":"bcb7db32.0cdd48","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":800,"y":2020,"wires":[["c1206501.b0d7b8"],["a2de2b00.f38e98"]]},{"id":"f23d3c1a.081c6","type":"trigger-state","z":"a1f7f54.5d30108","name":"should vacuum","server":"90ba4a50.2b5e48","entityid":"binary_sensor.should_vacuum","debugenabled":false,"constraints":[{"id":"mm0ums27v2","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"0tck9vix0stf","targetType":"entity_id","targetValue":"input_boolean.guest_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":80,"y":440,"wires":[["9fe43153.438d8","ff0b600e.60a33"],[]]},{"id":"f9c81ee4.4b6df","type":"alexa-home","z":"a1f7f54.5d30108","conf":"cb07a23c.1bf87","device":"36062","acknoledge":true,"name":"Cleaning","topic":"","x":100,"y":360,"wires":[["15773551.1b658b"]]},{"id":"3eb43874.ef06d8","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_xiaofang1_latest\"}","mergecontext":"","x":1020,"y":800,"wires":[[]]},{"id":"38740bcc.f774f4","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_dafang\"}","mergecontext":"","x":1240,"y":600,"wires":[[]]},{"id":"b23b7cba.e20698","type":"api-current-state","z":"49017fb.081c18","name":"auto lights","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":false,"override_payload":false,"entity_id":"input_boolean.auto_lights","outputs":1,"x":630,"y":500,"wires":[["e419442d.f285d8"]]},{"id":"d0d73de3.57d38","type":"trigger-state","z":"69646b1e.2e5084","name":"Movie Mode on","server":"90ba4a50.2b5e48","entityid":"input_boolean.movie_mode","debugenabled":false,"constraints":[{"id":"7vslqjqspho","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":80,"y":520,"wires":[["cac418b6.ae7be8"],[]]},{"id":"e4105ea2.ae052","type":"trigger-state","z":"69646b1e.2e5084","name":"Chromecast playing","server":"90ba4a50.2b5e48","entityid":"media_player.living_room_tv","debugenabled":false,"constraints":[{"id":"bfi2hfwdn3e","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"atucqcml947","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":640,"wires":[["2c188708.6396b"],[]]},{"id":"e154ef7a.39bec","type":"trigger-state","z":"69646b1e.2e5084","name":"TV on","server":"90ba4a50.2b5e48","entityid":"media_player.lg_webos_smart_tv","debugenabled":false,"constraints":[{"id":"fokt90uudsn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"},{"id":"wowjtcifl98","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"y6pxrul6dr7","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":180,"wires":[["8fcea139.75de3"],[]]},{"id":"f38a12b1.2dce9","type":"inject","z":"69646b1e.2e5084","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 21 * * *","once":false,"onceDelay":0.1,"x":110,"y":240,"wires":[["e84d63.473cb2a"]]},{"id":"52912682.455928","type":"api-call-service","z":"69646b1e.2e5084","name":"Movie Mode on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.movie_mode\"}","mergecontext":"","x":640,"y":180,"wires":[[]]},{"id":"48f63ea3.83c36","type":"api-call-service","z":"49017fb.081c18","name":"Turn off lights downstairs","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"group.downstairs_lights\"}","mergecontext":"","x":1450,"y":660,"wires":[[]]},{"id":"dd6a86a7.e73f38","type":"api-call-service","z":"69646b1e.2e5084","name":"Paperlight","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.paperlight\", \"transition\":60}","mergecontext":"","x":1020,"y":740,"wires":[[]]},{"id":"5c874ea1.893fe","type":"api-call-service","z":"69646b1e.2e5084","name":"Big light","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.big_light\", \"brightness_pct\": 30, \"transition\": 30}","mergecontext":"","x":620,"y":740,"wires":[[]]},{"id":"1ecb987.2f13968","type":"api-call-service","z":"69646b1e.2e5084","name":"living room light","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.living_room\", \"transition\": 60}","mergecontext":"","x":1700,"y":420,"wires":[[]]},{"id":"f0443724.cb9918","type":"api-render-template","z":"69646b1e.2e5084","name":"Movie or Gaming Mode on?","server":"90ba4a50.2b5e48","template":"{% if is_state(\"input_boolean.movie_mode\", \"on\") -%}\n1\n{%- elif is_state(\"input_boolean.gaming_mode\", \"on\") -%}\n2\n{% else %}\n0\n{%- endif %}","x":1360,"y":540,"wires":[["c3e1dd8a.183d9"]]},{"id":"c3e1dd8a.183d9","type":"switch","z":"69646b1e.2e5084","name":"0/1/2","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"false","repair":false,"outputs":3,"x":1570,"y":540,"wires":[[],["1ecb987.2f13968","d558f5aa.1d85c8","3a708f22.39be1"],["7d681094.08465"]]},{"id":"964c256e.a99ef8","type":"template","z":"69646b1e.2e5084","name":"Desk light blue","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.desk\",\n\"brightness_pct\": 100,\n\"rgb_color\":[146,199,255],\n\"transition\":10\n}}\n","output":"str","x":1280,"y":440,"wires":[["71ce48c3.6f81d8"]]},{"id":"71ce48c3.6f81d8","type":"api-call-service","z":"69646b1e.2e5084","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":1490,"y":340,"wires":[[]]},{"id":"7d681094.08465","type":"api-call-service","z":"69646b1e.2e5084","name":"Gaming scene","server":"90ba4a50.2b5e48","service_domain":"scene","service":"turn_on","data":"{\"entity_id\":\"scene.razer\"}","mergecontext":"","x":1720,"y":700,"wires":[[]]},{"id":"129840c8.e6c8df","type":"trigger-state","z":"69646b1e.2e5084","name":"Gaming Mode on","server":"90ba4a50.2b5e48","entityid":"input_boolean.gaming_mode","debugenabled":false,"constraints":[{"id":"7vslqjqspho","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":460,"wires":[["cac418b6.ae7be8"],[]]},{"id":"e84d63.473cb2a","type":"api-current-state","z":"69646b1e.2e5084","name":"Tv on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"media_player.lg_webos_smart_tv","outputs":1,"x":250,"y":240,"wires":[["52912682.455928"]]},{"id":"efadcbe7.c1bed8","type":"api-current-state","z":"69646b1e.2e5084","name":"downstairs?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.someone_downstairs","outputs":1,"x":970,"y":540,"wires":[["f0443724.cb9918"]]},{"id":"fc4ed827.914b78","type":"trigger-state","z":"433e5229.16b5fc","name":"No motion","server":"90ba4a50.2b5e48","entityid":"sensor.downstairs_motion_sensors","debugenabled":false,"constraints":[{"id":"npvm4ggp6xi","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"pal9navdrg","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"7wf9d07m7nk","targetType":"entity_id","targetValue":"input_boolean.privacy_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":1060,"wires":[["c1544ca3.c171"],[]]},{"id":"c1544ca3.c171","type":"delay","z":"433e5229.16b5fc","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":270,"y":1060,"wires":[["6169acb0.9f78a4"]]},{"id":"6169acb0.9f78a4","type":"api-current-state","z":"433e5229.16b5fc","name":"downstairs motion?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"group.downstairs_motion_sensors","outputs":1,"x":470,"y":1060,"wires":[["c6c01a43.838e48","3a7b5cf2.324404","5e26ef8b.a3f03"]]},{"id":"411474ee.526ddc","type":"api-current-state","z":"433e5229.16b5fc","name":"Person detected?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.people_dafang","outputs":1,"x":1250,"y":460,"wires":[["3352500c.b7ed9"]]},{"id":"3352500c.b7ed9","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1440,"y":440,"wires":[[],["be26f812.5e9278"]]},{"id":"773e053b.0b1aac","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1180,"y":1020,"wires":[["cca811ee.06657"],["95a4183c.011ba8","5701fa70.c90f04","56bd3066.4cb72","abf1f439.e44288"]]},{"id":"cca811ee.06657","type":"delay","z":"433e5229.16b5fc","name":"limit 10 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1510,"y":1100,"wires":[["95a4183c.011ba8","5701fa70.c90f04","56bd3066.4cb72","abf1f439.e44288"]]},{"id":"e9666cfe.3c42d","type":"api-current-state","z":"433e5229.16b5fc","name":"People eating?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.eating","outputs":1,"x":1180,"y":960,"wires":[["e7d6238.27c38e"]]},{"id":"e7d6238.27c38e","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1380,"y":960,"wires":[["b1f1b431.d3ff68"],["9d3170a9.02f0b"]]},{"id":"b1f1b431.d3ff68","type":"delay","z":"433e5229.16b5fc","name":"limit 5 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1510,"y":860,"wires":[["9d3170a9.02f0b"]]},{"id":"a20ed813.77da2","type":"inject","z":"69646b1e.2e5084","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1340,"y":680,"wires":[["d558f5aa.1d85c8"]]},{"id":"22a2f109.e87266","type":"delay","z":"69646b1e.2e5084","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1240,"y":620,"wires":[["f0443724.cb9918"]]},{"id":"9a733de6.169e2","type":"api-current-state","z":"49017fb.081c18","name":"Movie Mode?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":false,"override_payload":false,"entity_id":"input_boolean.movie_mode","outputs":1,"x":660,"y":320,"wires":[["e956b10.0dd405"]]},{"id":"e956b10.0dd405","type":"api-current-state","z":"49017fb.081c18","name":"Gaming Mode?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":false,"override_payload":false,"entity_id":"input_boolean.gaming_mode","outputs":1,"x":920,"y":380,"wires":[["b23b7cba.e20698"]]},{"id":"1a850d3e.74d0b3","type":"api-call-service","z":"49017fb.081c18","name":"Desk light off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\": \"light.desk\"}","mergecontext":"","x":410,"y":400,"wires":[[]]},{"id":"88bf96d2.5076f8","type":"trigger-state","z":"49017fb.081c18","name":"Gaming Mode off","server":"90ba4a50.2b5e48","entityid":"input_boolean.gaming_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"g3fhv8jk4tq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":380,"wires":[["b23b7cba.e20698","1a850d3e.74d0b3"],[]]},{"id":"d558f5aa.1d85c8","type":"api-call-service","z":"69646b1e.2e5084","name":"Movie scene","server":"90ba4a50.2b5e48","service_domain":"scene","service":"turn_on","data":"{\"entity_id\":\"scene.movie_mode_arctic\"}","mergecontext":"","x":1950,"y":460,"wires":[[]]},{"id":"85e6b81f.f04208","type":"api-call-service","z":"49017fb.081c18","name":"entrance light on","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.hallway_downstairs\",\"brightness_pct\":100,\"transition\":30}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":910,"y":1720,"wires":[[]]},{"id":"453f6585.bdd74c","type":"stoptimer","z":"49017fb.081c18","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"5 sec","x":750,"y":1720,"wires":[["85e6b81f.f04208"],[]]},{"id":"1ae47ddf.20f212","type":"trigger-state","z":"433e5229.16b5fc","name":"Downstairs motion","server":"90ba4a50.2b5e48","entityid":"sensor.downstairs_motion_sensors","debugenabled":false,"constraints":[{"id":"mr1vt9tokhn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"0qvbd8zy7x","targetType":"entity_id","targetValue":"input_boolean.privacy_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":920,"wires":[["c6c01a43.838e48","7fb0939b.f81efc","326ffe9c.f0d44a"],[]]},{"id":"d4272694.c8ee98","type":"time-range-switch","z":"69646b1e.2e5084","name":"","lat":"","lon":"","startTime":"20:00","endTime":"24:00","startOffset":0,"endOffset":0,"x":310,"y":100,"wires":[[],[]]},{"id":"beb73e82.6928f","type":"trigger-state","z":"69646b1e.2e5084","name":"TV on","server":"90ba4a50.2b5e48","entityid":"sensor.steam_76561197994627749","debugenabled":false,"constraints":[{"id":"wowjtcifl98","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":120,"wires":[[],[]]},{"id":"cac418b6.ae7be8","type":"time-range-switch","z":"69646b1e.2e5084","name":"","lat":"","lon":"","startTime":"18:00","endTime":"02:00","startOffset":0,"endOffset":0,"x":410,"y":540,"wires":[["6c309d0d.faba34","2b9c4999.325c16"],["5ebb6b91.2f9e44"]]},{"id":"ec4fa05b.df514","type":"api-call-service","z":"69646b1e.2e5084","name":"Big light off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.big_light\", \"transition\":30}","mergecontext":"","x":1010,"y":620,"wires":[[]]},{"id":"f9acb668.6afa48","type":"api-call-service","z":"69646b1e.2e5084","name":"Desk light off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.desk\", \"transition\":30}","mergecontext":"","x":1010,"y":660,"wires":[[]]},{"id":"5ebb6b91.2f9e44","type":"api-current-state","z":"69646b1e.2e5084","name":"living room brightness","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.livingroom_light_level_avg","outputs":1,"x":600,"y":580,"wires":[["72694fa9.dd5d8"]]},{"id":"72694fa9.dd5d8","type":"switch","z":"69646b1e.2e5084","name":"<11000","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"11000","vt":"num"},{"t":"gt","v":"12000","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":800,"y":580,"wires":[["efadcbe7.c1bed8"],["ec4fa05b.df514","f9acb668.6afa48","dd6a86a7.e73f38"]]},{"id":"ae3c5924.4c2dc8","type":"trigger-state","z":"49017fb.081c18","name":"Home","server":"90ba4a50.2b5e48","entityid":"group.anyone_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"q7bttmzmld","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":70,"y":1020,"wires":[["cdb38d8e.9dd47"],[]]},{"id":"cdb38d8e.9dd47","type":"api-current-state","z":"49017fb.081c18","name":"Motion?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.kitchen_motion_sensors","outputs":1,"x":300,"y":980,"wires":[["305325f9.8dce7a","7b6e8cc1.3a52e4"]]},{"id":"659d252e.92df7c","type":"trigger-state","z":"49017fb.081c18","name":"Motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.kitchen_motion_sensor","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"q7bttmzmld","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"r70wzsn5vwk","targetType":"entity_id","targetValue":"light.kitchen","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"ouuegbkyhtm","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"87xdt4tzhww","targetType":"entity_id","targetValue":"binary_sensor.motion_kitchen_xiaomi","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":70,"y":960,"wires":[["7b6e8cc1.3a52e4","305325f9.8dce7a"],[]]},{"id":"f8595589.d1b328","type":"template","z":"49017fb.081c18","name":"livingroom light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.living_room\",\n\"brightness_pct\": {{payload}},\n\"effect\":\"random\",\n\"transition\": 120\n}}\n","output":"str","x":3490,"y":440,"wires":[["4b06a863.d25228"]]},{"id":"e7ce545b.2d9ba8","type":"function","z":"49017fb.081c18","name":"Get light level","func":"msg.payload = flow.get('paperlight_brightness') || 0;\nreturn msg;","outputs":1,"noerr":0,"x":4340,"y":380,"wires":[["3a36fb9e.d9f214"]]},{"id":"1bc3ed30.a37d43","type":"debug","z":"49017fb.081c18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2830,"y":220,"wires":[]},{"id":"3aae10e.6c6e7f","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2060,"y":180,"wires":[[]]},{"id":"738850d6.15db2","type":"function","z":"49017fb.081c18","name":"Get light level","func":"msg.payload = flow.get('paperlight_brightness') || 0;\nreturn msg;","outputs":1,"noerr":0,"x":3260,"y":440,"wires":[["f8595589.d1b328"]]},{"id":"59f90551.0a24ac","type":"api-current-state","z":"49017fb.081c18","name":"Living room light on?","server":"90ba4a50.2b5e48","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"light.living_room","state_type":"str","outputs":1,"x":2760,"y":440,"wires":[["af130e19.4aeff"]]},{"id":"af130e19.4aeff","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"},{"t":"eq","v":"unavailable","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":2970,"y":440,"wires":[["eeb4502d.84a53"],["eeb4502d.84a53"],["eeb4502d.84a53"]]},{"id":"98db2bf8.ca7af8","type":"api-current-state","z":"a1f7f54.5d30108","name":"Tiia home?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.tiia_home","outputs":1,"x":1030,"y":460,"wires":[["ab3d81cd.9f12b"]]},{"id":"3193879a.e638d8","type":"api-call-service","z":"a1f7f54.5d30108","name":"Disable schedule dining room cleaning","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.schedule_dining_area_cleaning\"}","mergecontext":"","x":2370,"y":500,"wires":[[]]},{"id":"8fcea139.75de3","type":"time-range-switch","z":"69646b1e.2e5084","name":"","lat":"","lon":"","startTime":"21:00","endTime":"02:00","startOffset":0,"endOffset":0,"x":330,"y":180,"wires":[["52912682.455928"],[]]},{"id":"86d1a496.17452","type":"trigger-state","z":"69646b1e.2e5084","name":"TV on","server":"90ba4a50.2b5e48","entityid":"media_player.lg_webos_smart_tv","debugenabled":false,"constraints":[{"id":"fokt90uudsn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"},{"id":"wowjtcifl98","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"y6pxrul6dr7","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":414,"y":498,"wires":[[],[]]},{"id":"a486a85d.67bb2","type":"trigger-state","z":"69646b1e.2e5084","name":"Sleeping on","server":"90ba4a50.2b5e48","entityid":"binary_sensor.sleeping","debugenabled":false,"constraints":[{"id":"wowjtcifl98","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"z3twykzh72k","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":42,"wires":[["2e6c366b.f39822","51895f77.6b28e"],[]]},{"id":"2e6c366b.f39822","type":"api-call-service","z":"69646b1e.2e5084","name":"Movie Mode off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.movie_mode\"}","mergecontext":"","x":360,"y":40,"wires":[[]]},{"id":"8223a60b.0c23a8","type":"inject","z":"9114d340.f3aed","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"30 20 * * 1,2,4","once":false,"onceDelay":0.1,"x":130,"y":1000,"wires":[["c379bba4.e70af8","9256fec4.ce66d"]]},{"id":"c379bba4.e70af8","type":"api-call-service","z":"9114d340.f3aed","name":"","server":"90ba4a50.2b5e48","service_domain":"tts","service":"google_say","data":"{\"entity_id\":\"media_player.speaker\", \"message\": \"It's time for bed. Put your books away now. Turning Zootopia on.\"}","mergecontext":"","x":410,"y":1000,"wires":[[]]},{"id":"9256fec4.ce66d","type":"stoptimer","z":"9114d340.f3aed","duration":"3","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":400,"y":1060,"wires":[["b0f7b834.f55968"],[]]},{"id":"b0f7b834.f55968","type":"api-call-service","z":"9114d340.f3aed","name":"Zootopia","server":"90ba4a50.2b5e48","service_domain":"rest_command","service":"zootopia","data":"","mergecontext":"","x":600,"y":1060,"wires":[[]]},{"id":"764d6901.3bf348","type":"api-call-service","z":"433e5229.16b5fc","name":"camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{\"entity_id\": \"camera.xiaofang1\", \"filename\": \"/images/kitchen_lights/{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg\" }","mergecontext":"","x":490,"y":1740,"wires":[[]]},{"id":"11de6888.d80bc7","type":"api-call-service","z":"49017fb.081c18","name":"Turn off christmas lights","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"switch.kitchen_switch\"}","mergecontext":"","x":930,"y":320,"wires":[[]]},{"id":"eeb4502d.84a53","type":"api-current-state","z":"49017fb.081c18","name":"Christmas lights on","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"switch.kitchen_switch","outputs":1,"x":3190,"y":360,"wires":[["dbfb2be4.4b7dc8"]]},{"id":"dbfb2be4.4b7dc8","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":3350,"y":360,"wires":[["d59bfe5.6eb88"],["48c5e084.0117d"]]},{"id":"d59bfe5.6eb88","type":"api-current-state","z":"49017fb.081c18","name":"Paperlight","server":"90ba4a50.2b5e48","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"light.paperlight","state_type":"str","outputs":2,"x":3520,"y":300,"wires":[["48c5e084.0117d"],[]]},{"id":"2c188708.6396b","type":"delay","z":"69646b1e.2e5084","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":260,"y":580,"wires":[["cac418b6.ae7be8"]]},{"id":"6d532495.23d6b4","type":"trigger-state","z":"433e5229.16b5fc","name":"Someone downstairs?","server":"90ba4a50.2b5e48","entityid":"input_boolean.someone_downstairs","debugenabled":false,"constraints":[{"id":"3ew10r9tb2a","targetType":"entity_id","targetValue":"input_boolean.privacy_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":1000,"wires":[["284c9902.71f826"],[]]},{"id":"284c9902.71f826","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":320,"y":1000,"wires":[[],["326ffe9c.f0d44a","4d6871b8.ffb39"]]},{"id":"a1633b13.604b48","type":"inject","z":"bca662a0.a29b2","name":"","topic":"","payload":"enable","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":600,"wires":[["1dad51f0.40ba5e"]]},{"id":"1dad51f0.40ba5e","type":"api-call-service","z":"bca662a0.a29b2","name":"request update luca","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"{\"message\":\"request_location_update\"}","mergecontext":"","x":360,"y":600,"wires":[[]]},{"id":"d9950693.a7ecf8","type":"api-current-state","z":"49017fb.081c18","name":"Livingroom light level","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.livingroom_light_level_avg","outputs":1,"x":1380,"y":560,"wires":[["35205337.ea552c"]]},{"id":"f077067b.1a1868","type":"time-range-switch","z":"49017fb.081c18","name":"","lat":"60.325978","lon":"25.042116","startTime":"sunrise","endTime":"sunset","startOffset":"+90","endOffset":"-100","x":1440,"y":180,"wires":[["ba12a336.f0b8c"],["6a66afbb.a2f6d"]]},{"id":"ba12a336.f0b8c","type":"switch","z":"49017fb.081c18","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"12000","vt":"num"},{"t":"gt","v":"13000","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":1620,"y":140,"wires":[["63c10259.4c994c","fd0ef1da.b2328"],[]]},{"id":"6a66afbb.a2f6d","type":"switch","z":"49017fb.081c18","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"17000","vt":"num"},{"t":"gt","v":"17500","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":1620,"y":240,"wires":[["62f88eee.d416d","56663cca.30e394"],[]]},{"id":"56663cca.30e394","type":"range","z":"49017fb.081c18","minin":"14000","maxin":"17000","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":1730,"y":260,"wires":[[]]},{"id":"62f88eee.d416d","type":"range","z":"49017fb.081c18","minin":"14000","maxin":"17000","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":1820.5,"y":226,"wires":[[]]},{"id":"fd0ef1da.b2328","type":"range","z":"49017fb.081c18","minin":"9000","maxin":"12500","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":1822,"y":173,"wires":[[]]},{"id":"63c10259.4c994c","type":"range","z":"49017fb.081c18","minin":"9000","maxin":"12500","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":1825,"y":135,"wires":[[]]},{"id":"12b4ecc2.4718a3","type":"range","z":"49017fb.081c18","minin":"7000","maxin":"12000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":2170,"y":540,"wires":[["9d739a2d.a22e98","c124133c.8d82e"]]},{"id":"af33919b.a5e2a","type":"range","z":"49017fb.081c18","minin":"5000","maxin":"12000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":2170,"y":580,"wires":[["485ce41c.1d7a1c"]]},{"id":"d7e663d9.3cd8c","type":"trigger-state","z":"49017fb.081c18","name":"Auto lights on","server":"90ba4a50.2b5e48","entityid":"sensor.livingroom_light_level_avg","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"gqwvxau4txu","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"65tcfghun8u","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"v8d8hsu6hsb","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"chv71skniw","targetType":"entity_id","targetValue":"input_boolean.movie_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"mfrvwy2kp8e","targetType":"entity_id","targetValue":"input_boolean.gaming_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":540,"wires":[["b095642c.340c08"],[]]},{"id":"d8827d41.8d275","type":"trigger-state","z":"9114d340.f3aed","name":"Follow music on","server":"90ba4a50.2b5e48","entityid":"input_boolean.follow_music","debugenabled":false,"constraints":[{"id":"6e4p7xfb6l","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"ets35dw086","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":200,"wires":[["6a684113.588e5","24c8f809.f4c808"],[]]},{"id":"34ec0844.a536d8","type":"api-current-state","z":"9114d340.f3aed","name":"Upstairs motion","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.upstairs_motion_sensors","outputs":1,"x":540,"y":60,"wires":[["173f8799.5c4c18"]]},{"id":"e64bc1fc.d574c","type":"api-current-state","z":"9114d340.f3aed","name":"Kitchen motion","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.kitchen_motion_sensors","outputs":1,"x":540,"y":120,"wires":[["d8203170.5e2d1"]]},{"id":"173f8799.5c4c18","type":"api-call-service","z":"9114d340.f3aed","name":"Group Office","server":"90ba4a50.2b5e48","service_domain":"script","service":"sonos_group_motion","data":"{\"target_player\":\"media_player.bedroom\"}","mergecontext":"","x":730,"y":60,"wires":[[]]},{"id":"d8203170.5e2d1","type":"api-call-service","z":"9114d340.f3aed","name":"Group Kitchen","server":"90ba4a50.2b5e48","service_domain":"script","service":"sonos_group_motion","data":"{\"target_player\":\"media_player.kitchen\"}","mergecontext":"","x":740,"y":120,"wires":[[]]},{"id":"fb2275f8.76bb08","type":"api-call-service","z":"9114d340.f3aed","name":"Trigger TTS","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\": \"media_player.beam\", \"message\":\"Your TV time is almost over. It will turn off in 5 minutes.\"}","mergecontext":"","x":673.5,"y":878,"wires":[[]]},{"id":"1ed71c08.71fd84","type":"api-call-service","z":"9114d340.f3aed","name":"Trigger TTS","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\": \"media_player.beam\", \"message\":\"Your TV time is over.\"}","mergecontext":"","x":673.5,"y":778,"wires":[[]]},{"id":"a94361a4.2cadc","type":"api-current-state","z":"49017fb.081c18","name":"Big light on","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"light.big_light","outputs":1,"x":1790,"y":580,"wires":[["1ab753d2.0981a4"]]},{"id":"1ab753d2.0981a4","type":"api-current-state","z":"49017fb.081c18","name":"Livingroom light level","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.livingroom_light_level_avg","outputs":1,"x":1980,"y":620,"wires":[["de0212ac.0abf8"]]},{"id":"35205337.ea552c","type":"switch","z":"49017fb.081c18","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"11000","vt":"num"},{"t":"lt","v":"15000","vt":"str"},{"t":"gte","v":"15000","vt":"num"}],"checkall":"false","repair":false,"outputs":3,"x":1580,"y":560,"wires":[["af33919b.a5e2a","bd268bd1.33de38"],["a94361a4.2cadc"],["514d291f.802f28"]]},{"id":"ac53aa6e.7ad808","type":"range","z":"49017fb.081c18","minin":"8000","maxin":"14000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":2310,"y":680,"wires":[["485ce41c.1d7a1c"]]},{"id":"86efff58.1424f","type":"range","z":"49017fb.081c18","minin":"8000","maxin":"14000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":2310,"y":640,"wires":[["9d739a2d.a22e98","8b4fbfeb.a3a07"]]},{"id":"2f92a4d4.36b03c","type":"change","z":"49017fb.081c18","name":"Set brightness","rules":[{"t":"set","p":"brightness","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":440,"wires":[["59f90551.0a24ac"]]},{"id":"341e19ef.120a16","type":"change","z":"f9c72e13.30015","name":"Set brightness","rules":[{"t":"set","p":"brightness","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":520,"wires":[["90765778.682428"]]},{"id":"7e61df05.22da1","type":"inject","z":"f9c72e13.30015","name":"","topic":"","payload":"10","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":660,"wires":[["341e19ef.120a16"]]},{"id":"90765778.682428","type":"delay","z":"f9c72e13.30015","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":380,"y":520,"wires":[["1cc2c7f2.b8fde8"]]},{"id":"1cc2c7f2.b8fde8","type":"api-render-template","z":"f9c72e13.30015","name":"Template","server":"90ba4a50.2b5e48","template":"{{ states.light.hallway_color.attributes.rgb_color }}","x":540,"y":520,"wires":[["2a350f46.10cfb"]]},{"id":"2a350f46.10cfb","type":"function","z":"f9c72e13.30015","name":"Get light level","func":"colors = msg.payload\ncolors = colors.replace(/[{()}]/g, '');\nmsg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.big_light\\\",\\\"brightness_pct\\\": \"+msg.brightness+\", \\\"rgb_color\\\": [\"+colors+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":520,"wires":[["dbb6a6e7.70bd58"]]},{"id":"dbb6a6e7.70bd58","type":"debug","z":"f9c72e13.30015","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1050,"y":540,"wires":[]},{"id":"f11ec678.3cb158","type":"function","z":"f9c72e13.30015","name":"Get light level","func":"colors = msg.payload\nmsg.payload = colors.replace(/[{()}]/g, '');\n//msg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.big_light\\\",\\\"brightness_pct\\\": \"+(flow.get(\"paperlight_brightness\")|| 0)+\", \\\"rgb_color\\\": [\"+colors+\"], \\\"transition\\\": 2}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":660,"wires":[[]]},{"id":"3eaf75c7.e821ba","type":"api-render-template","z":"f9c72e13.30015","name":"Template","server":"90ba4a50.2b5e48","template":"[{{ (range(0, 255)|random) }}, {{ (range(0, 255)|random) }},{{ (range(0, 255)|random) }}]","x":500,"y":580,"wires":[[]]},{"id":"c0c09313.90ad2","type":"function","z":"f9c72e13.30015","name":"Get light level","func":"msg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.hallway_color\\\",\\\"brightness_pct\\\": \"+(flow.get(\"paperlight_brightness\")|| 0)+\", \\\"rgb_color\\\": [\"+msg.payload+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":580,"wires":[[]]},{"id":"5b9b5e45.f99a7","type":"function","z":"f9c72e13.30015","name":"Get light level","func":"msg.payload = flow.get('paperlight_brightness')|| 0;\nmsg.template = \"{ 'data': {'entity_id': 'light.hallway_color','brightness_pct': \"+msg.payload+\", 'effect': 'random', 'rgb_color': [{{ (range(0, 255)|random) }}, {{ (range(0, 255)|random) }},{{ (range(0, 255)|random) }}], 'transition': 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":660,"wires":[[]]},{"id":"5474d72c.a15a88","type":"change","z":"49017fb.081c18","name":"Set brightness","rules":[{"t":"set","p":"brightness","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2780,"y":520,"wires":[["cea140b3.7631a"]]},{"id":"42a32a5c.d79b74","type":"delay","z":"49017fb.081c18","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3180,"y":660,"wires":[["a5537e7f.9a357"]]},{"id":"a5537e7f.9a357","type":"api-render-template","z":"49017fb.081c18","name":"Template","server":"90ba4a50.2b5e48","template":"{{ states.light.ball.attributes.rgb_color }}","x":3320,"y":660,"wires":[[]]},{"id":"4d40f7ce.2ec818","type":"function","z":"49017fb.081c18","name":"Return template","func":"colors = msg.payload\nmsg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.big_light\\\",\\\"brightness_pct\\\": \"+msg.brightness+\", \\\"rgb_color\\\": [\"+colors+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":3640,"y":660,"wires":[["96dcc470.578208"]]},{"id":"31da793d.0ea126","type":"api-current-state","z":"49017fb.081c18","name":"Desk light on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"light.desk","outputs":1,"x":3120,"y":720,"wires":[["5c81bf44.9d1fc"]]},{"id":"5c81bf44.9d1fc","type":"delay","z":"49017fb.081c18","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":3300,"y":720,"wires":[["7724cbdc.cfbff4"]]},{"id":"7724cbdc.cfbff4","type":"api-render-template","z":"49017fb.081c18","name":"Template","server":"90ba4a50.2b5e48","template":"{{ states.light.ball.attributes.rgb_color }}","x":3460,"y":760,"wires":[["133a56f2.1c3019"]]},{"id":"133a56f2.1c3019","type":"function","z":"49017fb.081c18","name":"Return template","func":"colors = msg.payload\nmsg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.desk\\\",\\\"brightness_pct\\\": \"+msg.brightness+\", \\\"rgb_color\\\": [\"+colors+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":3640,"y":720,"wires":[["e471c9b5.ad4e38"]]},{"id":"96dcc470.578208","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":3810,"y":660,"wires":[[]]},{"id":"e471c9b5.ad4e38","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":3810,"y":720,"wires":[[]]},{"id":"c32e6978.e43b58","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":3810,"y":600,"wires":[[]]},{"id":"4b06a863.d25228","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":3670,"y":440,"wires":[[]]},{"id":"69b0e2d9.46444c","type":"api-render-template","z":"49017fb.081c18","name":"Template","server":"90ba4a50.2b5e48","template":"[{{ (range(0, 255)|random) }}, {{ (range(0, 255)|random) }},{{ (range(0, 255)|random) }}]","x":3300,"y":600,"wires":[["ec9b7f4e.9f909","4d40f7ce.2ec818","133a56f2.1c3019"]]},{"id":"ec9b7f4e.9f909","type":"function","z":"49017fb.081c18","name":"Return template","func":"msg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.ball\\\",\\\"brightness_pct\\\": \"+msg.brightness+\", \\\"rgb_color\\\": [\"+msg.payload+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":3640,"y":600,"wires":[["c32e6978.e43b58"]]},{"id":"ba647b27.fc05a8","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2330,"y":780,"wires":[["5474d72c.a15a88"]]},{"id":"cea140b3.7631a","type":"api-current-state","z":"49017fb.081c18","name":"Color mode on?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.color_mode","outputs":1,"x":2760,"y":580,"wires":[["e14b9cf9.81268"]]},{"id":"e14b9cf9.81268","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":2930,"y":580,"wires":[["69b0e2d9.46444c"],["e6969d2a.89358"]]},{"id":"e6969d2a.89358","type":"template","z":"49017fb.081c18","name":"big light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.big_light\",\n\"brightness_pct\": {{brightness}},\n\"rgb_color\":[255,206,154],\n\"transition\": 120\n}}\n","output":"str","x":3110,"y":520,"wires":[["ba157124.ccffa"]]},{"id":"ba157124.ccffa","type":"api-call-service","z":"49017fb.081c18","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":3310,"y":520,"wires":[[]]},{"id":"48c5e084.0117d","type":"api-current-state","z":"49017fb.081c18","name":"Color mode on?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.color_mode","outputs":1,"x":3680,"y":360,"wires":[["5252bfde.c38e9"]]},{"id":"5252bfde.c38e9","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":3850,"y":360,"wires":[["b92e77bd.af4e58"],["6bcc3f5c.c2fe1"]]},{"id":"b92e77bd.af4e58","type":"function","z":"49017fb.081c18","name":"Get light level","func":"msg.payload = (flow.get('paperlight_brightness') || 0)/2;\nreturn msg;","outputs":1,"noerr":0,"x":4020,"y":320,"wires":[["3a36fb9e.d9f214"]]},{"id":"7f260a12.044bb4","type":"debug","z":"49017fb.081c18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":4750,"y":460,"wires":[]},{"id":"9d18a950.66d0d8","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3460,"y":400,"wires":[["48c5e084.0117d"]]},{"id":"a7d99878.acd578","type":"function","z":"69646b1e.2e5084","name":"Return template","func":"msg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.hallway_color\\\",\\\"brightness_pct\\\": 20, \\\"rgb_color\\\": [121,255,228], \\\"transition\\\": 2}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2100,"y":540,"wires":[["9b1fa92d.00c8d8","4e78ab24.c5329c"]]},{"id":"9b1fa92d.00c8d8","type":"api-call-service","z":"69646b1e.2e5084","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","mergecontext":"","x":2270,"y":540,"wires":[[]]},{"id":"3a708f22.39be1","type":"delay","z":"69646b1e.2e5084","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1760,"y":540,"wires":[["a7d99878.acd578"]]},{"id":"2545b9f3.262b76","type":"template","z":"69646b1e.2e5084","name":"Color light blue","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.hallway_color\",\n\"brightness_pct\": 100,\n\"rgb_color\":[146,199,255],\n\"transition\":2\n}}\n","output":"str","x":400,"y":720,"wires":[["f443589a.bf4ae8"]]},{"id":"8c4e334f.2f2e4","type":"trigger-state","z":"49017fb.081c18","name":"Color Mode","server":"90ba4a50.2b5e48","entityid":"input_boolean.color_mode","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"4fh18xx5vfa","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"uac9gn19529","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":480,"wires":[["b23b7cba.e20698"],[]]},{"id":"c22b5806.c13a58","type":"inject","z":"69646b1e.2e5084","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 20 * * *","once":false,"onceDelay":0.1,"x":110,"y":300,"wires":[[]]},{"id":"2c28ce4d.48a712","type":"api-call-service","z":"69646b1e.2e5084","name":"Color Mode on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.color_mode\"}","mergecontext":"","x":340,"y":300,"wires":[[]]},{"id":"21b9b8c3.cfaf98","type":"api-call-service","z":"49017fb.081c18","name":"Color Mode off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.color_mode\"}","mergecontext":"","x":600,"y":760,"wires":[[]]},{"id":"40de5f25.a3005","type":"trigger-state","z":"407269cb.c12fd8","name":"Media players on","server":"90ba4a50.2b5e48","entityid":"media_player.speaker","debugenabled":false,"constraints":[{"id":"cr35bk7njmp","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"eo570esjx6o","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1060,"wires":[["92e9c497.993578"],[]]},{"id":"92e9c497.993578","type":"time-range-switch","z":"407269cb.c12fd8","name":"","lat":"","lon":"","startTime":"19:00","endTime":"6:00","startOffset":0,"endOffset":0,"x":350,"y":1060,"wires":[["1d17e2c6.e3ab2d"],[]]},{"id":"1d17e2c6.e3ab2d","type":"api-call-service","z":"407269cb.c12fd8","name":"Kid sleeping on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.kid_sleeping\"}","mergecontext":"","x":620,"y":1060,"wires":[[]]},{"id":"e9d997f8.1113c8","type":"trigger-state","z":"407269cb.c12fd8","name":"Sleeping off","server":"90ba4a50.2b5e48","entityid":"binary_sensor.sleeping","debugenabled":false,"constraints":[{"id":"bs3oqs9dbzn","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":1000,"wires":[["8a913e3f.abc2d"],[]]},{"id":"8a913e3f.abc2d","type":"time-range-switch","z":"407269cb.c12fd8","name":"","lat":"","lon":"","startTime":"06:00","endTime":"19:00","startOffset":0,"endOffset":0,"x":350,"y":1000,"wires":[["8f64c0c0.bcece"],[]]},{"id":"8f64c0c0.bcece","type":"api-call-service","z":"407269cb.c12fd8","name":"Kid sleeping off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.kid_sleeping\"}","mergecontext":"","x":620,"y":1000,"wires":[[]]},{"id":"df1ebc53.aea2f","type":"trigger-state","z":"beccfe19.cca62","name":"Laundry done","server":"90ba4a50.2b5e48","entityid":"input_boolean.washing_machine","debugenabled":false,"constraints":[{"id":"nf6r3bamtu","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":80,"wires":[["1394d480.fcbf2b"],[]]},{"id":"1394d480.fcbf2b","type":"api-call-service","z":"beccfe19.cca62","name":"Chore done","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.do_laundry\"}","mergecontext":"","x":360,"y":80,"wires":[[]]},{"id":"75e14934.d79d98","type":"api-call-service","z":"bca662a0.a29b2","name":"request update tiia","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_tiias_iphone","data":"{\"message\":\"request_location_update\"}","mergecontext":"","x":350,"y":640,"wires":[[]]},{"id":"3f10faa8.cfd8a6","type":"inject","z":"bca662a0.a29b2","name":"","topic":"","payload":"enable","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":660,"wires":[["75e14934.d79d98"]]},{"id":"a25245a1.27c488","type":"inject","z":"9114d340.f3aed","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":683.5,"y":958,"wires":[["e8f89c5b.bb4c1","f9cd82cd.d8da6"]]},{"id":"a9d45958.9c19e","type":"api-call-service","z":"433e5229.16b5fc","name":"camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{\"entity_id\": \"camera.xiaofang2\", \"filename\": \"/images/dining_table/{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg\" }","mergecontext":"","x":490,"y":1840,"wires":[[]]},{"id":"a12183b4.2ab98","type":"trigger","z":"9114d340.f3aed","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-15","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":510,"y":1140,"wires":[["18a8560c.4e505a","f5bb9844.f819b8"]]},{"id":"e3220bde.cc1898","type":"api-call-service","z":"9114d340.f3aed","name":"TV Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.sonas_hot_chromecast\",\"media_content_id\":\"http://192.168.92.20:8777\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":810,"y":1120,"wires":[[]]},{"id":"18a8560c.4e505a","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":1200,"wires":[["aaffeecf.69b1","d4c41c74.caf3a"]]},{"id":"b27adb19.fb20d8","type":"api-call-service","z":"9114d340.f3aed","name":"Living Room Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.sonas_hot_chromecast\",\"media_content_id\":\"http://192.168.92.20:8779\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":1120,"y":1160,"wires":[[]]},{"id":"aaffeecf.69b1","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":960,"y":1220,"wires":[["8f5f1e33.74fce","71491ba4.1d1f84"]]},{"id":"bd575073.10cc","type":"api-call-service","z":"9114d340.f3aed","name":"Kitchen Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.sonas_hot_chromecast\",\"media_content_id\":\"http://192.168.92.20:8780\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":1240,"y":1220,"wires":[[]]},{"id":"7ac77b33.a303d4","type":"change","z":"9114d340.f3aed","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":1200,"wires":[["a12183b4.2ab98","8d2ab2ad.0d3e9"]]},{"id":"63bddf2b.fd309","type":"server-state-changed","z":"9114d340.f3aed","name":"Cycle off bedroom","server":"90ba4a50.2b5e48","entityidfilter":"input_boolean.camera_cycling_bedroom","entityidfiltertype":"substring","outputinitially":false,"haltifstate":"","outputs":1,"x":130,"y":1140,"wires":[["13356bce.6a2b84"]]},{"id":"730d61d7.1bf5c","type":"server-state-changed","z":"9114d340.f3aed","name":"Cycle off living room","server":"90ba4a50.2b5e48","entityidfilter":"input_boolean.camera_cycling_livingroom","entityidfiltertype":"substring","outputinitially":false,"haltifstate":"","outputs":1,"x":110,"y":1300,"wires":[["9dcbda8b.82a5f8"]]},{"id":"8d9e6e87.51e74","type":"change","z":"9114d340.f3aed","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":1360,"wires":[["11110be8.d8c6f4","d91624b2.0be858"]]},{"id":"11110be8.d8c6f4","type":"trigger","z":"9114d340.f3aed","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-15","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":490,"y":1300,"wires":[["d5fead78.a7f12","35adc013.6b50d"]]},{"id":"a67f523f.ecb2b","type":"api-call-service","z":"9114d340.f3aed","name":"TV Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.living_room_tv\",\"media_content_id\":\"http://192.168.92.20:8777\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":790,"y":1280,"wires":[[]]},{"id":"d5fead78.a7f12","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":720,"y":1360,"wires":[["da22e03b.f1aa3","b6caf4e.d9eb008"]]},{"id":"c65837af.e68278","type":"api-call-service","z":"9114d340.f3aed","name":"Living Room Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.living_room_tv\",\"media_content_id\":\"http://192.168.92.20:8779\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":1100,"y":1320,"wires":[[]]},{"id":"da22e03b.f1aa3","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":940,"y":1380,"wires":[["c81009b4.09cdd8","9140ef46.a77ff"]]},{"id":"eae480ab.d7a59","type":"api-call-service","z":"9114d340.f3aed","name":"Kitchen Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.living_room_tv\",\"media_content_id\":\"http://192.168.92.20:8780\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":1220,"y":1380,"wires":[[]]},{"id":"13356bce.6a2b84","type":"switch","z":"9114d340.f3aed","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":290,"y":1140,"wires":[["a12183b4.2ab98"],["7ac77b33.a303d4"]]},{"id":"9dcbda8b.82a5f8","type":"switch","z":"9114d340.f3aed","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":270,"y":1300,"wires":[["11110be8.d8c6f4"],["8d9e6e87.51e74"]]},{"id":"8d2ab2ad.0d3e9","type":"api-call-service","z":"9114d340.f3aed","name":"Turn off bedroom TV","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"turn_off","data":"{\"entity_id\":\"media_player.sonas_hot_chromecast\"}","mergecontext":"","x":520,"y":1200,"wires":[[]]},{"id":"d91624b2.0be858","type":"api-call-service","z":"9114d340.f3aed","name":"Turn off living room TV","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"turn_off","data":"{\"entity_id\":\"media_player.living_room_tv\"}","mergecontext":"","x":500,"y":1360,"wires":[[]]},{"id":"b384a9cb.f94e58","type":"api-current-state","z":"433e5229.16b5fc","name":"People eating?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.people_tf","outputs":1,"x":1080,"y":1140,"wires":[["74f748f1.bd56c"]]},{"id":"74f748f1.bd56c","type":"switch","z":"433e5229.16b5fc","name":"on or off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1260,"y":1120,"wires":[["f44813b1.8559d8"],[]]},{"id":"f44813b1.8559d8","type":"delay","z":"433e5229.16b5fc","name":"limit 10 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1430,"y":1160,"wires":[[]]},{"id":"fb31239a.dc5a","type":"api-call-service","z":"433e5229.16b5fc","name":"camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{\"entity_id\": \"camera.xiaofang2_latest\", \"filename\": \"/images/vacuum/{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg\" }","mergecontext":"","x":490,"y":1920,"wires":[[]]},{"id":"d57b661.5fabc98","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tiia leaving work","server":"90ba4a50.2b5e48","entityid":"device_tracker.tiias_iphone","debugenabled":false,"constraints":[{"id":"xaxzo73not","targetType":"entity_id","targetValue":"input_boolean.arrival_notifications","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"xbc2f2ly1h","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Stockmann"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":640,"wires":[["60ee915.191037"],[]]},{"id":"a4da9345.cecdc","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Travel time tiia","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.tiia_travel_time","outputs":1,"x":500,"y":640,"wires":[["edab6c1.8a5729"]]},{"id":"edab6c1.8a5729","type":"template","z":"c84fe94a.0c50b8","name":"TTS Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Teea just left work, she will be home in {{payload}} minutes","output":"str","x":680,"y":640,"wires":[["f489c00a.b6d43"]]},{"id":"3e0a76e5.4d7b4a","type":"stoptimer","z":"407269cb.c12fd8","duration":"20","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":900,"y":860,"wires":[["1a384c8d.8d6533"],[]]},{"id":"d85ae9df.171e88","type":"api-call-service","z":"8d972e1e.28c54","name":"","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"export_csv","data":"","mergecontext":"","x":790,"y":460,"wires":[[]]},{"id":"c3f9ea12.92aab8","type":"api-render-template","z":"8d972e1e.28c54","name":"Signal template","server":"90ba4a50.2b5e48","template":"{% if is_state(\"input_boolean.someone_downstairs\",\"on\") %}\n  {% set downstairs = 1 %}\n{% else %}\n  {% set downstairs = 0 %}\n{% endif %}\n{\"rssi\":{{states.device_tracker.tiiasiphone.attributes.rssi}},\"signal\":{{states.device_tracker.tiiasiphone.attributes.signal}},\"ap\":\"{{states.device_tracker.tiiasiphone.attributes.ap_mac}}\",\"downstairs\":{{downstairs}}}","x":320,"y":460,"wires":[["2d059023.be713","e03935ec.eed4d8"]]},{"id":"7c2e5776.482b28","type":"inject","z":"8d972e1e.28c54","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":500,"wires":[["c3f9ea12.92aab8"]]},{"id":"e03935ec.eed4d8","type":"template","z":"8d972e1e.28c54","name":"TTS Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{{payload}}}","output":"str","x":540,"y":460,"wires":[["d85ae9df.171e88"]]},{"id":"2d059023.be713","type":"debug","z":"8d972e1e.28c54","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":540,"wires":[]},{"id":"dfee358b.1d8d28","type":"trigger-state","z":"8d972e1e.28c54","name":"Luca changed","server":"90ba4a50.2b5e48","entityid":"device_tracker.sevenplus_router","debugenabled":false,"constraints":[{"id":"m5yharx32ns","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"530zgadx5tm","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":640,"wires":[[],[]]},{"id":"7077af74.3684c","type":"trigger-state","z":"8d972e1e.28c54","name":"Tiia changed","server":"90ba4a50.2b5e48","entityid":"device_tracker.tiiasiphone","debugenabled":false,"constraints":[{"id":"m5yharx32ns","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"home"},{"id":"gtezhb6i7is","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":720,"wires":[[],[]]},{"id":"e75011f4.cfebc","type":"api-call-service","z":"8d972e1e.28c54","name":"Export Luca","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"export_csv_luca","data":"","mergecontext":"","x":470,"y":640,"wires":[[]]},{"id":"48ed355b.224c2c","type":"api-call-service","z":"8d972e1e.28c54","name":"Export Tiia","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"export_csv_tiia","data":"","mergecontext":"","x":470,"y":720,"wires":[[]]},{"id":"671cfbac.dc5d6c","type":"delay","z":"8d972e1e.28c54","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":300,"y":640,"wires":[["e75011f4.cfebc"]]},{"id":"b27165b2.33ee8","type":"delay","z":"8d972e1e.28c54","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":280,"y":720,"wires":[["48ed355b.224c2c"]]},{"id":"f5bb9844.f819b8","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_bedroom","outputs":1,"x":670,"y":1120,"wires":[["e3220bde.cc1898"]]},{"id":"d4c41c74.caf3a","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_bedroom","outputs":1,"x":870,"y":1180,"wires":[["b27adb19.fb20d8"]]},{"id":"8f5f1e33.74fce","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_bedroom","outputs":1,"x":1090,"y":1220,"wires":[["bd575073.10cc"]]},{"id":"b6caf4e.d9eb008","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_livingroom","outputs":1,"x":850,"y":1340,"wires":[["c65837af.e68278"]]},{"id":"35adc013.6b50d","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_livingroom","outputs":1,"x":650,"y":1280,"wires":[["a67f523f.ecb2b"]]},{"id":"c81009b4.09cdd8","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_livingroom","outputs":1,"x":1070,"y":1380,"wires":[["eae480ab.d7a59"]]},{"id":"9530a546.b6f9d8","type":"api-current-state","z":"a1f7f54.5d30108","name":"Tiia home?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.tiia_home","outputs":1,"x":290,"y":1040,"wires":[["db92785a.f9a868"]]},{"id":"c9f94ccb.534aa","type":"api-current-state","z":"a1f7f54.5d30108","name":"Tiia home?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.tiia_home","outputs":1,"x":1330,"y":1040,"wires":[["37b25fcb.1709d"]]},{"id":"2b0f68f0.e655d8","type":"trigger-state","z":"8d972e1e.28c54","name":"Device updated","server":"90ba4a50.2b5e48","entityid":"device_tracker.sevenplusha","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":820,"wires":[["7c24991e.8984f8","a7ecad4.e3fde5"],[]]},{"id":"c02c1b57.8db328","type":"api-call-service","z":"8d972e1e.28c54","name":"Export GPS","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"export_gps_luca","data":"","mergecontext":"","x":870,"y":820,"wires":[[]]},{"id":"d32dfa46.54dab","type":"trigger-state","z":"8d972e1e.28c54","name":"","server":"90ba4a50.2b5e48","entityid":"device_tracker.tiias_iphone","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":200,"y":1020,"wires":[["e3d512f4.c7ba5","4bc38268.694f7c"],[]]},{"id":"d51741ae.0060e8","type":"api-call-service","z":"8d972e1e.28c54","name":"","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"export_gps_tiia","data":"","mergecontext":"","x":1030,"y":1040,"wires":[[]]},{"id":"3de44bbc.9bdc44","type":"delay","z":"8d972e1e.28c54","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":780,"y":1100,"wires":[["8f1e4c30.a8917"]]},{"id":"42985b12.84c6a4","type":"delay","z":"8d972e1e.28c54","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":540,"y":880,"wires":[["b6721de2.ab5468"]]},{"id":"8f1e4c30.a8917","type":"api-call-service","z":"8d972e1e.28c54","name":"","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"plot_tiia","data":"","mergecontext":"","x":1000,"y":1100,"wires":[[]]},{"id":"b6721de2.ab5468","type":"api-call-service","z":"8d972e1e.28c54","name":"Plot","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"plot_luca","data":"","mergecontext":"","x":730,"y":880,"wires":[[]]},{"id":"7c24991e.8984f8","type":"time-range-switch","z":"8d972e1e.28c54","name":"","lat":"","lon":"","startTime":"07:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":350,"y":880,"wires":[["42985b12.84c6a4"],[]]},{"id":"e3d512f4.c7ba5","type":"time-range-switch","z":"8d972e1e.28c54","name":"","lat":"","lon":"","startTime":"07:00","endTime":"22:00","startOffset":0,"endOffset":0,"x":510,"y":1100,"wires":[["3de44bbc.9bdc44"],[]]},{"id":"a7ecad4.e3fde5","type":"api-current-state","z":"8d972e1e.28c54","name":"home?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.luca_home","outputs":1,"x":350,"y":820,"wires":[["6523eef5.b14c1"]]},{"id":"6523eef5.b14c1","type":"switch","z":"8d972e1e.28c54","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":510,"y":820,"wires":[["a6fb3960.cf4728"],["c02c1b57.8db328"]]},{"id":"a6fb3960.cf4728","type":"delay","z":"8d972e1e.28c54","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":670,"y":780,"wires":[["c02c1b57.8db328"]]},{"id":"4bc38268.694f7c","type":"api-current-state","z":"8d972e1e.28c54","name":"home?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.luca_home","outputs":1,"x":490,"y":1020,"wires":[["c127db36.d5dda8"]]},{"id":"c127db36.d5dda8","type":"switch","z":"8d972e1e.28c54","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":640,"y":1020,"wires":[["3cd42775.6924d8"],["d51741ae.0060e8"]]},{"id":"3cd42775.6924d8","type":"delay","z":"8d972e1e.28c54","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":770,"y":980,"wires":[["d51741ae.0060e8"]]},{"id":"217a7e78.fd8012","type":"trigger-state","z":"a1f7f54.5d30108","name":"Vacuum cleaning?","server":"90ba4a50.2b5e48","entityid":"vacuum.eve","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":860,"wires":[["5e6737e3.a18918"],[]]},{"id":"f65df844.7ca8e8","type":"api-call-service","z":"a1f7f54.5d30108","name":"Build map","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"build_map","data":"","mergecontext":"","x":1060,"y":860,"wires":[[]]},{"id":"54b20c8c.2830e4","type":"trigger","z":"a1f7f54.5d30108","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-8","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":660,"y":860,"wires":[["f408a9e.f012858"]]},{"id":"d3ca2c78.8087a","type":"change","z":"a1f7f54.5d30108","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":820,"wires":[["54b20c8c.2830e4"]]},{"id":"f408a9e.f012858","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":860,"y":860,"wires":[["f65df844.7ca8e8"]]},{"id":"5e6737e3.a18918","type":"switch","z":"a1f7f54.5d30108","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"docked","vt":"str"},{"t":"eq","v":"idle","vt":"str"},{"t":"eq","v":"cleaning","vt":"str"},{"t":"eq","v":"returning","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":290,"y":840,"wires":[["d3ca2c78.8087a"],["d3ca2c78.8087a"],["54b20c8c.2830e4"],["54b20c8c.2830e4"]]},{"id":"f960cbe8.d0e4b8","type":"api-current-state","z":"433e5229.16b5fc","name":"anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"group.anyone_downstairs","outputs":1,"x":1000,"y":1020,"wires":[["773e053b.0b1aac"]]},{"id":"dc4cee25.4a082","type":"api-call-service","z":"a1f7f54.5d30108","name":"Rename vacuum maps","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_vacuum_maps","data":"","mergecontext":"","x":570,"y":900,"wires":[[]]},{"id":"e586e273.ee9f1","type":"trigger-state","z":"a1f7f54.5d30108","name":"started cleaning","server":"90ba4a50.2b5e48","entityid":"vacuum.eve","debugenabled":false,"constraints":[{"id":"tnad27hg1n","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"docked"},{"id":"6qivkwr3naw","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"cleaning"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":940,"wires":[[],[]]},{"id":"9393831b.aa1fe","type":"delay","z":"49017fb.081c18","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":990,"y":1040,"wires":[[]]},{"id":"b3dc53a2.c71e5","type":"delay","z":"433e5229.16b5fc","name":"limit 10s","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":360,"y":1180,"wires":[["9b2a6980.5271a8"]]},{"id":"113e6ffc.b7729","type":"trigger-state","z":"433e5229.16b5fc","name":"Logi event","server":"90ba4a50.2b5e48","entityid":"sensor.logi_circle_living_room_last_activity","debugenabled":false,"constraints":[{"id":"b1yzf9llxxp","targetType":"entity_id","targetValue":"input_boolean.privacy_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":1180,"wires":[["b3dc53a2.c71e5"],[]]},{"id":"fa852885.efded8","type":"api-call-service","z":"433e5229.16b5fc","name":"camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"logi_circle_livestream_snapshot","data":"{   \"entity_id\": \"camera.living_room\", \"filename\": \"/images/logi/latest.jpg\" }","mergecontext":"","x":1330,"y":1300,"wires":[[]]},{"id":"dd15a39.0a2ec6","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":1120,"wires":[["b3dc53a2.c71e5"]]},{"id":"5cd84c62.e83dd4","type":"stoptimer","z":"433e5229.16b5fc","duration":"15","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1070,"y":1300,"wires":[["aa74e9f5.316978","8ebaeaea.921318"],[]]},{"id":"8ebaeaea.921318","type":"api-call-service","z":"433e5229.16b5fc","name":"Rename snapshots Logi","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_living_room","data":"","mergecontext":"","x":1270,"y":1240,"wires":[[]]},{"id":"e2263efb.18a9b","type":"api-current-state","z":"407269cb.c12fd8","name":"Anyone downstairs","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"group.anyone_downstairs","outputs":1,"x":550,"y":900,"wires":[["c764ae8a.edfee"]]},{"id":"c764ae8a.edfee","type":"switch","z":"407269cb.c12fd8","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":710,"y":900,"wires":[["3e0a76e5.4d7b4a"],["189e3677.7e4dca"]]},{"id":"189e3677.7e4dca","type":"stoptimer","z":"407269cb.c12fd8","duration":"5","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":900,"y":920,"wires":[["5066a3d9.eecd6c"],[]]},{"id":"5066a3d9.eecd6c","type":"api-render-template","z":"407269cb.c12fd8","name":"motion in the last 5 minutes","server":"90ba4a50.2b5e48","template":"{{ ((as_timestamp(now())-as_timestamp(states.sensor.downstairs_motion_sensors.last_updated)) < 240) or ((as_timestamp(now())-as_timestamp(states.binary_sensor.xiaofang2_motion_sensor.last_updated)) < 240) }}","x":1160,"y":920,"wires":[["2a1407e8.4ab278"]]},{"id":"5a918b5e.1beca4","type":"api-current-state","z":"407269cb.c12fd8","name":"media players?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"sensor.downstairs_media_players","outputs":1,"x":1600,"y":900,"wires":[["b029c2e0.d8689"]]},{"id":"1a384c8d.8d6533","type":"api-render-template","z":"407269cb.c12fd8","name":"motion in the last 15 minutes","server":"90ba4a50.2b5e48","template":"{{ ((as_timestamp(now())-as_timestamp(states.sensor.downstairs_motion_sensors.last_updated)) < 900) or ((as_timestamp(now())-as_timestamp(states.binary_sensor.xiaofang2_motion_sensor.last_updated)) < 900) }}","x":1160,"y":860,"wires":[["2a1407e8.4ab278"]]},{"id":"2a1407e8.4ab278","type":"switch","z":"407269cb.c12fd8","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1410,"y":880,"wires":[[],["5a918b5e.1beca4"]]},{"id":"79066eb8.302fd","type":"inject","z":"407269cb.c12fd8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":940,"wires":[["e2263efb.18a9b"]]},{"id":"b029c2e0.d8689","type":"api-current-state","z":"407269cb.c12fd8","name":"motion?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.living_room_motion_sensor","outputs":1,"x":1800,"y":880,"wires":[["f76e655.cefb398"]]},{"id":"5ad5b62c.5ce1f","type":"trigger-state","z":"433e5229.16b5fc","name":"Motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.living_room_motion_sensor","debugenabled":false,"constraints":[{"id":"9c4cbdz04nd","targetType":"entity_id","targetValue":"input_boolean.privacy_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":80,"y":1240,"wires":[[],[]]},{"id":"c68f471c.3f1638","type":"trigger-state","z":"433e5229.16b5fc","name":"Anyone downstairs","server":"90ba4a50.2b5e48","entityid":"input_boolean.someone_downstairs","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":150,"y":1400,"wires":[[],[]]},{"id":"dd8614e4.5c54b8","type":"switch","z":"433e5229.16b5fc","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":350,"y":1400,"wires":[["7350d03b.df65a8"],["b3689a0a.60a84"]]},{"id":"7350d03b.df65a8","type":"api-call-service","z":"433e5229.16b5fc","name":"Privacy mode on","server":"90ba4a50.2b5e48","service_domain":"camera","service":"logi_circle_set_config","data":"{\"entity_id\":\"camera.living_room\",\"mode\":\"PRIVACY_MODE\",\"value\":\"true\"}","mergecontext":"","x":610,"y":1400,"wires":[[]]},{"id":"b3689a0a.60a84","type":"api-call-service","z":"433e5229.16b5fc","name":"Privacy mode off","server":"90ba4a50.2b5e48","service_domain":"camera","service":"logi_circle_set_config","data":"{\"entity_id\":\"camera.living_room\",\"mode\":\"PRIVACY_MODE\",\"value\":\"false\"}","mergecontext":"","x":610,"y":1440,"wires":[[]]},{"id":"f9305312.deb85","type":"debug","z":"a1f7f54.5d30108","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2960,"y":520,"wires":[]},{"id":"d89fac84.50606","type":"trigger-state","z":"a1f7f54.5d30108","name":"Clean kitchen triggered","server":"90ba4a50.2b5e48","entityid":"script.vacuum_clean_kitchen","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":150,"y":1240,"wires":[["3d558fc5.ba613"],[]]},{"id":"3d558fc5.ba613","type":"api-render-template","z":"a1f7f54.5d30108","name":"Date and time kitchen vacuumed","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"input_datetime.last_time_kitchen_vacuumed\",\"date\":\"{{ now().date() }}\",\"time\":\"{{now().strftime('%H:%M:%S')}}\"}}","x":580,"y":1260,"wires":[["f38dafd.e59045"]]},{"id":"27cebf8f.52da1","type":"api-render-template","z":"a1f7f54.5d30108","name":"Date and time dining area vacuumed","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"input_datetime.last_time_dining_area_vacuumed\",\"date\":\"{{ now().date() }}\",\"time\":\"{{now().strftime('%H:%M:%S')}}\"}}","x":590,"y":1300,"wires":[["f38dafd.e59045"]]},{"id":"88121638.52b2e8","type":"api-render-template","z":"a1f7f54.5d30108","name":"Date and time vacuumed","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"input_datetime.last_time_vacuumed\",\"date\":\"{{ now().date() }}\",\"time\":\"{{now().strftime('%H:%M:%S')}}\"}}","x":550,"y":1460,"wires":[["f38dafd.e59045"]]},{"id":"180952ab.72cecd","type":"api-render-template","z":"a1f7f54.5d30108","name":"Date and time hallway vacuumed","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"input_datetime.last_time_hallway_vacuumed\",\"date\":\"{{ now().date() }}\",\"time\":\"{{now().strftime('%H:%M:%S')}}\"}}","x":580,"y":1420,"wires":[["f38dafd.e59045"]]},{"id":"f38dafd.e59045","type":"api-call-service","z":"a1f7f54.5d30108","name":"Set Date","server":"90ba4a50.2b5e48","service_domain":"input_datetime","service":"set_datetime","data":"","mergecontext":"","x":1020,"y":1320,"wires":[[]]},{"id":"75fade8d.7ae1a","type":"trigger-state","z":"a1f7f54.5d30108","name":"Clean dining area triggered","server":"90ba4a50.2b5e48","entityid":"script.vacuum_clean_dining_area","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":160,"y":1340,"wires":[["27cebf8f.52da1"],[]]},{"id":"a9905f92.4bfcb","type":"trigger-state","z":"a1f7f54.5d30108","name":"Clean dining area kitchen triggered","server":"90ba4a50.2b5e48","entityid":"script.vacuum_clean_dining_area_kitchen","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":180,"y":1291,"wires":[["3d558fc5.ba613","27cebf8f.52da1"],[]]},{"id":"8c98e32a.526bf","type":"trigger-state","z":"a1f7f54.5d30108","name":"Clean hallway triggered","server":"90ba4a50.2b5e48","entityid":"script.vacuum_clean_hallway","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":150,"y":1440,"wires":[["180952ab.72cecd"],[]]},{"id":"1015dbb1.07b3c4","type":"api-render-template","z":"a1f7f54.5d30108","name":"Add vacuum time","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\": \"input_number.vacuum_cleaning_time\",\"value\":\"{{ states.input_number.vacuum_cleaning_time.state|int + states.sensor.vacuum_cleaning_time.state|int }}\"}}","x":730,"y":760,"wires":[["f807c90f.f5d6f8"]]},{"id":"f807c90f.f5d6f8","type":"api-call-service","z":"a1f7f54.5d30108","name":"Set cleaning time","server":"90ba4a50.2b5e48","service_domain":"input_number","service":"set_value","data":"","mergecontext":"","x":1010,"y":760,"wires":[[]]},{"id":"c577ed5a.0a202","type":"api-call-service","z":"a1f7f54.5d30108","name":"Set cleaning time to 0","server":"90ba4a50.2b5e48","service_domain":"input_number","service":"set_value","data":"{\"entity_id\":\"input_number.vacuum_cleaning_time\",\"value\":0}","mergecontext":"","x":700,"y":700,"wires":[[]]},{"id":"b443bb38.0da658","type":"trigger-state","z":"a1f7f54.5d30108","name":"Vacuum time updated","server":"90ba4a50.2b5e48","entityid":"sensor.vacuum_cleaning_time","debugenabled":false,"constraints":[{"id":"lhe9gv2p81f","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"0"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":140,"y":780,"wires":[["f4d86d5.f2b999"],[]]},{"id":"f4d86d5.f2b999","type":"api-call-service","z":"a1f7f54.5d30108","name":"Increment cleaning time","server":"90ba4a50.2b5e48","service_domain":"input_number","service":"increment","data":"{\"entity_id\":\"input_number.vacuum_cleaning_time\"}","mergecontext":"","x":410,"y":760,"wires":[[]]},{"id":"d323c68a.6f3808","type":"trigger-state","z":"433e5229.16b5fc","name":"TV on?","server":"90ba4a50.2b5e48","entityid":"media_player.lg_webos_smart_tv","debugenabled":false,"constraints":[{"id":"4zbeif63sir","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"},{"id":"phd8a15jqkp","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":true,"x":90,"y":1320,"wires":[[],[]]},{"id":"54336d4a.7396f4","type":"api-render-template","z":"407269cb.c12fd8","name":"motion in the last 5 minutes","server":"90ba4a50.2b5e48","template":"{{ (as_timestamp(now())-as_timestamp(states.sensor.downstairs_motion_sensors.last_updated)) < 300 }}","x":820,"y":780,"wires":[["d39e47e2.e93b78"]]},{"id":"d39e47e2.e93b78","type":"switch","z":"407269cb.c12fd8","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1050,"y":780,"wires":[[],["300d6e35.d591f2"]]},{"id":"51895f77.6b28e","type":"api-call-service","z":"69646b1e.2e5084","name":"Color Mode off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.color_mode\"}","mergecontext":"","x":480,"y":80,"wires":[[]]},{"id":"657236e7.abcba8","type":"trigger-state","z":"ce1e28e9.1a74d8","name":"Air conditioner on","server":"90ba4a50.2b5e48","entityid":"switch.air_conditioner","debugenabled":false,"constraints":[{"id":"7xkr79ije0d","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"an3rvf4t417","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":250,"y":700,"wires":[[],[]]},{"id":"eb6cd421.dd4e58","type":"trigger-state","z":"ce1e28e9.1a74d8","name":"","server":"90ba4a50.2b5e48","entityid":"sensor.air_purifier_temperature","debugenabled":false,"constraints":[{"id":"az2a0ti5l1n","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"greater_than","comparatorValueDatatype":"num","comparatorValue":"25"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"x":319.5,"y":472,"wires":[[],[]]},{"id":"eaf900c9.e4517","type":"time-range-switch","z":"ce1e28e9.1a74d8","name":"","lat":"","lon":"","startTime":"22:30","endTime":"23:30","startOffset":0,"endOffset":0,"x":635.5,"y":468,"wires":[["59094ab1.e03404"],[]]},{"id":"59094ab1.e03404","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"AC on","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_on","data":"{\"entity_id\":\"switch.air_conditioner\"}","mergecontext":"","x":811.5,"y":415,"wires":[[]]},{"id":"cdfa64fc.46f468","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"AC off","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.air_conditioner\"}","mergecontext":"","x":748.5,"y":695,"wires":[[]]},{"id":"c50a40a4.2d3f","type":"stoptimer","z":"ce1e28e9.1a74d8","duration":"30","units":"Minute","payloadtype":"num","payloadval":"0","name":"","x":522,"y":697,"wires":[["cdfa64fc.46f468"],[]]},{"id":"8e4496e6.73e878","type":"trigger-state","z":"ce1e28e9.1a74d8","name":"Anyone home?","server":"90ba4a50.2b5e48","entityid":"group.anyone_home","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":140,"y":80,"wires":[["4056ea6e.776d84"],[]]},{"id":"4056ea6e.776d84","type":"switch","z":"ce1e28e9.1a74d8","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":450,"y":80,"wires":[["30b2b749.d7a098"],["df950e61.23024"]]},{"id":"30b2b749.d7a098","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"Away mode off","server":"90ba4a50.2b5e48","service_domain":"climate","service":"set_away_mode","data":"{\"entity_id\":\"climate.netatmo_living_room\",\"away_mode\":\"false\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":700,"y":40,"wires":[[]]},{"id":"df950e61.23024","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"Away mode on","server":"90ba4a50.2b5e48","service_domain":"climate","service":"set_away_mode","data":"{\"entity_id\":\"climate.netatmo_living_room\",\"away_mode\":\"true\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":700,"y":100,"wires":[[]]},{"id":"29f7cc4b.cab2e4","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.sighthound_logi_latest\"}","mergecontext":"","x":1920,"y":1220,"wires":[[]]},{"id":"aa74e9f5.316978","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_logi_latest\"}","mergecontext":"","x":1260,"y":1420,"wires":[[]]},{"id":"60cdee83.adce1","type":"api-render-template","z":"a1f7f54.5d30108","name":"Date and time vacuumed","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"input_datetime.last_time_living_room_vacuumed\",\"date\":\"{{ now().date() }}\",\"time\":\"{{now().strftime('%H:%M:%S')}}\"}}","x":550,"y":1360,"wires":[["f38dafd.e59045"]]},{"id":"1a4c46b1.e68d49","type":"trigger-state","z":"a1f7f54.5d30108","name":"Clean living room triggered","server":"90ba4a50.2b5e48","entityid":"script.vacuum_clean_livingroom","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":160,"y":1400,"wires":[["60cdee83.adce1"],[]]},{"id":"cbe6d17f.f6bfb","type":"trigger-state","z":"a1f7f54.5d30108","name":"stopped cleaning","server":"90ba4a50.2b5e48","entityid":"vacuum.eve","debugenabled":false,"constraints":[{"id":"315utlgtl6p","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"docked"},{"id":"1ivj687rb6pk","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"returning"},{"id":"gxxgfxc6pls","targetType":"entity_id","targetValue":"sensor.vacuum_cleaning_time","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"4"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1000,"wires":[["dc4cee25.4a082","452e23d0.4d12ac","4e039bd.fd90064"],[]]},{"id":"7ac8e8eb.515e68","type":"trigger-state","z":"a1f7f54.5d30108","name":"Cleaning time","server":"90ba4a50.2b5e48","entityid":"sensor.vacuum_cleaning_time","debugenabled":false,"constraints":[{"id":"iwhtohqr81","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"num","comparatorValue":"0"},{"id":"rxf8cr12nxg","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"5"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":900,"wires":[[],[]]},{"id":"a4e9fe3c.9e624","type":"trigger-state","z":"49017fb.081c18","name":"Bottom hold","server":"90ba4a50.2b5e48","entityid":"sensor.dimmer_switch","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"id0orfh7iie","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"4_hold"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":2120,"wires":[["29ef8cc3.afc7a4"],[]]},{"id":"666279e9.f02e18","type":"api-call-service","z":"49017fb.081c18","name":"All lights off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"transition\":30}","mergecontext":"","x":590,"y":120,"wires":[[]]},{"id":"29ef8cc3.afc7a4","type":"api-call-service","z":"49017fb.081c18","name":"All lights off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"transition\":30}","mergecontext":"","x":400,"y":2120,"wires":[[]]},{"id":"c15b6b96.f18a18","type":"trigger-state","z":"49017fb.081c18","name":"Bottom click","server":"90ba4a50.2b5e48","entityid":"sensor.dimmer_switch","debugenabled":false,"constraints":[{"id":"hka17g5vqit","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"4_click"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":2180,"wires":[[],[]]},{"id":"504d0685.6d40c8","type":"trigger-state","z":"49017fb.081c18","name":"Top click","server":"90ba4a50.2b5e48","entityid":"sensor.dimmer_switch","debugenabled":false,"constraints":[{"id":"4k2n8j39vm5","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"1_click_up"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":2240,"wires":[["8a5490d3.705ed"],[]]},{"id":"8a5490d3.705ed","type":"api-call-service","z":"49017fb.081c18","name":"Office toggle","server":"90ba4a50.2b5e48","service_domain":"light","service":"toggle","data":"{\"entity_id\":\"light.office\"}","mergecontext":"","x":410,"y":2240,"wires":[[]]},{"id":"5701fa70.c90f04","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_xiaofang2_living_room_presence\"}","mergecontext":"","x":2020,"y":1160,"wires":[[]]},{"id":"54fbe61b.107558","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_living_room_presence_model\"}","mergecontext":"","x":1920,"y":1280,"wires":[[]]},{"id":"44616fba.66c5c","type":"trigger-state","z":"407269cb.c12fd8","name":"No one downstairs","server":"90ba4a50.2b5e48","entityid":"group.anyone_downstairs","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"qgl1zxp4lo","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":880,"wires":[["e9aaa9c7.1c52b8"],[]]},{"id":"a5468bd6.3c6dd8","type":"trigger-state","z":"433e5229.16b5fc","name":"Outside motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.outside_motion","debugenabled":false,"constraints":[{"id":"ocrtlucou3n","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":2360,"wires":[["6f58c048.1ab69"],[]]},{"id":"6f58c048.1ab69","type":"delay","z":"433e5229.16b5fc","name":"limit 30 s","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":300,"y":2360,"wires":[["cfeac666.d26dd8","858321ca.ed558","4a672690.caec28"]]},{"id":"60fde6bc.c21ab8","type":"api-call-service","z":"433e5229.16b5fc","name":"Camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.raspberry\", \"filename\": \"/images/raspberry/latest.jpg\" }","mergecontext":"","x":1190,"y":2260,"wires":[[]]},{"id":"202f9a5f.f54736","type":"stoptimer","z":"433e5229.16b5fc","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1170,"y":2320,"wires":[["7bd23876.84f7a8"],[]]},{"id":"7bd23876.84f7a8","type":"api-call-service","z":"433e5229.16b5fc","name":"Rename snapshots raspberry","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_raspberry","data":"","mergecontext":"","x":1430,"y":2320,"wires":[[]]},{"id":"4a672690.caec28","type":"api-call-service","z":"433e5229.16b5fc","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Motion detected outside\",\"target\":\"BROADCAST\"}","mergecontext":"","x":520,"y":2480,"wires":[[]]},{"id":"68be724f.b6a96c","type":"api-call-service","z":"a1f7f54.5d30108","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Done eating - starting vacuum\",\"target\":\"BROADCAST\"}","mergecontext":"","x":460,"y":540,"wires":[[]]},{"id":"9fe43153.438d8","type":"api-call-service","z":"a1f7f54.5d30108","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Chairs on table detected - starting vacuum\",\"target\":\"BROADCAST\"}","mergecontext":"","x":300,"y":440,"wires":[[]]},{"id":"c77e59c4.56eef8","type":"api-call-service","z":"a1f7f54.5d30108","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Done eating - starting vacuum\",\"target\":\"BROADCAST\"}","mergecontext":"","x":1220,"y":300,"wires":[[]]},{"id":"90efc6e2.1f9e98","type":"template","z":"a1f7f54.5d30108","name":"message template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"message\":\"{{payload}}\", \"target\":\"BROADCAST\"}}","output":"str","x":1050,"y":300,"wires":[["c77e59c4.56eef8"]]},{"id":"b6166a93.c1f8b8","type":"api-render-template","z":"407269cb.c12fd8","name":"Anyone downstairs or person detected AND motion in the last 5 minutes","server":"90ba4a50.2b5e48","template":"{{ (states.group.anyone_downstairs.state == 'on' or states.binary_sensor.people_detected_downstairs.state == 'on') and ((as_timestamp(now())-as_timestamp(states.sensor.downstairs_motion_sensors.last_updated)) < 300 ) }}","x":740,"y":120,"wires":[["ab0a49d3.717ab8"]]},{"id":"ab0a49d3.717ab8","type":"switch","z":"407269cb.c12fd8","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1110,"y":120,"wires":[["790a7577.4a647c","9cc38010.cf781"],[]]},{"id":"4d1af4d9.cf68fc","type":"trigger-state","z":"407269cb.c12fd8","name":"Person detected","server":"90ba4a50.2b5e48","entityid":"binary_sensor.people_detected_downstairs","debugenabled":false,"constraints":[{"id":"0ayadnq5ydz","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"bxzo5jyr8fm","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"hcx9ck948j5","targetType":"entity_id","targetValue":"input_boolean.anyone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":60,"wires":[["e07b12e4.687aa"],[]]},{"id":"28bd9414.4f8ccc","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_people_logi\"}","mergecontext":"","x":1960,"y":1340,"wires":[[]]},{"id":"16d7705a.1066b","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Announce stream","server":"90ba4a50.2b5e48","entityid":"calendar.gdq","debugenabled":false,"constraints":[{"id":"himtiscaft","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"6fm7i0ur8v","targetType":"entity_id","targetValue":"input_boolean.announce_streams","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1040,"wires":[["d9e20625.41d0a8","c12d3dce.06436"],[]]},{"id":"f7287f6.88c1a8","type":"time-range-switch","z":"c84fe94a.0c50b8","name":"","lat":"","lon":"","startTime":"09:00","endTime":"22:30","startOffset":0,"endOffset":0,"x":350,"y":1040,"wires":[["a5bfad18.6024a"],[]]},{"id":"6155ed21.678fd4","type":"api-render-template","z":"c84fe94a.0c50b8","name":"GDQ template","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"media_player.white_sonos_one\", \"message\":\"{{ states.calendar.gdq.attributes.message }} is starting soon\"}}","x":1500,"y":1120,"wires":[["ff31517f.d7dd"]]},{"id":"ff31517f.d7dd","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Trigger TTS","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"","mergecontext":"","x":1790,"y":1040,"wires":[[]]},{"id":"84b46ca2.c2d3b","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Anyone downstairs","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"group.anyone_downstairs","outputs":1,"x":1130,"y":1020,"wires":[["6739cc7a.39af34"]]},{"id":"6739cc7a.39af34","type":"switch","z":"c84fe94a.0c50b8","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1310,"y":1020,"wires":[["aeef577a.d2f008","92ca6dda.6be06"],["6155ed21.678fd4","dea98f13.32ae5"]]},{"id":"dea98f13.32ae5","type":"api-render-template","z":"c84fe94a.0c50b8","name":"GDQ template","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"media_player.echo\", \"message\":\"{{ states.calendar.gdq.attributes.message }} is starting soon\"}}","x":1500,"y":1080,"wires":[["ff31517f.d7dd"]]},{"id":"aeef577a.d2f008","type":"api-render-template","z":"c84fe94a.0c50b8","name":"GDQ template","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"media_player.beam\", \"message\":\"{{ states.calendar.gdq.attributes.message }} is starting soon\"}}","x":1500,"y":1000,"wires":[["ff31517f.d7dd"]]},{"id":"92ca6dda.6be06","type":"api-render-template","z":"c84fe94a.0c50b8","name":"GDQ template","server":"90ba4a50.2b5e48","template":"{\"data\":{\"entity_id\":\"media_player.black_sonos_one\", \"message\":\"{{ states.calendar.gdq.attributes.message }} is starting soon\"}}","x":1500,"y":960,"wires":[["ff31517f.d7dd"]]},{"id":"f69ee0f6.4ca728","type":"trigger-state","z":"407269cb.c12fd8","name":"Person detected","server":"90ba4a50.2b5e48","entityid":"binary_sensor.people_detected_downstairs","debugenabled":false,"constraints":[{"id":"bxzo5jyr8fm","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"5s38iocxn8y","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":740,"wires":[["e9aaa9c7.1c52b8"],[]]},{"id":"1a24533b.4db98d","type":"trigger-state","z":"ce1e28e9.1a74d8","name":"Anyone downstairs?","server":"90ba4a50.2b5e48","entityid":"input_boolean.someone_downstairs","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":160,"y":180,"wires":[["89497565.2c24b8"],[]]},{"id":"89497565.2c24b8","type":"switch","z":"ce1e28e9.1a74d8","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":390,"y":180,"wires":[["563489d3.5a6028"],["157ee394.c6aebc"]]},{"id":"563489d3.5a6028","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"Set to 21 degrees","server":"90ba4a50.2b5e48","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.netatmo_living_room\",\"temperature\":21,\"operation_mode\":\"manual\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":590,"y":160,"wires":[[]]},{"id":"157ee394.c6aebc","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"Set to schedule","server":"90ba4a50.2b5e48","service_domain":"climate","service":"set_operation_mode","data":"{\"entity_id\":\"climate.netatmo_living_room\",\"operation_mode\":\"Schedule\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":580,"y":220,"wires":[[]]},{"id":"c41c394f.3725d8","type":"trigger-state","z":"ce1e28e9.1a74d8","name":"Sleeping?","server":"90ba4a50.2b5e48","entityid":"binary_sensor.sleeping","debugenabled":false,"constraints":[{"id":"2s499gjzuxp","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":280,"wires":[["aa0b178.a94a8e8"],[]]},{"id":"aa0b178.a94a8e8","type":"api-call-service","z":"ce1e28e9.1a74d8","name":"Set to 16 degrees","server":"90ba4a50.2b5e48","service_domain":"climate","service":"set_temperature","data":"{\"entity_id\":\"climate.netatmo_living_room\",\"temperature\":16,\"operation_mode\":\"manual\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":350,"y":280,"wires":[[]]},{"id":"326ffe9c.f0d44a","type":"delay","z":"433e5229.16b5fc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":760,"y":1020,"wires":[["f960cbe8.d0e4b8"]]},{"id":"9cc38010.cf781","type":"api-call-service","z":"407269cb.c12fd8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Someone downstairs - person and motion detected\",\"target\":\"BROADCAST\"}","mergecontext":"","x":1280,"y":80,"wires":[[]]},{"id":"f3de4435.7a8238","type":"api-render-template","z":"407269cb.c12fd8","name":"motion in the last 5 minutes","server":"90ba4a50.2b5e48","template":"{{ (as_timestamp(now())-as_timestamp(states.sensor.downstairs_motion_sensors.last_updated)) < 300 }}","x":1000,"y":60,"wires":[["ab0a49d3.717ab8"]]},{"id":"e8c87a7b.05e5e8","type":"api-render-template","z":"407269cb.c12fd8","name":"someone came downstairs","server":"90ba4a50.2b5e48","template":"{{ (as_timestamp(now())-as_timestamp(states.sensor.downstairs_motion_sensors.last_updated)) < 300 or (states.binary_sensor.motion_hallway_upstairs.state == 'on' and states.binary_sensor.motion_hallway_upstairs_2.state == 'on') }}","x":640,"y":180,"wires":[["11793ca7.11fee3"]]},{"id":"11793ca7.11fee3","type":"switch","z":"407269cb.c12fd8","name":"True/False","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":930,"y":200,"wires":[["790a7577.4a647c"],[]]},{"id":"5b2c0e39.90296","type":"trigger-state","z":"407269cb.c12fd8","name":"Livingroom light on","server":"90ba4a50.2b5e48","entityid":"light.living_room","debugenabled":false,"constraints":[{"id":"o6ca02s4f3l","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":180,"wires":[["e8c87a7b.05e5e8"],[]]},{"id":"6b290c29.8932e4","type":"trigger-state","z":"407269cb.c12fd8","name":"Motion on","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_kitchen_xiaomi","debugenabled":false,"constraints":[{"id":"cr35bk7njmp","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"alxt9wob899","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"mm0q7mm73x","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":340,"y":60,"wires":[["790a7577.4a647c"],[]]},{"id":"ba15a8ea.b003f8","type":"trigger-state","z":"49017fb.081c18","name":"Luca downstairs","server":"90ba4a50.2b5e48","entityid":"binary_sensor.luca_downstairs_wifi","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"eesnc4ya8gs","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"kt51gbamdl","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":1800,"wires":[["983266bf.55e2a8"],[]]},{"id":"91810975.112f38","type":"trigger-state","z":"49017fb.081c18","name":"Tiia downstairs","server":"90ba4a50.2b5e48","entityid":"binary_sensor.tiia_downstairs_wifi","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"eesnc4ya8gs","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"kzt9l57zhz","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":1860,"wires":[["983266bf.55e2a8"],[]]},{"id":"dc487a59.3ef198","type":"api-render-template","z":"49017fb.081c18","name":"Tiia away or downstairs","server":"90ba4a50.2b5e48","template":"{{ is_state('binary_sensor.tiia_home', 'off') or is_state('binary_sensor.tiia_downstairs_wifi', 'on') }}","x":450,"y":1960,"wires":[["a8b4a9af.016db8"]]},{"id":"a8b4a9af.016db8","type":"switch","z":"49017fb.081c18","name":"True","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":610,"y":1920,"wires":[["e09c3d85.21117"]]},{"id":"9fd10a4b.dea5c8","type":"api-render-template","z":"49017fb.081c18","name":"Luca away or downstairs","server":"90ba4a50.2b5e48","template":"{{ is_state('binary_sensor.luca_home', 'off') or is_state('binary_sensor.luca_downstairs_wifi', 'on') }}","x":470,"y":2000,"wires":[["ca187c8e.5dd33"]]},{"id":"ca187c8e.5dd33","type":"switch","z":"49017fb.081c18","name":"True","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":630,"y":1980,"wires":[["e09c3d85.21117"]]},{"id":"e09c3d85.21117","type":"api-call-service","z":"49017fb.081c18","name":"Upstairs lights off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"group.upstairs_lights\"}","mergecontext":"","x":830,"y":1820,"wires":[[]]},{"id":"fa1873f4.036c88","type":"api-current-state","z":"407269cb.c12fd8","name":"media players?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"sensor.downstairs_media_players","outputs":1,"x":1540,"y":820,"wires":[["f76e655.cefb398"]]},{"id":"666df805.6cbc88","type":"cron","z":"433e5229.16b5fc","name":"Every hour","crontab":"0 * * * *","x":320,"y":1280,"wires":[["a28943f8.b2736"]]},{"id":"2061d228.34778e","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Eating","server":"90ba4a50.2b5e48","entityid":"binary_sensor.eating","debugenabled":false,"constraints":[{"id":"icbn0m3ugoh","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"6o69rde6qnm","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"62pytcwlzs","targetType":"entity_id","targetValue":"input_boolean.take_medicine","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"zae53ch1ejn","targetType":"entity_id","targetValue":"binary_sensor.tiia_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"5315d0pe6pb","targetType":"entity_id","targetValue":"input_boolean.guest_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":1200,"wires":[["18c95e66.a92b82"],[]]},{"id":"559977b7.55c518","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Trigger TTS","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\": \"media_player.beam\", \"message\":\"Remember to take your medicine\"}","mergecontext":"","x":310,"y":1300,"wires":[[]]},{"id":"983266bf.55e2a8","type":"api-render-template","z":"49017fb.081c18","name":"motion, downstairs or away","server":"90ba4a50.2b5e48","template":"{{ is_state('binary_sensor.playing_games','off') and is_state('binary_sensor.motion_hallway_upstairs_2','off') and (is_state('binary_sensor.tiia_home', 'off') or is_state('binary_sensor.tiia_downstairs_wifi', 'on')) and ( is_state('binary_sensor.luca_home', 'off') or is_state('binary_sensor.luca_downstairs_wifi', 'on')) }}","x":420,"y":1840,"wires":[["a959a7b4.82cb68"]]},{"id":"a959a7b4.82cb68","type":"switch","z":"49017fb.081c18","name":"True","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":610,"y":1840,"wires":[["e09c3d85.21117"]]},{"id":"60d53507.5d730c","type":"trigger-state","z":"49017fb.081c18","name":"Motion in hallway upstairs off","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_hallway_upstairs_2","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"sjfjjbvgvx","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"7j4cs96ebbx","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"tgwl5vemuz9","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":140,"y":1920,"wires":[["983266bf.55e2a8"],[]]},{"id":"fe217086.cfdeb","type":"api-render-template","z":"49017fb.081c18","name":"motion, downstairs or away","server":"90ba4a50.2b5e48","template":"{{ ((as_timestamp(now())-as_timestamp(states.binary_sensor.motion_hallway_upstairs_2.last_updated)) < 300) and (is_state('binary_sensor.tiia_home', 'off') or is_state('binary_sensor.tiia_downstairs_wifi', 'on')) and ( is_state('binary_sensor.luca_home', 'off') or is_state('binary_sensor.luca_downstairs_wifi', 'on')) }}","x":440,"y":1880,"wires":[[]]},{"id":"77ff9ca5.be14c4","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Trigger TTS","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"{\"entity_id\": \"media_player.black_sonos_one\", \"message\":\"Remember to take your medicine\"}","mergecontext":"","x":130,"y":1300,"wires":[[]]},{"id":"6cab3866.d1a988","type":"change","z":"433e5229.16b5fc","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":2660,"wires":[["aa3909e3.45fde8"]]},{"id":"aa3909e3.45fde8","type":"trigger","z":"433e5229.16b5fc","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-30","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":650,"y":2620,"wires":[["48be7b1d.0f9574"]]},{"id":"48be7b1d.0f9574","type":"delay","z":"433e5229.16b5fc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":840,"y":2620,"wires":[["a2b039aa.cceda8"]]},{"id":"8b8af9d0.26b7f8","type":"switch","z":"433e5229.16b5fc","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":250,"y":2620,"wires":[["aa3909e3.45fde8","3d4bdbc4.23a444"],["6cab3866.d1a988","121d2568.a6709b"]]},{"id":"1cc787a4.b66ce8","type":"cron","z":"407269cb.c12fd8","name":"At midnight","crontab":"0 0 * * *","x":110,"y":1120,"wires":[["54200bba.9d7bd4"]]},{"id":"54200bba.9d7bd4","type":"api-call-service","z":"407269cb.c12fd8","name":"Turn on take medicine","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.take_medicine\"}","mergecontext":"","x":400,"y":1140,"wires":[[]]},{"id":"6a684113.588e5","type":"api-current-state","z":"9114d340.f3aed","name":"Living room player","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"media_player.living_room","outputs":1,"x":350,"y":200,"wires":[["b9c0a79f.fb6b18"]]},{"id":"b9c0a79f.fb6b18","type":"switch","z":"9114d340.f3aed","name":"playing","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":540,"y":200,"wires":[["442aac47.40eb04"],["3a105f33.12f74"]]},{"id":"3a105f33.12f74","type":"api-current-state","z":"9114d340.f3aed","name":"Kitchen player","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"media_player.kitchen","outputs":1,"x":340,"y":260,"wires":[["b8989d37.3bceb"]]},{"id":"b8989d37.3bceb","type":"switch","z":"9114d340.f3aed","name":"playing","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":540,"y":260,"wires":[["3452efb4.3ad88"],["b614301f.d4815"]]},{"id":"b614301f.d4815","type":"api-current-state","z":"9114d340.f3aed","name":"Upstairs player","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"media_player.bedroom","outputs":1,"x":340,"y":320,"wires":[["c00482ee.f2a06"]]},{"id":"c00482ee.f2a06","type":"switch","z":"9114d340.f3aed","name":"playing","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":540,"y":320,"wires":[["5b9f1b90.93d294"],[]]},{"id":"442aac47.40eb04","type":"api-call-service","z":"9114d340.f3aed","name":"Set living room as main player","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.music_controller\",\"option\":\"living_room\"}","mergecontext":"","x":790,"y":180,"wires":[[]]},{"id":"3452efb4.3ad88","type":"api-call-service","z":"9114d340.f3aed","name":"Set kitchen as main player","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.music_controller\",\"option\":\"kitchen\"}","mergecontext":"","x":780,"y":240,"wires":[[]]},{"id":"5b9f1b90.93d294","type":"api-call-service","z":"9114d340.f3aed","name":"Set upstairs as main player","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.music_controller\",\"option\":\"bedroom\"}","mergecontext":"","x":780,"y":300,"wires":[[]]},{"id":"24c8f809.f4c808","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":140,"wires":[["34ec0844.a536d8","e64bc1fc.d574c"]]},{"id":"53957c9c.066904","type":"trigger-state","z":"9114d340.f3aed","name":"Speakers on","server":"90ba4a50.2b5e48","entityid":"binary_sensor.sonos_speakers","debugenabled":false,"constraints":[{"id":"6e4p7xfb6l","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"ets35dw086","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":260,"wires":[["6a684113.588e5"],[]]},{"id":"5185dfb.a0bd82","type":"trigger-state","z":"9114d340.f3aed","name":"Beam TV","server":"90ba4a50.2b5e48","entityid":"sensor.beam_source","debugenabled":false,"constraints":[{"id":"ets35dw086","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"clwzynehwpb","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"TV"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":680,"wires":[["9db82d52.e539c","33c03456.f4084c"],[]]},{"id":"9db82d52.e539c","type":"api-call-service","z":"9114d340.f3aed","name":"Set living room as main player","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.music_controller\",\"option\":\"living_room\"}","mergecontext":"","x":390,"y":640,"wires":[[]]},{"id":"33c03456.f4084c","type":"api-current-state","z":"9114d340.f3aed","name":"Follow music on","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.follow_music","outputs":1,"x":340,"y":700,"wires":[["41630a5e.79cf54","b2e7d02b.3d2f5"]]},{"id":"b2e7d02b.3d2f5","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":680,"y":720,"wires":[["a8a83b2e.a53af8"]]},{"id":"41630a5e.79cf54","type":"api-call-service","z":"9114d340.f3aed","name":"Turn off","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.follow_music\"}","mergecontext":"","x":880,"y":680,"wires":[[]]},{"id":"a8a83b2e.a53af8","type":"api-call-service","z":"9114d340.f3aed","name":"Turn on","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.follow_music\"}","mergecontext":"","x":820,"y":740,"wires":[[]]},{"id":"f0eaec57.c47b2","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"","mergecontext":"","x":560,"y":1420,"wires":[[]]},{"id":"de017dcb.1cd098","type":"inject","z":"c84fe94a.0c50b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":1360,"wires":[["f23da592.8470d8"]]},{"id":"d9e20625.41d0a8","type":"api-render-template","z":"c84fe94a.0c50b8","name":"GDQ template","server":"90ba4a50.2b5e48","template":"{\"data\":{\"message\":\"{{ states.calendar.gdq.attributes.message }} is starting soon\",\"target\":\"BROADCAST\"}}","x":340,"y":1120,"wires":[["803b8364.9226d"]]},{"id":"21842116.7395fe","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Test\",\"target\":\"BROADCAST\",\"data\":{\"attachment\":{\"type\":\"image\",\"payload\":{\"url\":\"https://URL.duckdns.org:8123/local/navmap.png\"}}}}","mergecontext":"","x":560,"y":1360,"wires":[[]]},{"id":"cad04878.960478","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Test https://URL.duckdns.org:8123/local/tensorflow.jpg\",\"target\":\"BROADCAST\"}","mergecontext":"","x":860,"y":1280,"wires":[[]]},{"id":"776823f9.ca7ddc","type":"template","z":"c84fe94a.0c50b8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":300,"y":140,"wires":[[]]},{"id":"2fd72053.459b1","type":"trigger-state","z":"433e5229.16b5fc","name":"Eating?","server":"90ba4a50.2b5e48","entityid":"binary_sensor.eating","debugenabled":false,"constraints":[{"id":"jilin0uuiu","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":90,"y":2620,"wires":[["8b8af9d0.26b7f8"],[]]},{"id":"3d4bdbc4.23a444","type":"api-call-service","z":"433e5229.16b5fc","name":"Light red","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.ball\",\"brightness_pct\":100,\"rgb_color\":[255,65,0]}","mergecontext":"","x":420,"y":2580,"wires":[[]]},{"id":"121d2568.a6709b","type":"api-call-service","z":"433e5229.16b5fc","name":"Light off","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"light.ball\"}","mergecontext":"","x":420,"y":2700,"wires":[[]]},{"id":"39f25bd9.77fb54","type":"trigger-state","z":"433e5229.16b5fc","name":"Cat detected?","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_cat_dafang","debugenabled":false,"constraints":[{"id":"jilin0uuiu","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"hw50d5wr0f","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":2820,"wires":[[],[]]},{"id":"8b60f093.9fb54","type":"switch","z":"433e5229.16b5fc","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":290,"y":2820,"wires":[["4d609a00.977718"],["f572a666.efe588"]]},{"id":"4d609a00.977718","type":"trigger","z":"433e5229.16b5fc","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-60","extend":false,"units":"s","reset":"","bytopic":"all","name":"","x":660,"y":2820,"wires":[["69ed32b0.f0af3c"]]},{"id":"f572a666.efe588","type":"change","z":"433e5229.16b5fc","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":2860,"wires":[["4d609a00.977718"]]},{"id":"69ed32b0.f0af3c","type":"delay","z":"433e5229.16b5fc","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":850,"y":2820,"wires":[["52a47c99.bfd8d4"]]},{"id":"52a47c99.bfd8d4","type":"api-call-service","z":"433e5229.16b5fc","name":"camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{\"entity_id\": \"camera.dafang\", \"filename\": \"/images/cat/{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg\" }","mergecontext":"","x":1080,"y":2820,"wires":[[]]},{"id":"7f12ca6e.669614","type":"trigger-state","z":"433e5229.16b5fc","name":"Lights on?","server":"90ba4a50.2b5e48","entityid":"binary_sensor.kitchen_lights_on","debugenabled":false,"constraints":[{"id":"jilin0uuiu","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":1740,"wires":[[],[]]},{"id":"fd98744.33e2588","type":"trigger-state","z":"433e5229.16b5fc","name":"Should clean?","server":"90ba4a50.2b5e48","entityid":"binary_sensor.dining_table_cleaning","debugenabled":false,"constraints":[{"id":"jilin0uuiu","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"yzffzvpp6q","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":1840,"wires":[[],[]]},{"id":"ace27338.12edf","type":"trigger-state","z":"433e5229.16b5fc","name":"Should vacuum?","server":"90ba4a50.2b5e48","entityid":"binary_sensor.should_vacuum","debugenabled":false,"constraints":[{"id":"jilin0uuiu","targetType":"entity_id","targetValue":"input_boolean.training_mode","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"yzffzvpp6q","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1920,"wires":[["fb31239a.dc5a"],[]]},{"id":"8b55150c.e6f538","type":"trigger-state","z":"433e5229.16b5fc","name":"Cat detected?","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_cat_dafang","debugenabled":false,"constraints":[{"id":"i5kfsy24l9n","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":2960,"wires":[["52ff8b02.32ae94"],[]]},{"id":"b1b10f87.8daf8","type":"api-call-service","z":"433e5229.16b5fc","name":"Set cat location","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.cat\",\"option\":\"Closet\"}","mergecontext":"","x":530,"y":3000,"wires":[[]]},{"id":"6d3196ea.159b68","type":"trigger-state","z":"433e5229.16b5fc","name":"Cat detected kitchen","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_cat_xiaofang1","debugenabled":false,"constraints":[{"id":"i5kfsy24l9n","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":140,"y":3120,"wires":[["c3cdb237.7647"],[]]},{"id":"866e05ca.7372c8","type":"trigger-state","z":"433e5229.16b5fc","name":"Cat detected xiaofang2","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_cat_xiaofang2","debugenabled":false,"constraints":[{"id":"i5kfsy24l9n","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":150,"y":3260,"wires":[["52ff8b02.32ae94"],[]]},{"id":"c3cdb237.7647","type":"api-call-service","z":"433e5229.16b5fc","name":"Set cat location","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.cat\",\"option\":\"Kitchen\"}","mergecontext":"","x":520,"y":3120,"wires":[[]]},{"id":"52ff8b02.32ae94","type":"api-call-service","z":"433e5229.16b5fc","name":"Set cat location","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.cat\",\"option\":\"Living Room\"}","mergecontext":"","x":520,"y":3220,"wires":[[]]},{"id":"4bfdbc88.ca23bc","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":340,"y":2500,"wires":[["3d4bdbc4.23a444"]]},{"id":"eadca88.ccb4658","type":"api-call-service","z":"49017fb.081c18","name":"Turn off circadian lighting","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\" switch.circadian_lighting_circadian_lighting\"}","mergecontext":"","x":1030,"y":240,"wires":[[]]},{"id":"b8199be.618b668","type":"api-call-service","z":"49017fb.081c18","name":"Turn on circadian lighting","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_on","data":"{\"entity_id\":\" switch.circadian_lighting_circadian_lighting\"}","mergecontext":"","x":1030,"y":200,"wires":[[]]},{"id":"48c3fe9c.969a6","type":"delay","z":"49017fb.081c18","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":780,"y":280,"wires":[["32b33dd1.64f6b2"]]},{"id":"94846ba2.547888","type":"alexa-home","z":"9114d340.f3aed","conf":"cb07a23c.1bf87","device":"45018","acknoledge":true,"name":"Playstation","topic":"","x":80,"y":1460,"wires":[["5f222658.a008c8"]]},{"id":"71491ba4.1d1f84","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1120,"y":1260,"wires":[["f0b7a6b7.eb2358"]]},{"id":"f0b7a6b7.eb2358","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_bedroom","outputs":1,"x":1250,"y":1260,"wires":[["ba9a515.a307db"]]},{"id":"ba9a515.a307db","type":"api-call-service","z":"9114d340.f3aed","name":"Outside Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.sonas_hot_chromecast\",\"media_content_id\":\"http://192.168.92.101:8081\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":1400,"y":1260,"wires":[[]]},{"id":"9140ef46.a77ff","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1080,"y":1420,"wires":[["a396d5e7.8e6838"]]},{"id":"c14eed18.5de11","type":"api-call-service","z":"9114d340.f3aed","name":"Outside Camera","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"play_media","data":"{\"entity_id\":\"media_player.sonas_hot_chromecast\",\"media_content_id\":\"http://192.168.92.101:8081\",\"media_content_type\":\"image/jpeg\"}","mergecontext":"","x":1360,"y":1420,"wires":[[]]},{"id":"a396d5e7.8e6838","type":"api-current-state","z":"9114d340.f3aed","name":"on?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.camera_cycling_bedroom","outputs":1,"x":1210,"y":1420,"wires":[["c14eed18.5de11"]]},{"id":"5f222658.a008c8","type":"api-call-service","z":"9114d340.f3aed","name":"Turn on PS4","server":"90ba4a50.2b5e48","service_domain":"script","service":"turn_on_ps4","data":"","mergecontext":"","x":290,"y":1460,"wires":[[]]},{"id":"7559992f.bc5578","type":"api-current-state","z":"49017fb.081c18","name":"Brightness","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.target_brightness","outputs":1,"x":2550,"y":540,"wires":[["5474d72c.a15a88"]]},{"id":"89c5f246.2d8cf","type":"inject","z":"69646b1e.2e5084","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1760,"y":640,"wires":[["a7d99878.acd578"]]},{"id":"4e78ab24.c5329c","type":"debug","z":"69646b1e.2e5084","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2290,"y":660,"wires":[]},{"id":"76828edc.83e8a","type":"trigger-state","z":"407269cb.c12fd8","name":"Multiple people detected","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_person_xiaofang2","debugenabled":false,"constraints":[{"id":"9qb4d4nhyat","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"4"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1180,"wires":[["feb9c4ce.d15cd"],[]]},{"id":"1d921d39.a1b5db","type":"trigger-state","z":"407269cb.c12fd8","name":"Multiple people detected","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_person_logi","debugenabled":false,"constraints":[{"id":"9qb4d4nhyat","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"4"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":1260,"wires":[["feb9c4ce.d15cd"],[]]},{"id":"feb9c4ce.d15cd","type":"api-call-service","z":"407269cb.c12fd8","name":"","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_on","data":"{\"entity_id\":\"input_boolean.guest_mode\"}","mergecontext":"","x":440,"y":1220,"wires":[[]]},{"id":"452e23d0.4d12ac","type":"api-call-service","z":"a1f7f54.5d30108","name":"Camera snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.vacuum_map\", \"filename\": \"/config/www/navmap.jpg\" }","mergecontext":"","x":550,"y":960,"wires":[[]]},{"id":"4e039bd.fd90064","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":520,"y":1000,"wires":[["993f2ac8.54fe28"]]},{"id":"43d8201b.fb3cc","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Send notification","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"","mergecontext":"","x":1070,"y":1480,"wires":[[]]},{"id":"993f2ac8.54fe28","type":"api-call-service","z":"a1f7f54.5d30108","name":"Send notification","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"{\"title\":\"Vacuum\", \"message\":\"Vacuum done cleaning\", \"data\":{\"push\":{\"category\":\"camera\"}, \"entity_id\":\"camera.vacuum_map\"}}","mergecontext":"","x":790,"y":1000,"wires":[[]]},{"id":"67d1597b.85ec38","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.tensorflow_raspberry\"}","mergecontext":"","x":960,"y":2480,"wires":[[]]},{"id":"cfeac666.d26dd8","type":"delay","z":"433e5229.16b5fc","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":2480,"wires":[["67d1597b.85ec38"]]},{"id":"f73f30bb.9a42","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":2460,"wires":[["6f58c048.1ab69"]]},{"id":"f23da592.8470d8","type":"api-render-template","z":"c84fe94a.0c50b8","name":"Tensorflow template","server":"90ba4a50.2b5e48","template":"{% set summary = states.image_processing.tensorflow_raspberry.attributes.summary %}\nDetected: {% for object in summary %}{{object}} | {% endfor %}","x":680,"y":1480,"wires":[["d8208a5f.dcadb8"]]},{"id":"d8208a5f.dcadb8","type":"template","z":"c84fe94a.0c50b8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":\n{\n    \"title\": \"Motion outside\",\n    \"message\": \"{{payload}}\",\n    \"data\": {\n        \"push\": {\n            \"category\": \"camera\"\n        },\n        \"entity_id\": \"camera.tensorflow_raspberry\"\n    }\n}\n}","output":"str","x":880,"y":1480,"wires":[["43d8201b.fb3cc"]]},{"id":"803b8364.9226d","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"","mergecontext":"","x":500,"y":1120,"wires":[[]]},{"id":"8a105e48.74192","type":"delay","z":"433e5229.16b5fc","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1240,"y":2400,"wires":[[]]},{"id":"61a4db70.0b68f4","type":"inject","z":"407269cb.c12fd8","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":1580,"wires":[["80d26bb.4df6e98"]]},{"id":"b3c34c63.6c5cf","type":"debug","z":"407269cb.c12fd8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":1680,"wires":[]},{"id":"80d26bb.4df6e98","type":"smooth","z":"407269cb.c12fd8","name":"","property":"payload","action":"mean","count":"3","round":"0","mult":"single","x":260,"y":1680,"wires":[["b3c34c63.6c5cf"]]},{"id":"1b96bc24.1dbbd4","type":"inject","z":"407269cb.c12fd8","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":1720,"wires":[["80d26bb.4df6e98"]]},{"id":"58fcc82f.5722b","type":"trigger-state","z":"407269cb.c12fd8","name":"Someone downstairs","server":"90ba4a50.2b5e48","entityid":"group.anyone_downstairs","debugenabled":false,"constraints":[{"id":"ce5bp4lpwsj","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"cw94bq20lt","targetType":"entity_id","targetValue":"input_boolean.anyone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":140,"y":20,"wires":[["e07b12e4.687aa"],[]]},{"id":"7e244daf.06685c","type":"inject","z":"c84fe94a.0c50b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1140,"wires":[["c12d3dce.06436"]]},{"id":"37a839ca.61a3a6","type":"debug","z":"c84fe94a.0c50b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1920,"y":940,"wires":[]},{"id":"a5bfad18.6024a","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Guest mode?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.guest_mode","outputs":1,"x":560,"y":1040,"wires":[["9964a8a3.8f98b8"]]},{"id":"9964a8a3.8f98b8","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Sleeping?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.sleeping","outputs":1,"x":740,"y":1040,"wires":[["a0a2abe7.39cf98"]]},{"id":"a0a2abe7.39cf98","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Luca home?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.luca_home","outputs":1,"x":910,"y":1040,"wires":[["84b46ca2.c2d3b"]]},{"id":"f08db9cf.30cc48","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tensorflow outside changed","server":"90ba4a50.2b5e48","entityid":"image_processing.tensorflow_raspberry","debugenabled":false,"constraints":[{"id":"c8nbtc8opl","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":160,"y":1520,"wires":[["7d806865.4e91d8"],[]]},{"id":"433ff108.47f73","type":"inject","z":"c84fe94a.0c50b8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1200,"y":1180,"wires":[["6155ed21.678fd4"]]},{"id":"7b1fec9d.04d2fc","type":"api-current-state","z":"433e5229.16b5fc","name":"Privacy?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.privacy_mode","outputs":1,"x":320,"y":460,"wires":[["ba85021a.3adc4"]]},{"id":"60ee915.191037","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Guest mode?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.guest_mode","outputs":1,"x":320,"y":640,"wires":[["a4da9345.cecdc"]]},{"id":"80b77b41.686648","type":"change","z":"27644a2a.ce6276","name":"Set msg.message","rules":[{"t":"set","p":"message","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":210,"y":180,"wires":[["bccec819.854288"]]},{"id":"dafee805.5fe0b8","type":"api-current-state","z":"27644a2a.ce6276","name":"Anyone downstairs","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_downstairs","outputs":1,"x":1050,"y":120,"wires":[["a07ee043.b6155","6d2b1321.7f3edc"]]},{"id":"f88fd19e.33666","type":"api-call-service","z":"27644a2a.ce6276","name":"Trigger TTS","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"alexa_tts","data":"","mergecontext":"","x":1930,"y":200,"wires":[[]]},{"id":"cf191980.e51918","type":"template","z":"27644a2a.ce6276","name":"White sonos","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.white_sonos_one\", \"message\":\"{{payload}}\"}}","output":"str","x":1570,"y":280,"wires":[["f88fd19e.33666"]]},{"id":"fdc6f4a5.b24228","type":"change","z":"27644a2a.ce6276","name":"Set msg.payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1350,"y":240,"wires":[["cf191980.e51918","d8e0e2f2.92826"]]},{"id":"783e5a17.1458a4","type":"subflow:27644a2a.ce6276","z":"c84fe94a.0c50b8","name":"","x":500,"y":1200,"wires":[]},{"id":"fdb58cf8.cb458","type":"api-current-state","z":"27644a2a.ce6276","name":"Guest mode?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.guest_mode","outputs":1,"x":620,"y":180,"wires":[["4fe12206.2e364c"]]},{"id":"4fe12206.2e364c","type":"time-range-switch","z":"27644a2a.ce6276","name":"","lat":"","lon":"","startTime":"09:00","endTime":"22:30","startOffset":0,"endOffset":0,"x":790,"y":180,"wires":[["dafee805.5fe0b8","ff03dde7.5b076"],[]]},{"id":"bccec819.854288","type":"api-current-state","z":"27644a2a.ce6276","name":"Anyone home?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_home","outputs":1,"x":420,"y":180,"wires":[["fdb58cf8.cb458"]]},{"id":"d8e0e2f2.92826","type":"template","z":"27644a2a.ce6276","name":"Echo","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.echo\", \"message\":\"{{payload}}\"}}","output":"str","x":1550,"y":240,"wires":[["f88fd19e.33666"]]},{"id":"ce16f00d.06d72","type":"change","z":"27644a2a.ce6276","name":"Set msg.payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":120,"wires":[["6bc68720.9902c8"]]},{"id":"35d26e69.2ba692","type":"template","z":"27644a2a.ce6276","name":"Black sonos","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.black_sonos_one\", \"message\":\"{{payload}}\"}}","output":"str","x":1730,"y":60,"wires":[["f88fd19e.33666"]]},{"id":"6bc68720.9902c8","type":"template","z":"27644a2a.ce6276","name":"Beam","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.beam\", \"message\":\"{{payload}}\"}}","output":"str","x":1710,"y":120,"wires":[["f88fd19e.33666"]]},{"id":"18c95e66.a92b82","type":"trigger","z":"c84fe94a.0c50b8","op1":"Remember to take your medicine","op2":"","op1type":"str","op2type":"nul","duration":"250","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":260,"y":1200,"wires":[["783e5a17.1458a4"]]},{"id":"2b76d3c3.f9d57c","type":"subflow:27644a2a.ce6276","z":"c84fe94a.0c50b8","name":"","x":1060,"y":1560,"wires":[]},{"id":"830be46a.75beb8","type":"api-render-template","z":"c84fe94a.0c50b8","name":"GDQ template","server":"90ba4a50.2b5e48","template":"{{ states.calendar.gdq.attributes.message }} is starting soon","x":580,"y":980,"wires":[["b709f5b4.a58b08"]]},{"id":"b709f5b4.a58b08","type":"subflow:27644a2a.ce6276","z":"c84fe94a.0c50b8","name":"","x":780,"y":980,"wires":[]},{"id":"c12d3dce.06436","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Luca home?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.luca_home","outputs":1,"x":370,"y":980,"wires":[["830be46a.75beb8"]]},{"id":"1c16c3c4.8fd74c","type":"api-render-template","z":"c84fe94a.0c50b8","name":"Tensorflow template","server":"90ba4a50.2b5e48","template":"{% set summary = states.image_processing.tensorflow_raspberry.attributes.summary %}\nThere is a {% for object in summary %}{{object}} {{ \",\" if not loop.last }} {% endfor %} outside","x":820,"y":1560,"wires":[["2b76d3c3.f9d57c"]]},{"id":"5eb2161a.8e40a8","type":"api-current-state","z":"c84fe94a.0c50b8","name":"Tiia home","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"binary_sensor.tiia_home","outputs":1,"x":640,"y":1560,"wires":[["1c16c3c4.8fd74c"]]},{"id":"76352054.4f67a","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":2900,"wires":[["f572a666.efe588"]]},{"id":"826ccfdd.9317a","type":"api-render-template","z":"49017fb.081c18","name":"Template","server":"90ba4a50.2b5e48","template":"[{{ (range(0, 255)|random) }}, {{ (range(0, 255)|random) }},{{ (range(0, 255)|random) }}]","x":860,"y":1620,"wires":[["4f858c2f.856e14"]]},{"id":"4f858c2f.856e14","type":"function","z":"49017fb.081c18","name":"Return template","func":"msg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.yellow_light\\\",\\\"brightness_pct\\\": 100, \\\"rgb_color\\\": [\"+msg.payload+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1040,"y":1620,"wires":[["c21b6b34.b05d48","1ee06500.ea772b"]]},{"id":"279ed8f8.7d2ae","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":320,"wires":[["f62bd42c.e9b738"]]},{"id":"e2182d79.a40e3","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Luca home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.luca_home","debugenabled":false,"constraints":[{"id":"nchzb3nrv8r","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"7587t7juch","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":1660,"wires":[["83cb075b.aeb9c8"],[]]},{"id":"83cb075b.aeb9c8","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Luca arrived at home\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":1660,"wires":[[]]},{"id":"668d4c21.1a18e4","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Luca left home\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":1720,"wires":[[]]},{"id":"dbd2ba9e.3866e8","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Tiia arrived at home\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":1780,"wires":[[]]},{"id":"44b6e89a.51b8c8","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Tiia left home\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":1840,"wires":[[]]},{"id":"440ad76c.11b778","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Jere arrived at home\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":1900,"wires":[[]]},{"id":"a5d48bc3.f39b38","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Jere left home\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":1960,"wires":[[]]},{"id":"14f5486.06994b8","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Door opened","server":"90ba4a50.2b5e48","entityid":"binary_sensor.main_door","debugenabled":false,"constraints":[{"id":"3pnl77o3pxu","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":2020,"wires":[["fdd17c44.f311c"],[]]},{"id":"fdd17c44.f311c","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Door opened\",\"target\":\"BROADCAST\"}","mergecontext":"","x":480,"y":2020,"wires":[[]]},{"id":"f489c00a.b6d43","type":"subflow:27644a2a.ce6276","z":"c84fe94a.0c50b8","name":"","x":940,"y":500,"wires":[]},{"id":"2b0582c3.58e00e","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Luca not home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.luca_home","debugenabled":false,"constraints":[{"id":"x7t9qibbsen","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"veq1pmxv1qd","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":1720,"wires":[["668d4c21.1a18e4"],[]]},{"id":"fe3014c9.46b7d8","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tiia home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.tiia_home","debugenabled":false,"constraints":[{"id":"nchzb3nrv8r","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"7587t7juch","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":100,"y":1780,"wires":[["dbd2ba9e.3866e8"],[]]},{"id":"5351b9d1.ffc5a8","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tiia not home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.tiia_home","debugenabled":false,"constraints":[{"id":"x7t9qibbsen","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"veq1pmxv1qd","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":1840,"wires":[["44b6e89a.51b8c8"],[]]},{"id":"f7f701d3.29e2c","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Jere home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.jere_home","debugenabled":false,"constraints":[{"id":"nchzb3nrv8r","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"7587t7juch","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":110,"y":1900,"wires":[["440ad76c.11b778"],[]]},{"id":"91ef7856.cb0eb8","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Jere not home","server":"90ba4a50.2b5e48","entityid":"binary_sensor.jere_home","debugenabled":false,"constraints":[{"id":"x7t9qibbsen","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"veq1pmxv1qd","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":1960,"wires":[["a5d48bc3.f39b38"],[]]},{"id":"ff03dde7.5b076","type":"api-current-state","z":"27644a2a.ce6276","name":"Anyone upstairs","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_upstairs","outputs":1,"x":1040,"y":240,"wires":[["fdc6f4a5.b24228"]]},{"id":"ab379b4d.2438a8","type":"trigger","z":"c84fe94a.0c50b8","op1":"The laundry is done!","op2":"","op1type":"str","op2type":"nul","duration":"250","extend":false,"units":"ms","reset":"","bytopic":"all","name":"","x":540,"y":780,"wires":[["727d1096.522f3"]]},{"id":"727d1096.522f3","type":"subflow:27644a2a.ce6276","z":"c84fe94a.0c50b8","name":"","x":800,"y":780,"wires":[]},{"id":"6bcde850.4f8318","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":580,"y":1680,"wires":[["826ccfdd.9317a"]]},{"id":"1ee06500.ea772b","type":"debug","z":"49017fb.081c18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1220,"y":1720,"wires":[]},{"id":"2b9c4999.325c16","type":"api-call-service","z":"69646b1e.2e5084","name":"Turn off circadian lighting","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.circadian_lighting_circadian_lighting\"}","mergecontext":"","x":630,"y":480,"wires":[[]]},{"id":"295e37f1.e7bbe","type":"inject","z":"9114d340.f3aed","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 21 * * 3,5,6,0","once":false,"onceDelay":0.1,"x":130,"y":1060,"wires":[["c379bba4.e70af8","9256fec4.ce66d"]]},{"id":"7d806865.4e91d8","type":"delay","z":"c84fe94a.0c50b8","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":400,"y":1520,"wires":[["f23da592.8470d8"]]},{"id":"a61a9c9c.c94e2","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people Rekognition","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.rekognition_person_living_room\"}","mergecontext":"","x":1960,"y":1400,"wires":[[]]},{"id":"56bd3066.4cb72","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people Rekognition","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.rekognition_person_xiaofang2\"}","mergecontext":"","x":2300,"y":1100,"wires":[[]]},{"id":"2d101118.fe636e","type":"api-call-service","z":"433e5229.16b5fc","name":"Record video","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"record_clip","data":"","mergecontext":"","x":510,"y":2160,"wires":[[]]},{"id":"a9089db9.9c468","type":"api-call-service","z":"433e5229.16b5fc","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Motion in the backyard\",\"target\":\"BROADCAST\"}","mergecontext":"","x":520,"y":1220,"wires":[[]]},{"id":"f05e8e73.a2f0d8","type":"trigger-state","z":"13b34343.676d45","name":"Someone downstairs","server":"90ba4a50.2b5e48","entityid":"input_boolean.someone_downstairs","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":160,"wires":[["9c44d415.bd4a38"],[]]},{"id":"9873e291.bd7098","type":"delay","z":"13b34343.676d45","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":100,"wires":[["851ff4b3.b08c8"]]},{"id":"9c44d415.bd4a38","type":"switch","z":"13b34343.676d45","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":310,"y":160,"wires":[["9873e291.bd7098"],["9d41a30f.eaa3a"]]},{"id":"9d41a30f.eaa3a","type":"delay","z":"13b34343.676d45","name":"","pauseType":"delay","timeout":"6","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":460,"y":200,"wires":[["13eaf4d3.d5c073"]]},{"id":"5b7a9438.1a3bec","type":"mqtt out","z":"13b34343.676d45","name":"","topic":"dashboard/rpi1/start","qos":"","retain":"","broker":"e9e87280.3fdb9","x":820,"y":100,"wires":[]},{"id":"46944ecb.868fe8","type":"mqtt out","z":"13b34343.676d45","name":"","topic":"dashboard/rpi1/kill","qos":"","retain":"","broker":"e9e87280.3fdb9","x":810,"y":200,"wires":[]},{"id":"74e39ad0.f133c4","type":"trigger-state","z":"407269cb.c12fd8","name":"Auto lights on","server":"90ba4a50.2b5e48","entityid":"sensor.livingroom_light_level","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":1340,"wires":[["245c608c.bd9aa"],[]]},{"id":"245c608c.bd9aa","type":"smooth","z":"407269cb.c12fd8","name":"","property":"payload","action":"mean","count":"3","round":"0","mult":"single","x":351.11109924316406,"y":1306.6666164398193,"wires":[["e8b12d70.354dc"]]},{"id":"e8b12d70.354dc","type":"function","z":"407269cb.c12fd8","name":"Set light level","func":"flow.set('light',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":561.6667175292969,"y":1305.5555877685547,"wires":[["5580a733.859858"]]},{"id":"5580a733.859858","type":"template","z":"407269cb.c12fd8","name":"mqtt template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"level\": {{payload}}}\n","output":"str","x":795.0000305175781,"y":1306.6665859222412,"wires":[["bc524003.0ad75"]]},{"id":"bc524003.0ad75","type":"mqtt out","z":"407269cb.c12fd8","name":"","topic":"light/livingroom","qos":"","retain":"true","broker":"e9e87280.3fdb9","x":1018,"y":1306,"wires":[]},{"id":"48bad1d5.46aaf","type":"inject","z":"407269cb.c12fd8","name":"Check light level","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1440,"wires":[["c9be618a.5a99a"]]},{"id":"c9be618a.5a99a","type":"api-current-state","z":"407269cb.c12fd8","name":"Kitchen light on","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"light.kitchen","outputs":1,"x":340,"y":1440,"wires":[["4a26d996.fa2c18"]]},{"id":"4a26d996.fa2c18","type":"api-render-template","z":"407269cb.c12fd8","name":"should update?","server":"90ba4a50.2b5e48","template":"{% set current = states.sensor.kitchen_light_level|int %}\n{% set average = states.sensor.kitchen_light_level_avg|int %}\n{% if is_state('sun.sun', 'below_horizon') %}\n{% if current <= 6000 %}\n1\n{% else %}\n0\n{% endif %}\n{% else %}\n{% if current - average <= 7500 %} \n1\n{% else %}\n0\n{% endif %}\n{% endif %}","x":560,"y":1440,"wires":[["5cf6f801.f6ba28"]]},{"id":"1679d72c.abe3f9","type":"cron","z":"407269cb.c12fd8","name":"","crontab":"*/5 * * * *","x":90,"y":1500,"wires":[["c9be618a.5a99a"]]},{"id":"5cf6f801.f6ba28","type":"switch","z":"407269cb.c12fd8","name":"switch motion","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":780,"y":1440,"wires":[["8d653d90.470aa"],[]]},{"id":"8d653d90.470aa","type":"api-current-state","z":"407269cb.c12fd8","name":"Kitchen light level","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.kitchen_true_light_level","outputs":1,"x":970,"y":1440,"wires":[["8bfdfcb5.50a5a"]]},{"id":"8bfdfcb5.50a5a","type":"switch","z":"407269cb.c12fd8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"gt","v":"0","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":1130,"y":1440,"wires":[["47598e84.3b401"],["df12583.9c72ba8"]]},{"id":"47598e84.3b401","type":"smooth","z":"407269cb.c12fd8","name":"","property":"payload","action":"mean","count":"3","round":"0","mult":"single","x":1420,"y":1460,"wires":[["6be6c243.30b15c"]]},{"id":"df12583.9c72ba8","type":"api-current-state","z":"407269cb.c12fd8","name":"Kitchen true light level","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.kitchen_true_light_level","outputs":1,"x":1220,"y":1520,"wires":[["47598e84.3b401"]]},{"id":"6be6c243.30b15c","type":"function","z":"407269cb.c12fd8","name":"Set light level","func":"flow.set('kitchen_light_level',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":1590,"y":1460,"wires":[["ff5b4532.99c878"]]},{"id":"ff5b4532.99c878","type":"template","z":"407269cb.c12fd8","name":"mqtt template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"level\": {{payload}}}\n","output":"str","x":1774,"y":1464,"wires":[["922b7c0d.9b36b"]]},{"id":"922b7c0d.9b36b","type":"mqtt out","z":"407269cb.c12fd8","name":"","topic":"light/kitchen","qos":"","retain":"true","broker":"e9e87280.3fdb9","x":1979.5,"y":1459.9999809265137,"wires":[]},{"id":"8a2bf240.b3b77","type":"api-call-service","z":"433e5229.16b5fc","name":"Set camera position","server":"90ba4a50.2b5e48","service_domain":"cover","service":"set_cover_position","data":"{\"entity_id\":\"cover.dafang_move_leftright\",\"position\":75}","mergecontext":"","x":862.5,"y":123,"wires":[[]]},{"id":"6b74d857.60a0c8","type":"api-call-service","z":"433e5229.16b5fc","name":"Set camera position","server":"90ba4a50.2b5e48","service_domain":"cover","service":"set_cover_position","data":"{\"entity_id\":\"cover.dafang_move_leftright\",\"position\":50}","mergecontext":"","x":862.5,"y":303,"wires":[[]]},{"id":"894f87b2.739fa8","type":"api-call-service","z":"433e5229.16b5fc","name":"Set camera position up down","server":"90ba4a50.2b5e48","service_domain":"cover","service":"set_cover_position","data":"{\"entity_id\":\"cover.dafang_move_updown\",\"position\":35}","mergecontext":"","x":890,"y":40,"wires":[[]]},{"id":"a3720dd9.ceab","type":"api-call-service","z":"433e5229.16b5fc","name":"Set camera position up down","server":"90ba4a50.2b5e48","service_domain":"cover","service":"set_cover_position","data":"{\"entity_id\":\"cover.dafang_move_updown\",\"position\":55}","mergecontext":"","x":830,"y":380,"wires":[[]]},{"id":"78ced84a.81fe58","type":"mqtt in","z":"9114d340.f3aed","name":"Jukebox play","topic":"jukebox/play","qos":"2","broker":"e9e87280.3fdb9","x":90,"y":1560,"wires":[["77ef3b97.496ed4","b7bc25fd.2e1c58"]]},{"id":"77ef3b97.496ed4","type":"switch","z":"9114d340.f3aed","name":"1/2/3/4/5/6","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"#1","vt":"str"},{"t":"cont","v":"#2","vt":"str"},{"t":"cont","v":"#3","vt":"str"},{"t":"cont","v":"#4","vt":"str"},{"t":"cont","v":"#5","vt":"str"},{"t":"cont","v":"#6","vt":"str"}],"checkall":"false","repair":false,"outputs":6,"x":320,"y":1560,"wires":[["e55b3f94.9b55f"],["e720a370.6bfe2"],["6195c26f.86fc6c"],["74404384.c2e24c"],["7b4ccd00.fa1504"],["11bb7fde.2a0e4"]]},{"id":"90623b89.c2e9b8","type":"api-call-service","z":"9114d340.f3aed","name":"Play Sonos","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"select_source","data":"","mergecontext":"","x":1690,"y":1780,"wires":[[]]},{"id":"cff3d896.f50a28","type":"change","z":"9114d340.f3aed","name":"Casual 🎼🙋‍♀️🙋‍♂️","rules":[{"t":"set","p":"payload","pt":"msg","to":"Casual 🎼🙋‍♀️🙋‍♂️","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":1720,"wires":[["eb5dd141.b8766"]]},{"id":"c3407b9f.26fc38","type":"template","z":"9114d340.f3aed","name":"Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.living_room\", \"source\": \"{{payload}}\"}}","output":"str","x":1460,"y":1700,"wires":[["90623b89.c2e9b8"]]},{"id":"87d75e0b.f83b4","type":"debug","z":"9114d340.f3aed","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":980,"y":1660,"wires":[]},{"id":"33fc8855.a3d828","type":"template","z":"9114d340.f3aed","name":"Template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":{\"entity_id\":\"media_player.living_room\", \"match\":\"{{payload}}\"}}","output":"str","x":1460,"y":1840,"wires":[[]]},{"id":"e55b3f94.9b55f","type":"change","z":"9114d340.f3aed","name":"Casual 🎼","rules":[{"t":"set","p":"payload","pt":"msg","to":" 🎼","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":1480,"wires":[["364d63df.6d7b8c"]]},{"id":"11ee505e.dfdfe","type":"api-call-service","z":"9114d340.f3aed","name":"Play Sonos","server":"90ba4a50.2b5e48","service_domain":"script","service":"sonos_play_matching","data":"","mergecontext":"","x":970,"y":1580,"wires":[[]]},{"id":"364d63df.6d7b8c","type":"function","z":"9114d340.f3aed","name":"Template","func":"var match = msg.payload.trim()\n\nmsg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"media_player.living_room\\\",\\\"match\\\": \\\"\"+match+\"\\\"}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":1580,"wires":[["11ee505e.dfdfe","87d75e0b.f83b4"]]},{"id":"eb5dd141.b8766","type":"function","z":"9114d340.f3aed","name":"Template","func":"var source = msg.payload.trim()\n\nmsg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"media_player.living_room\\\",\\\"source\\\": \\\"\"+source+\"\\\"}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":1460,"y":1760,"wires":[["90623b89.c2e9b8"]]},{"id":"e720a370.6bfe2","type":"change","z":"9114d340.f3aed","name":"🧚‍♀️","rules":[{"t":"set","p":"payload","pt":"msg","to":"🧚‍♀️","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1520,"wires":[["364d63df.6d7b8c"]]},{"id":"6195c26f.86fc6c","type":"change","z":"9114d340.f3aed","name":"😎","rules":[{"t":"set","p":"payload","pt":"msg","to":"😎","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1560,"wires":[["364d63df.6d7b8c"]]},{"id":"7b4ccd00.fa1504","type":"change","z":"9114d340.f3aed","name":"🙋‍♂️","rules":[{"t":"set","p":"payload","pt":"msg","to":"🙋‍♂️","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1640,"wires":[["364d63df.6d7b8c"]]},{"id":"74404384.c2e24c","type":"change","z":"9114d340.f3aed","name":"🙋‍♀️","rules":[{"t":"set","p":"payload","pt":"msg","to":" 🙋‍♀️","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1600,"wires":[["364d63df.6d7b8c"]]},{"id":"11bb7fde.2a0e4","type":"change","z":"9114d340.f3aed","name":"👶","rules":[{"t":"set","p":"payload","pt":"msg","to":"👶","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":1680,"wires":[["364d63df.6d7b8c"]]},{"id":"b7bc25fd.2e1c58","type":"api-call-service","z":"9114d340.f3aed","name":"Set shuffle","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"shuffle_set","data":"{\"entity_id\":\"media_player.living_room\",\"shuffle\":\"true\"}","mergecontext":"","x":310,"y":1680,"wires":[[]]},{"id":"32bd3235.429f0e","type":"stoptimer","z":"17a3ce98.14e651","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":830,"y":40,"wires":[["9c5aab72.ec2ff8"],[]]},{"id":"9c5aab72.ec2ff8","type":"api-call-service","z":"17a3ce98.14e651","name":"Rename snapshots Dafang","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_dafang","data":"","mergecontext":"","x":1080,"y":40,"wires":[[]]},{"id":"eb87f48a.d4ed38","type":"api-call-service","z":"17a3ce98.14e651","name":"dafang snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.dafang\", \"filename\": \"/images/dafang/latest.jpg\" }","mergecontext":"","x":610,"y":40,"wires":[[]]},{"id":"330362b.aba2b9e","type":"switch","z":"17a3ce98.14e651","name":"Camera","property":"camera","propertyType":"msg","rules":[{"t":"eq","v":"dafang","vt":"str"},{"t":"eq","v":"xiaofang1","vt":"str"},{"t":"eq","v":"xiaofang2","vt":"str"},{"t":"eq","v":"logi","vt":"str"},{"t":"eq","v":"raspberry","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":310,"y":180,"wires":[["32bd3235.429f0e","eb87f48a.d4ed38"],["54cadfae.0eb5","ef07e70e.f1c1d8"],["d1a44d55.9f25","d2b3515d.a4d7b"],["43090691.18b498","8b37106e.b4893"],["f3180839.75ac08","6c08473f.e02f48"]]},{"id":"54cadfae.0eb5","type":"stoptimer","z":"17a3ce98.14e651","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":830,"y":100,"wires":[["7feb4ac4.4a9354","4ac4a52b.2d1c9c"],[]]},{"id":"4ac4a52b.2d1c9c","type":"stoptimer","z":"17a3ce98.14e651","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1330,"y":100,"wires":[["4c5d9dae.fb44f4"],[]]},{"id":"7feb4ac4.4a9354","type":"api-call-service","z":"17a3ce98.14e651","name":"Rename snapshots Xiaofang1","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_xiaofang1","data":"","mergecontext":"","x":1090,"y":100,"wires":[[]]},{"id":"4c5d9dae.fb44f4","type":"api-call-service","z":"17a3ce98.14e651","name":"Scan tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_xiaofang1\"}","mergecontext":"","x":1520,"y":100,"wires":[[]]},{"id":"ef07e70e.f1c1d8","type":"api-call-service","z":"17a3ce98.14e651","name":"xiaofang1 snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.xiaofang1\", \"filename\": \"/images/xiaofang1/latest.jpg\" }","mergecontext":"","x":610,"y":100,"wires":[[]]},{"id":"d1a44d55.9f25","type":"api-call-service","z":"17a3ce98.14e651","name":"xiaofang2 snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.xiaofang2\", \"filename\": \"/images/xiaofang2/latest.jpg\" }","mergecontext":"","x":610,"y":160,"wires":[[]]},{"id":"d2b3515d.a4d7b","type":"stoptimer","z":"17a3ce98.14e651","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":830,"y":160,"wires":[["bffebb7a.134ed8"],[]]},{"id":"bffebb7a.134ed8","type":"api-call-service","z":"17a3ce98.14e651","name":"Rename snapshots Xiaofang2","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_xiaofang2","data":"","mergecontext":"","x":1090,"y":160,"wires":[[]]},{"id":"8013cd9f.a5055","type":"api-call-service","z":"17a3ce98.14e651","name":"Scan for people tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_logi_latest\"}","mergecontext":"","x":1360,"y":220,"wires":[[]]},{"id":"8b37106e.b4893","type":"stoptimer","z":"17a3ce98.14e651","duration":"15","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":830,"y":220,"wires":[["8013cd9f.a5055","93dad0b8.3569b"],[]]},{"id":"43090691.18b498","type":"api-call-service","z":"17a3ce98.14e651","name":"logi snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"logi_circle_livestream_snapshot","data":"{   \"entity_id\": \"camera.living_room\", \"filename\": \"/images/logi/latest.jpg\" }","mergecontext":"","x":600,"y":220,"wires":[[]]},{"id":"93dad0b8.3569b","type":"api-call-service","z":"17a3ce98.14e651","name":"Rename snapshots Logi","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_living_room","data":"","mergecontext":"","x":1070,"y":220,"wires":[[]]},{"id":"f3180839.75ac08","type":"api-call-service","z":"17a3ce98.14e651","name":"raspberry snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.raspberry\", \"filename\": \"/images/raspberry/latest.jpg\" }","mergecontext":"","x":610,"y":280,"wires":[[]]},{"id":"6c08473f.e02f48","type":"stoptimer","z":"17a3ce98.14e651","duration":"10","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":830,"y":280,"wires":[["e31ad4f8.328df8"],[]]},{"id":"e31ad4f8.328df8","type":"api-call-service","z":"17a3ce98.14e651","name":"Rename snapshots raspberry","server":"90ba4a50.2b5e48","service_domain":"shell_command","service":"rename_snapshots_raspberry","data":"","mergecontext":"","x":1090,"y":280,"wires":[[]]},{"id":"858321ca.ed558","type":"change","z":"433e5229.16b5fc","name":"msg.camera raspberry","rules":[{"t":"set","p":"camera","pt":"msg","to":"raspberry","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":2360,"wires":[["10f3dd12.f17da3"]]},{"id":"10f3dd12.f17da3","type":"subflow:17a3ce98.14e651","z":"433e5229.16b5fc","name":"","x":860,"y":2360,"wires":[]},{"id":"9b2a6980.5271a8","type":"change","z":"433e5229.16b5fc","name":"msg.camera logi","rules":[{"t":"set","p":"camera","pt":"msg","to":"logi","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":1180,"wires":[["eca0e487.5ec3c8"]]},{"id":"eca0e487.5ec3c8","type":"subflow:17a3ce98.14e651","z":"433e5229.16b5fc","name":"","x":920,"y":1180,"wires":[]},{"id":"4d6871b8.ffb39","type":"change","z":"433e5229.16b5fc","name":"msg.camera xiaofang2","rules":[{"t":"set","p":"camera","pt":"msg","to":"xiaofang2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":960,"wires":[["edfeaf04.abd31","fddfc8c8.62ede8"]]},{"id":"edfeaf04.abd31","type":"subflow:17a3ce98.14e651","z":"433e5229.16b5fc","name":"","x":930,"y":960,"wires":[]},{"id":"bac121cb.cbf15","type":"change","z":"433e5229.16b5fc","name":"msg.camera xiaofang1","rules":[{"t":"set","p":"camera","pt":"msg","to":"xiaofang1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":760,"wires":[["476d735e.92108c","3eb43874.ef06d8"]]},{"id":"476d735e.92108c","type":"subflow:17a3ce98.14e651","z":"433e5229.16b5fc","name":"","x":980,"y":760,"wires":[]},{"id":"fcc3bee9.e8303","type":"change","z":"433e5229.16b5fc","name":"msg.camera dafang","rules":[{"t":"set","p":"camera","pt":"msg","to":"dafang","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":500,"wires":[["17c09a49.a7d9c6"]]},{"id":"17c09a49.a7d9c6","type":"subflow:17a3ce98.14e651","z":"433e5229.16b5fc","name":"","x":1060,"y":500,"wires":[]},{"id":"a78af678.d61e18","type":"inject","z":"433e5229.16b5fc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":380,"wires":[["fcc3bee9.e8303"]]},{"id":"a28943f8.b2736","type":"api-call-service","z":"433e5229.16b5fc","name":"logi snapshot","server":"90ba4a50.2b5e48","service_domain":"camera","service":"snapshot","data":"{   \"entity_id\": \"camera.living_room\", \"filename\": \"/videos/images/{{ now().strftime('%Y%m%d-%H%M%S') }}.jpg\" }","mergecontext":"","x":560,"y":1280,"wires":[[]]},{"id":"6fcd2acf.ae8f64","type":"trigger-state","z":"9114d340.f3aed","name":"Went upstairs","server":"90ba4a50.2b5e48","entityid":"group.anyone_downstairs","debugenabled":false,"constraints":[{"id":"85zk9xge8j5","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"kv69t6btozd","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":420,"wires":[["a70afbc4.b28618"],[]]},{"id":"f3e17cd1.fa789","type":"trigger-state","z":"9114d340.f3aed","name":"Went downstairs","server":"90ba4a50.2b5e48","entityid":"group.anyone_upstairs","debugenabled":false,"constraints":[{"id":"85zk9xge8j5","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"kv69t6btozd","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":500,"wires":[["d62e6aad.379028"],[]]},{"id":"d3d5479b.4e54a8","type":"api-call-service","z":"9114d340.f3aed","name":"Set living room as main player","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.music_controller\",\"option\":\"living_room\"}","mergecontext":"","x":710,"y":500,"wires":[[]]},{"id":"43c6088.979e5f8","type":"api-call-service","z":"9114d340.f3aed","name":"Set upstairs as main player","server":"90ba4a50.2b5e48","service_domain":"input_select","service":"select_option","data":"{\"entity_id\":\"input_select.music_controller\",\"option\":\"bedroom\"}","mergecontext":"","x":700,"y":420,"wires":[[]]},{"id":"a70afbc4.b28618","type":"api-current-state","z":"9114d340.f3aed","name":"Anyone upstairs?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_upstairs","outputs":1,"x":370,"y":420,"wires":[["43c6088.979e5f8"]]},{"id":"d62e6aad.379028","type":"api-current-state","z":"9114d340.f3aed","name":"Anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"group.anyone_downstairs","outputs":1,"x":380,"y":500,"wires":[["d3d5479b.4e54a8"]]},{"id":"a24a476e.0e42e8","type":"trigger-state","z":"9114d340.f3aed","name":"Office speaker on","server":"90ba4a50.2b5e48","entityid":"media_player.bedroom","debugenabled":false,"constraints":[{"id":"9xzn0xsggk9","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing"},{"id":"mjm39er1l4d","targetType":"entity_id","targetValue":"input_boolean.kid_sleeping","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"5c7gb32tuxy","targetType":"entity_id","targetValue":"input_boolean.follow_music","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":580,"wires":[["c500f311.78bec"],[]]},{"id":"c500f311.78bec","type":"api-call-service","z":"9114d340.f3aed","name":"Turn off","server":"90ba4a50.2b5e48","service_domain":"media_player","service":"turn_off","data":"{\"entity_id\":\"media_player.bedroom\"}","mergecontext":"","x":370,"y":580,"wires":[[]]},{"id":"128de8be.ef8867","type":"trigger-state","z":"407269cb.c12fd8","name":"Person detected","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_person_dafang","debugenabled":false,"constraints":[{"id":"bxzo5jyr8fm","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"e4o7vkrlua5","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"0"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":360,"y":20,"wires":[["f3de4435.7a8238"],[]]},{"id":"22f46f94.73e6f","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tensorflow dafang person","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_person_dafang","debugenabled":false,"constraints":[{"id":"c8nbtc8opl","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"},{"id":"aomzuhj1svc","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":150,"y":2120,"wires":[["6dbcc9b0.334358"],[]]},{"id":"6dbcc9b0.334358","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Dafang: Person detected\",\"target\":\"BROADCAST\"}","mergecontext":"","x":500,"y":2120,"wires":[[]]},{"id":"aa686e2.1deb19","type":"trigger-state","z":"c84fe94a.0c50b8","name":"Tensorflow xiaofang2 person","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_person_xiaofang2","debugenabled":false,"constraints":[{"id":"c8nbtc8opl","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"num","comparatorValue":"1"},{"id":"yqvb344srw","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":160,"y":2180,"wires":[["52ba179.fd69ce8"],[]]},{"id":"52ba179.fd69ce8","type":"api-call-service","z":"c84fe94a.0c50b8","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"{\"message\":\"Xiaofang2: Person detected\",\"target\":\"BROADCAST\"}","mergecontext":"","x":500,"y":2180,"wires":[[]]},{"id":"b20fe216.8e5a7","type":"api-current-state","z":"433e5229.16b5fc","name":"anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.someone_downstairs","outputs":1,"x":580,"y":600,"wires":[["cde11683.821678"]]},{"id":"cde11683.821678","type":"switch","z":"433e5229.16b5fc","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":770,"y":600,"wires":[["1cd7611b.98408f"],["abca1de3.2e128"]]},{"id":"1cd7611b.98408f","type":"delay","z":"433e5229.16b5fc","name":"limit 10 min","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":930,"y":560,"wires":[["38740bcc.f774f4"]]},{"id":"68c97ad1.c52504","type":"api-call-service","z":"433e5229.16b5fc","name":"Dining table cleaning","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.cb_xiaofang2_dining_table_cleaning\"}","mergecontext":"","x":1240,"y":860,"wires":[[]]},{"id":"dff0cf02.d364b","type":"api-call-service","z":"433e5229.16b5fc","name":"Vacuum model","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\":\"image_processing.cb_xiaofang2_vacuummodel\"}","mergecontext":"","x":1240,"y":900,"wires":[[]]},{"id":"abf1f439.e44288","type":"api-call-service","z":"433e5229.16b5fc","name":"Scan for people tensorflow","server":"90ba4a50.2b5e48","service_domain":"image_processing","service":"scan","data":"{\"entity_id\": \"image_processing.tensorflow_xiaofang2\"}","mergecontext":"","x":1780,"y":1160,"wires":[[]]},{"id":"abca1de3.2e128","type":"delay","z":"433e5229.16b5fc","name":"limit 5 s","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":940,"y":600,"wires":[["38740bcc.f774f4"]]},{"id":"8b621c01.131bb","type":"trigger-state","z":"407269cb.c12fd8","name":"Media players off","server":"90ba4a50.2b5e48","entityid":"sensor.downstairs_media_players","debugenabled":false,"constraints":[{"id":"cr35bk7njmp","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"7lq6lsbzruo","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":130,"y":680,"wires":[["e9aaa9c7.1c52b8"],[]]},{"id":"a4261d8d.1a0ae","type":"trigger-state","z":"407269cb.c12fd8","name":"Hallway light on","server":"90ba4a50.2b5e48","entityid":"light.hallway_downstairs","debugenabled":false,"constraints":[{"id":"o6ca02s4f3l","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":120,"y":240,"wires":[["e8c87a7b.05e5e8"],[]]},{"id":"8f24c08.025984","type":"trigger-state","z":"407269cb.c12fd8","name":"Person detected","server":"90ba4a50.2b5e48","entityid":"sensor.tensorflow_person_xiaofang2","debugenabled":false,"constraints":[{"id":"bxzo5jyr8fm","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"e4o7vkrlua5","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"0"},{"id":"52tmiztztb8","targetType":"entity_id","targetValue":"input_boolean.someone downstairs","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"x":660,"y":80,"wires":[["f3de4435.7a8238"],[]]},{"id":"741dae9c.f7d63","type":"api-call-service","z":"49017fb.081c18","name":"Paperlight on","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"{\"entity_id\":\"light.paperlight\", \"brightness_pct\": \"10\"}","mergecontext":"","x":1050,"y":1280,"wires":[[]]},{"id":"4f1ac77a.24ef88","type":"api-call-service","z":"49017fb.081c18","name":"Big light off","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_off","data":"{\"entity_id\":\"light.paperlight\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1390,"y":1360,"wires":[[]]},{"id":"13eaf4d3.d5c073","type":"api-current-state","z":"13b34343.676d45","name":"Downstairs?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.someone_downstairs","outputs":1,"x":610,"y":200,"wires":[["46944ecb.868fe8"]]},{"id":"851ff4b3.b08c8","type":"api-current-state","z":"13b34343.676d45","name":"Downstairs?","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"input_boolean.someone_downstairs","outputs":1,"x":610,"y":100,"wires":[["5b7a9438.1a3bec"]]},{"id":"300d6e35.d591f2","type":"api-current-state","z":"407269cb.c12fd8","name":"Sleeping?","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"input_boolean.sleeping","outputs":1,"x":1200,"y":780,"wires":[["62e2277e.0c4528"]]},{"id":"62e2277e.0c4528","type":"switch","z":"407269cb.c12fd8","name":"On/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1330,"y":780,"wires":[["f76e655.cefb398"],["fa1873f4.036c88"]]},{"id":"ab643a15.f7f098","type":"switch","z":"40088b6c.bf906c","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"12000","vt":"num"},{"t":"lt","v":"15000","vt":"str"},{"t":"gte","v":"15000","vt":"num"}],"checkall":"false","repair":false,"outputs":3,"x":220,"y":300,"wires":[["287c4562.66d2fa","33df9484.82bd9c"],["e6d8006c.a1c87"],[]]},{"id":"33df9484.82bd9c","type":"range","z":"40088b6c.bf906c","minin":"5000","maxin":"12000","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":810,"y":320,"wires":[["41984f0e.3e5cb"]]},{"id":"287c4562.66d2fa","type":"range","z":"40088b6c.bf906c","minin":"5000","maxin":"12000","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":810,"y":280,"wires":[["41984f0e.3e5cb"]]},{"id":"f57df3dd.c6e1d","type":"range","z":"40088b6c.bf906c","minin":"8000","maxin":"14000","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":890,"y":380,"wires":[["41984f0e.3e5cb"]]},{"id":"f163ee58.d308c","type":"range","z":"40088b6c.bf906c","minin":"8000","maxin":"14000","minout":"20","maxout":"0","action":"clamp","round":true,"property":"payload","name":"","x":890,"y":420,"wires":[["41984f0e.3e5cb"]]},{"id":"21ffd64c.a1941a","type":"api-current-state","z":"40088b6c.bf906c","name":"Livingroom light level","server":"90ba4a50.2b5e48","halt_if":"","override_topic":true,"override_payload":true,"entity_id":"sensor.livingroom_light_level_avg","outputs":1,"x":660,"y":380,"wires":[["f57df3dd.c6e1d","f163ee58.d308c"]]},{"id":"e6d8006c.a1c87","type":"api-current-state","z":"40088b6c.bf906c","name":"Big light on","server":"90ba4a50.2b5e48","halt_if":"off","override_topic":true,"override_payload":true,"entity_id":"light.big_light","outputs":1,"x":470,"y":380,"wires":[["21ffd64c.a1941a"]]},{"id":"41984f0e.3e5cb","type":"debug","z":"40088b6c.bf906c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1090,"y":240,"wires":[]},{"id":"c99799b1.1a93c8","type":"inject","z":"40088b6c.bf906c","name":"","topic":"","payload":"8724","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":220,"wires":[["af8a7cf.feb5c8"]]},{"id":"af8a7cf.feb5c8","type":"switch","z":"40088b6c.bf906c","name":"check light level","property":"payload","propertyType":"msg","rules":[{"t":"lte","v":"10000","vt":"num"},{"t":"gt","v":"10000","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":380,"y":160,"wires":[["89329e66.f2b84","b70ad269.ca493"],[]]},{"id":"89329e66.f2b84","type":"range","z":"40088b6c.bf906c","minin":"6500","maxin":"11000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":830,"y":140,"wires":[["41984f0e.3e5cb"]]},{"id":"b70ad269.ca493","type":"range","z":"40088b6c.bf906c","minin":"8000","maxin":"11000","minout":"20","maxout":"1","action":"clamp","round":true,"property":"payload","name":"","x":810,"y":200,"wires":[["41984f0e.3e5cb"]]},{"id":"41aa980b.3c32d8","type":"api-call-service","z":"49017fb.081c18","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":2780,"y":320,"wires":[[]]},{"id":"3f671223.f9b4fe","type":"time-range-switch","z":"49017fb.081c18","name":"","lat":"","lon":"","startTime":"12:00","endTime":"17:00","startOffset":0,"endOffset":0,"x":2390,"y":360,"wires":[["e0b3652a.9eb418"],["c9f5cebd.0fef3"]]},{"id":"aa0985b8.dd3b28","type":"change","z":"49017fb.081c18","name":"Set brightness","rules":[{"t":"set","p":"lightlevel","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1820,"y":420,"wires":[["26df1513.e59bea"]]},{"id":"e0b3652a.9eb418","type":"function","z":"49017fb.081c18","name":"Template","func":"msg.payload = \"{\\\"data\\\":{\\\"message\\\":\\\"Kitchen light level is at \"+msg.lightlevel+\" turning light to \"+msg.payload+\"\\\",\\\"target\\\":\\\"BROADCAST\\\"}}\"\nreturn msg;","outputs":1,"noerr":0,"x":2620,"y":320,"wires":[["41aa980b.3c32d8"]]},{"id":"bd268bd1.33de38","type":"change","z":"49017fb.081c18","name":"Set brightness","rules":[{"t":"set","p":"lightlevel","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1820,"y":520,"wires":[["12b4ecc2.4718a3"]]},{"id":"c9f5cebd.0fef3","type":"switch","z":"49017fb.081c18","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"100","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":380,"wires":[["e0b3652a.9eb418"]]},{"id":"4a79b88b.3eb588","type":"switch","z":"49017fb.081c18","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"100","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2610,"y":240,"wires":[["8b5cdfdf.9d28f"]]},{"id":"8b5cdfdf.9d28f","type":"function","z":"49017fb.081c18","name":"Template","func":"msg.payload = \"{\\\"data\\\":{\\\"message\\\":\\\"Living room light level is at \"+msg.lightlevel+\" turning light to \"+msg.payload+\". Light was off.\\\",\\\"target\\\":\\\"BROADCAST\\\"}}\"\nreturn msg;","outputs":1,"noerr":0,"x":2680,"y":180,"wires":[["d45fb02b.210fe"]]},{"id":"d45fb02b.210fe","type":"api-call-service","z":"49017fb.081c18","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":2840,"y":180,"wires":[[]]},{"id":"c124133c.8d82e","type":"time-range-switch","z":"49017fb.081c18","name":"","lat":"","lon":"","startTime":"12:00","endTime":"17:00","startOffset":0,"endOffset":0,"x":2470,"y":220,"wires":[["8b5cdfdf.9d28f"],["4a79b88b.3eb588"]]},{"id":"514d291f.802f28","type":"change","z":"49017fb.081c18","name":"Set brightness","rules":[{"t":"set","p":"lightlevel","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1680,"y":700,"wires":[["abb737b6.20bd88","577fdd0c.f46eb4"]]},{"id":"8b4fbfeb.a3a07","type":"time-range-switch","z":"49017fb.081c18","name":"","lat":"","lon":"","startTime":"12:00","endTime":"17:00","startOffset":0,"endOffset":0,"x":2510,"y":120,"wires":[["17116154.ab624f"],["35bfb815.3868c8"]]},{"id":"35bfb815.3868c8","type":"switch","z":"49017fb.081c18","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"100","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2650,"y":140,"wires":[["17116154.ab624f"]]},{"id":"17116154.ab624f","type":"function","z":"49017fb.081c18","name":"Template","func":"msg.payload = \"{\\\"data\\\":{\\\"message\\\":\\\"Living room light level is at \"+msg.lightlevel+\" turning light to \"+msg.payload+\". Light was already on.\\\",\\\"target\\\":\\\"BROADCAST\\\"}}\"\nreturn msg;","outputs":1,"noerr":0,"x":2720,"y":80,"wires":[["5170cce8.6a9914"]]},{"id":"5170cce8.6a9914","type":"api-call-service","z":"49017fb.081c18","name":"Notify FB","server":"90ba4a50.2b5e48","service_domain":"notify","service":"facebook","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":2880,"y":80,"wires":[[]]},{"id":"49704e1e.da10c","type":"debug","z":"49017fb.081c18","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2870,"y":120,"wires":[]},{"id":"de0212ac.0abf8","type":"change","z":"49017fb.081c18","name":"Set brightness","rules":[{"t":"set","p":"lightlevel","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2100,"y":680,"wires":[["ac53aa6e.7ad808","86efff58.1424f"]]},{"id":"170b7afd.f132dd","type":"api-current-state","z":"49017fb.081c18","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.sleeping","outputs":1,"x":1632,"y":1686,"wires":[[]]},{"id":"655d575c.a11f7","type":"api-current-state","z":"49017fb.081c18","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"on","override_topic":true,"override_payload":true,"entity_id":"input_boolean.sleeping","outputs":1,"x":1632,"y":1686,"wires":[[]]},{"id":"c852f44c.8ecbe","type":"api-current-state","z":"49017fb.081c18","name":"sleeping?","server":"90ba4a50.2b5e48","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.sleeping","state_type":"str","outputs":2,"x":1580,"y":1320,"wires":[["cec7afb8.2ff29"],[]]},{"id":"ba09ceb5.cef478","type":"inject","z":"13b34343.676d45","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":460,"y":280,"wires":[["46944ecb.868fe8"]]},{"id":"3cdf360b.86c4fa","type":"inject","z":"13b34343.676d45","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":520,"y":40,"wires":[["5b7a9438.1a3bec"]]},{"id":"8205a2d.16c366","type":"switch","z":"49017fb.081c18","name":"on/off","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":4150,"y":400,"wires":[["e7ce545b.2d9ba8"],["67b9118d.8d7df"]]},{"id":"6bcc3f5c.c2fe1","type":"api-current-state","z":"49017fb.081c18","name":"Light on?","server":"90ba4a50.2b5e48","halt_if":"","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"light.paperlight","state_type":"str","outputs":1,"x":3980,"y":400,"wires":[["8205a2d.16c366"]]},{"id":"604fefe7.b23ed","type":"template","z":"49017fb.081c18","name":"paperlight light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.paperlight\",\n\"brightness_pct\": {{payload}}\n}}\n","output":"str","x":4650,"y":420,"wires":[["17df81c7.61098e"]]},{"id":"67b9118d.8d7df","type":"function","z":"49017fb.081c18","name":"Get light level","func":"msg.payload = flow.get('paperlight_brightness') || 0;\nreturn msg;","outputs":1,"noerr":0,"x":4360,"y":440,"wires":[["604fefe7.b23ed"]]},{"id":"61793feb.fee93","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":3260,"y":840,"wires":[["69b0e2d9.46444c"]]},{"id":"cec7afb8.2ff29","type":"api-render-template","z":"49017fb.081c18","name":"Template","server":"90ba4a50.2b5e48","template":"[{{ (range(0, 255)|random) }}, {{ (range(0, 255)|random) }},{{ (range(0, 255)|random) }}]","x":1800,"y":1340,"wires":[["79c024c6.0b507c"]]},{"id":"79c024c6.0b507c","type":"function","z":"49017fb.081c18","name":"Return template","func":"msg.payload = \"{ \\\"data\\\": {\\\"entity_id\\\": \\\"light.gateway\\\",\\\"brightness_pct\\\": 10, \\\"rgb_color\\\": [\"+msg.payload+\"], \\\"transition\\\": 120}}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2000,"y":1360,"wires":[["3a56022c.14ee4e"]]},{"id":"3a56022c.14ee4e","type":"api-call-service","z":"49017fb.081c18","name":"Nightlight on","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":2210,"y":1360,"wires":[[]]},{"id":"a07ee043.b6155","type":"api-current-state","z":"27644a2a.ce6276","name":"Downstairs media players","server":"90ba4a50.2b5e48","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"sensor.downstairs_media_players","state_type":"str","outputs":2,"x":1290,"y":120,"wires":[["ce16f00d.06d72"],[]]},{"id":"6d2b1321.7f3edc","type":"change","z":"27644a2a.ce6276","name":"Set msg.payload","rules":[{"t":"set","p":"payload","pt":"msg","to":"message","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":60,"wires":[["35d26e69.2ba692"]]},{"id":"cedb0d5b.b6d6a","type":"mqtt in","z":"9114d340.f3aed","name":"Jukebox play","topic":"flick/brightness","qos":"2","broker":"e9e87280.3fdb9","x":90,"y":1840,"wires":[["f845957f.fb8158","903d6e4e.e4248"]]},{"id":"786c58cd.462ee8","type":"template","z":"9114d340.f3aed","name":"livingroom light template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \"data\": {\n\"entity_id\": \"light.living_room\",\n\"brightness_pct\": {{payload}},\n\"transition\": 1\n}}\n","output":"str","x":550,"y":1840,"wires":[["a59dbf28.826e9"]]},{"id":"a59dbf28.826e9","type":"api-call-service","z":"9114d340.f3aed","name":"ON","server":"90ba4a50.2b5e48","service_domain":"homeassistant","service":"turn_on","data":"","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":730,"y":1840,"wires":[[]]},{"id":"609178f2.c60228","type":"delay","z":"9114d340.f3aed","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"4","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":310,"y":1780,"wires":[["786c58cd.462ee8"]]},{"id":"f845957f.fb8158","type":"debug","z":"9114d340.f3aed","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":310,"y":2020,"wires":[]},{"id":"32b33dd1.64f6b2","type":"api-current-state","z":"49017fb.081c18","name":"anyone downstairs?","server":"90ba4a50.2b5e48","halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.someone_downstairs","state_type":"str","outputs":2,"x":1000,"y":280,"wires":[["8c24e435.782c68"],[]]},{"id":"903d6e4e.e4248","type":"switch","z":"9114d340.f3aed","name":"","property":"payload","propertyType":"msg","rules":[{"t":"else"},{"t":"eq","v":"100","vt":"str"},{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":250,"y":1840,"wires":[["609178f2.c60228"],["786c58cd.462ee8"],["786c58cd.462ee8"]]},{"id":"89b536e.f2da7c8","type":"trigger-state","z":"49017fb.081c18","name":"Kitchen Motion","server":"90ba4a50.2b5e48","entityid":"binary_sensor.motion_kitchen_xiaomi","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"3n9b89el4go","targetType":"entity_id","targetValue":"input_boolean.auto_lights","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"50wy5tlbxyu","targetType":"entity_id","targetValue":"group.anyone_home","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":100,"y":900,"wires":[["912f0cf2.261cc"],[]]},{"id":"b08c947b.3a2c18","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2040,"y":460,"wires":[["61504f18.70e02","3193879a.e638d8"]]},{"id":"2eb67c41.ea768c","type":"delay","z":"a1f7f54.5d30108","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1520,"y":340,"wires":[["24a64e44.f23662"]]},{"id":"64a0d34e.4bf3fc","type":"trigger-state","z":"cb4bdc1b.594b6","name":"Printer done","server":"90ba4a50.2b5e48","entityid":"binary_sensor.octoprint_printing","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"moexuj9fp7r","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"llvczn36ut","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"id":"8bpbte5ml6o","targetType":"entity_id","targetValue":"input_boolean.printer_shutdown","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"id":"jew4pkfgnb9","targetType":"entity_id","targetValue":"sensor.octoprint_actual_tool0_temp","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"50"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":90,"y":100,"wires":[["f9c4bf6e.ae1fb","a776004b.678aa","5e4c81c0.647648"],[]]},{"id":"294c27be.92d1e8","type":"trigger-state","z":"cb4bdc1b.594b6","name":"Temperature dropped","server":"90ba4a50.2b5e48","entityid":"sensor.octoprint_actual_tool0_temp","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"b8p7xq2kqdu","targetType":"this_entity","targetValue":"","propertyType":"previous_state","propertyValue":"old_state.state","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"50"},{"id":"tld1tbpckaq","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"<=","comparatorValueDatatype":"num","comparatorValue":"50"},{"id":"1qtzt7lnhtv","targetType":"entity_id","targetValue":"input_boolean.printer_shutdown","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":120,"y":160,"wires":[["f9c4bf6e.ae1fb","a776004b.678aa","5e4c81c0.647648"],[]]},{"id":"f9c4bf6e.ae1fb","type":"api-call-service","z":"cb4bdc1b.594b6","name":"Turn off","server":"90ba4a50.2b5e48","service_domain":"switch","service":"turn_off","data":"{\"entity_id\":\"switch.printer\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":450,"y":140,"wires":[[]]},{"id":"a776004b.678aa","type":"api-call-service","z":"cb4bdc1b.594b6","name":"Turn off boolean","server":"90ba4a50.2b5e48","service_domain":"input_boolean","service":"turn_off","data":"{\"entity_id\":\"input_boolean.printer_shutdown\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":480,"y":200,"wires":[[]]},{"id":"733b836c.e4956c","type":"inject","z":"cb4bdc1b.594b6","name":"Check if printing","topic":"","payload":"","payloadType":"date","repeat":"1800","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":320,"wires":[[]]},{"id":"92292817.6ed798","type":"api-current-state","z":"cb4bdc1b.594b6","name":"Printing?","server":"90ba4a50.2b5e48","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"binary_sensor.octoprint_printing","state_type":"str","outputs":2,"x":340,"y":320,"wires":[["74937770.c36228"],[]]},{"id":"a7fe037f.c4aa7","type":"api-call-service","z":"cb4bdc1b.594b6","name":"Send notification","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"","mergecontext":"","x":1310,"y":260,"wires":[[]]},{"id":"ba02b63d.8e9408","type":"api-render-template","z":"cb4bdc1b.594b6","name":"Progress and time","server":"90ba4a50.2b5e48","template":"Progress: {{ states('sensor.octoprint_job_percentage') }}%, Time remaining:  {{ states('sensor.octoprint_time_remaining') }}s, Hotend temperature: {{ states('sensor.octoprint_actual_tool0_temp')}}C, Bed temperature: {{ states('sensor.octoprint_actual_bed_temp')}}C","x":570,"y":260,"wires":[[]]},{"id":"887cb851.0596a8","type":"function","z":"cb4bdc1b.594b6","name":"Format message","func":"msg.payload = {\"data\":\n{\n    \"title\": msg.title,\n    \"message\": msg.body,\n    \"data\": {\n        \"push\": {\n            \"category\": \"camera\"\n        },\n        \"entity_id\": \"camera.octoprint\"\n    }\n}\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":1110,"y":320,"wires":[["a7fe037f.c4aa7"]]},{"id":"74937770.c36228","type":"api-render-template","z":"cb4bdc1b.594b6","name":"Title","server":"90ba4a50.2b5e48","template":"Printing progress: {{ states('sensor.octoprint_job_percentage') }}%","x":510,"y":320,"wires":[["9e6d2a15.9fb2c8"]]},{"id":"282265b0.6d842a","type":"api-render-template","z":"cb4bdc1b.594b6","name":"Body","server":"90ba4a50.2b5e48","template":"Time remaining:  {{ states('sensor.octoprint_time_remaining') }}s, Hotend temperature: {{ states('sensor.octoprint_actual_tool0_temp')}}C, Bed temperature: {{ states('sensor.octoprint_actual_bed_temp')}}C","x":790,"y":320,"wires":[["e551e68.10e0e18"]]},{"id":"9e6d2a15.9fb2c8","type":"change","z":"cb4bdc1b.594b6","name":"Set title","rules":[{"t":"set","p":"title","pt":"msg","to":"payload","tot":"msg"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"template","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":320,"wires":[["282265b0.6d842a"]]},{"id":"e551e68.10e0e18","type":"change","z":"cb4bdc1b.594b6","name":"Set tbody","rules":[{"t":"set","p":"body","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":320,"wires":[["887cb851.0596a8"]]},{"id":"7abfccf3.c48cb4","type":"cron","z":"cb4bdc1b.594b6","name":"","crontab":"*/30 * * * *","x":170,"y":380,"wires":[["92292817.6ed798"]]},{"id":"83cd7719.c3b28","type":"inject","z":"49017fb.081c18","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1300,"y":1040,"wires":[["a336ac3b.39d7d"]]},{"id":"83690d3.93434f","type":"cron","z":"407269cb.c12fd8","name":"","crontab":"*/30 * * * *","x":90,"y":1780,"wires":[["70b8dabc.b17634"]]},{"id":"70b8dabc.b17634","type":"api-call-service","z":"407269cb.c12fd8","name":"Initiate scan","server":"90ba4a50.2b5e48","service_domain":"zigbee2mqtt_networkmap","service":"update","data":"{\"entity_id\":\"admin\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":420,"y":1780,"wires":[[]]},{"id":"48c40a95.65d854","type":"trigger-state","z":"bee1fc25.cdcf8","name":"Remote toggle","server":"90ba4a50.2b5e48","entityid":"sensor.hallway_downstairs_switch","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":110,"y":120,"wires":[["50dc0ff.9b875f"],[]]},{"id":"108826e2.ca9af9","type":"api-call-service","z":"bee1fc25.cdcf8","name":"Toggle hallway light","server":"90ba4a50.2b5e48","service_domain":"light","service":"toggle","data":"{\"entity_id\":\"light.hallway_downstairs\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":590,"y":40,"wires":[[]]},{"id":"50dc0ff.9b875f","type":"switch","z":"bee1fc25.cdcf8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"toggle","vt":"str"},{"t":"eq","v":"brightness_up_click","vt":"str"},{"t":"eq","v":"brightness_down_click","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":330,"y":120,"wires":[["108826e2.ca9af9"],["72b62b6b.fef4b4"],["e634c125.1f1ba"]]},{"id":"72b62b6b.fef4b4","type":"api-call-service","z":"bee1fc25.cdcf8","name":"Light to 100","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.hallway_downstairs\",\"brightness_pct\":100}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":790,"y":80,"wires":[[]]},{"id":"e95eb2f6.83dbd","type":"api-render-template","z":"bee1fc25.cdcf8","name":"Calculate brightness","server":"90ba4a50.2b5e48","template":"{%  set brightness = state_attr('light.hallway_downstairs','brightness') | int %}\n{% set target_brightness = brightness - 50 %}\n{% if target_brightness >= 0 %}\n{{ target_brightness }}\n{% else %}\n0\n{% endif %}","x":740,"y":140,"wires":[["75d24018.d48a4"]]},{"id":"bb2c9a9c.d26598","type":"template","z":"bee1fc25.cdcf8","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"data\":\n{\n    \"entity_id\": \"light.hallway_downstairs\",\n    \"brightness\":{{payload}}\n}\n}","output":"str","x":1060,"y":140,"wires":[["87bcbec8.56eb8"]]},{"id":"87bcbec8.56eb8","type":"api-call-service","z":"bee1fc25.cdcf8","name":"Set brightness","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.hallway_downstairs\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1260,"y":140,"wires":[[]]},{"id":"e634c125.1f1ba","type":"delay","z":"bee1fc25.cdcf8","name":"","pauseType":"rate","timeout":"500","timeoutUnits":"milliseconds","rate":"3","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":530,"y":140,"wires":[["e95eb2f6.83dbd"]]},{"id":"75d24018.d48a4","type":"switch","z":"bee1fc25.cdcf8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":910,"y":140,"wires":[["bb2c9a9c.d26598"],["2b46e1b8.12d05e"]]},{"id":"2b46e1b8.12d05e","type":"api-call-service","z":"bee1fc25.cdcf8","name":"Turn off","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_off","data":"{\"entity_id\":\"light.hallway_downstairs\"}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1060,"y":200,"wires":[[]]},{"id":"d8366525.58142","type":"trigger-state","z":"13b34343.676d45","name":"No one home","server":"90ba4a50.2b5e48","entityid":"group.anyone_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"uletyb0j8hr","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":480,"y":340,"wires":[["46944ecb.868fe8"],[]]},{"id":"5e4c81c0.647648","type":"api-call-service","z":"cb4bdc1b.594b6","name":"Send notification","server":"90ba4a50.2b5e48","service_domain":"notify","service":"ios_sevenplusha","data":"{\"title\":\"Printer done\",\"message\":\"\",\"data\":{\"push\":{\"category\":\"camera\"},\"entity_id\":\"camera.octoprint\"}}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":1030,"y":200,"wires":[[]]},{"id":"96d2cf31.702fe8","type":"trigger-state","z":"13b34343.676d45","name":"CPU temp over 60","server":"90ba4a50.2b5e48","entityid":" sensor.dashpi_cpu_temp","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"cyge2w07l3q","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":">=","comparatorValueDatatype":"str","comparatorValue":"60"},{"id":"zv386l4hll7","targetType":"entity_id","targetValue":"input_boolean.someone_downstairs","propertyType":"property","propertyValue":"","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"num","x":110,"y":460,"wires":[["c3257b99.be539"],[]]},{"id":"c3257b99.be539","type":"delay","z":"13b34343.676d45","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":460,"wires":[["40d45767.6b01d8"]]},{"id":"40d45767.6b01d8","type":"api-current-state","z":"13b34343.676d45","name":"No one downstairs","server":"90ba4a50.2b5e48","halt_if":"off","halt_if_type":"str","halt_if_compare":"is","override_topic":true,"override_payload":true,"override_data":true,"entity_id":"input_boolean.someone_downstairs","state_type":"str","outputs":2,"x":530,"y":460,"wires":[["46944ecb.868fe8"],[]]},{"id":"dba4c8ac.278c18","type":"trigger-state","z":"cb4bdc1b.594b6","name":"Octoprint sensor","server":"90ba4a50.2b5e48","entityid":"sensor.octoprint_time_remaining","entityidfiltertype":"exact","debugenabled":false,"constraints":[],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"num","x":110,"y":480,"wires":[["d10289ac.593f28"],[]]},{"id":"d10289ac.593f28","type":"smooth","z":"cb4bdc1b.594b6","name":"","property":"payload","action":"mean","count":"10","round":"","mult":"single","x":300,"y":480,"wires":[["87e4c817.3b6618","9fe0c13f.5e48e"]]},{"id":"b4785721.04e188","type":"api-render-template","z":"cb4bdc1b.594b6","name":"Progress and time","server":"90ba4a50.2b5e48","template":"Progress: {{ states('sensor.octoprint_job_percentage') }}%, Time remaining:  {{ states('sensor.octoprint_time_remaining') }}s, Hotend temperature: {{ states('sensor.octoprint_actual_tool0_temp')}}C, Bed temperature: {{ states('sensor.octoprint_actual_bed_temp')}}C","x":670,"y":420,"wires":[[]]},{"id":"d9b1f8cc.325db8","type":"template","z":"cb4bdc1b.594b6","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"This is the payload: {{payload}} !","output":"str","x":400,"y":400,"wires":[[]]},{"id":"87e4c817.3b6618","type":"function","z":"cb4bdc1b.594b6","name":"","func":"msg.template = \"{% set multiplier = (((\"+msg.payload+\" - states('sensor.octoprint_time_remaining') | int) / 10) / 30) | round(1) %}{{ (((states('sensor.octoprint_time_remaining') | int) / multiplier) / 3600) | round(2) }}\"\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":560,"wires":[["5c10f115.92467"]]},{"id":"5c10f115.92467","type":"api-render-template","z":"cb4bdc1b.594b6","name":"Progress and time","server":"90ba4a50.2b5e48","template":"","x":670,"y":560,"wires":[["724d161f.243df8","2ca9bfa.9103b4"]]},{"id":"724d161f.243df8","type":"debug","z":"cb4bdc1b.594b6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":560,"wires":[]},{"id":"2ca9bfa.9103b4","type":"template","z":"cb4bdc1b.594b6","name":"mqtt template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"value\": {{payload}}}\n","output":"str","x":880,"y":600,"wires":[["eb3b3ce7.d2113"]]},{"id":"eb3b3ce7.d2113","type":"mqtt out","z":"cb4bdc1b.594b6","name":"","topic":"printer/estimation/hours","qos":"","retain":"false","broker":"e9e87280.3fdb9","x":1132.9999694824219,"y":599.3334140777588,"wires":[]},{"id":"9cc4b501.657098","type":"debug","z":"cb4bdc1b.594b6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"template","x":680,"y":640,"wires":[]},{"id":"9fe0c13f.5e48e","type":"function","z":"cb4bdc1b.594b6","name":"","func":"msg.template = \"{% set multiplier = (((\"+msg.payload+\" - states('sensor.octoprint_time_remaining') | int) / 10) / 30) | round(1) %}{{ (((states('sensor.octoprint_time_remaining') | int) / multiplier)) | round(2) }}\"\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":620,"wires":[["d3b27024.8fd93"]]},{"id":"d3b27024.8fd93","type":"api-render-template","z":"cb4bdc1b.594b6","name":"Progress and time","server":"90ba4a50.2b5e48","template":"","x":670,"y":680,"wires":[["fd50763c.52f7f8"]]},{"id":"fd50763c.52f7f8","type":"template","z":"cb4bdc1b.594b6","name":"mqtt template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\"value\": {{payload}}}\n","output":"str","x":880,"y":680,"wires":[["5535bdc0.ad40b4"]]},{"id":"5535bdc0.ad40b4","type":"mqtt out","z":"cb4bdc1b.594b6","name":"","topic":"printer/estimation/seconds","qos":"","retain":"false","broker":"e9e87280.3fdb9","x":1142.9999694824219,"y":679.3334140777588,"wires":[]},{"id":"64796e71.434a8","type":"trigger-state","z":"49017fb.081c18","name":"Playing games","server":"90ba4a50.2b5e48","entityid":"binary_sensor.playing_games","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"id":"6l767inoske","targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"}],"constraintsmustmatch":"all","outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","x":110,"y":2380,"wires":[["cc24662.a9a1e98"],[]]},{"id":"cc24662.a9a1e98","type":"api-call-service","z":"49017fb.081c18","name":"Office light on","server":"90ba4a50.2b5e48","service_domain":"light","service":"turn_on","data":"{\"entity_id\":\"light.office\",\"brightness_pct\":100}","render_data":false,"mergecontext":"","output_location":"payload","output_location_type":"msg","x":450,"y":2380,"wires":[[]]}]